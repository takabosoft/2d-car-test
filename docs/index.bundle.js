/*! For license information please see index.bundle.js.LICENSE.txt */
(()=>{var t={2:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RobotDriver=void 0;const o=i(923),s=i(275),n=i(285),r=i(312),a=i(709);e.RobotDriver=class{constructor(t){this.controlState=new s.ControlState,this.gene=(0,a.clampRobotGene)(t)}compute(t){this.controlState.accel=!0,this.controlState.steeringRatio=0;const e=o.Vec2.lengthOf(t.body.getLinearVelocity()),i=this.gene.rayCastMinDistance,s=this.gene.rayCastMinDistance*e,a=(0,r.lerpNumber)(i,s,this.gene.rayCastSpeedRatio),m=this.gene.rayCastMaxDistance,c=this.gene.rayCastMaxDistance*e,h=(0,r.lerpNumber)(m,c,this.gene.rayCastSpeedRatio),l=t.rayCast(h,0);if(null==l)return;const _=(0,n.clamp)(h-a==0?0:(l-a)/(h-a),0,1);let u;const p=t.rayCast(h,+this.gene.rayCastDirectionOffsetRad),y=t.rayCast(h,-this.gene.rayCastDirectionOffsetRad);u=null==p&&null==y?Math.random()<.5:null==p&&null!=y||(null==p||null!=y)&&p<y,this.controlState.steeringRatio=(0,r.lerpNumber)(this.gene.steeringMaxRatio,this.gene.steeringMinRatio,_)*(u?-1:1)}}},37:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Vec2=void 0;class i{constructor(t,e){this.x=t,this.y=e}scale(t){return new i(this.x*t,this.y*t)}}e.Vec2=i},91:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Tire=void 0;const o=i(923),s=i(327);e.Tire=class{constructor(t,e,i,n,r){this.maxForwardSpeed=e,this.maxBackwardSpeed=i,this.forwardDriveForce=n,this.backwardDriveForce=r,this.body=t.createDynamicBody({position:new o.Vec2(0,0),linearDamping:3,angularDamping:0}),this.body.createFixture({shape:new o.Box(1*s.pixelToSim,1.5*s.pixelToSim),density:1,friction:0,restitution:.8,filterCategoryBits:1,filterMaskBits:6})}get lateralVelocity(){const t=this.body.getWorldVector(new o.Vec2(1,0)),e=o.Vec2.dot(t,this.body.getLinearVelocity());return o.Vec2.mul(e,t)}get forwardVelocity(){const t=this.body.getWorldVector(new o.Vec2(0,1)),e=o.Vec2.dot(t,this.body.getLinearVelocity());return o.Vec2.mul(e,t)}updateFriction(){{const t=this.body.getLinearVelocity(),e=t.length(),i=o.Vec2.normalize(t),s=this.body.getWorldVector(new o.Vec2(0,1)),n=o.Vec2.dot(s,i)<0?-e:e;this.body.setLinearVelocity(s.mul(n))}}updateDrive(t){if(t.brake){const t=this.forwardVelocity,e=-.015*t.normalize();this.body.applyForce(o.Vec2.mul(t,e),this.body.getWorldCenter())}let e=0;t.accel?e=this.maxForwardSpeed:t.back&&(e=this.maxBackwardSpeed);const i=this.body.getWorldVector(new o.Vec2(0,1)),s=o.Vec2.dot(this.forwardVelocity,i);let n=0;if(e>s)n=this.forwardDriveForce;else{if(!(e<0&&e<s))return;n=-this.backwardDriveForce}this.body.applyForce(o.Vec2.mul(n,i),this.body.getWorldCenter())}}},147:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.soundManager=void 0,e.soundManager=new class{constructor(){this.audioContext=new AudioContext({latencyHint:"interactive"}),this.enable=!1,document.addEventListener("pointerdown",(()=>this.audioContext.resume()),!0)}playButtonTap(){if(!this.enable)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.type="sine",t.frequency.setValueAtTime(1300,this.audioContext.currentTime),e.gain.setValueAtTime(.3,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.1),t.connect(e).connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+.1),t.onended=()=>{t.disconnect(),e.disconnect()}}}},177:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Scene=void 0;const o=i(422);class s extends o.Component{constructor(t,e){super(),this.sceneController=t,this.element=$('<div class="scene">').addClass(e)}onStartScene(){}onEndScene(){}onResize(){}onKeyDown(t){}onKeyUp(t){}}e.Scene=s},192:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CarSound=void 0;const o=i(147);e.CarSound=class{constructor(t=.2){const e=o.soundManager.audioContext;this.oscillator=e.createOscillator(),this.oscillator.type="square",this.oscillator.frequency.value=40,this.panner=e.createStereoPanner();const i=e.createGain();i.gain.value=t,this.oscillator.connect(this.panner).connect(i).connect(e.destination),this.oscillator.onended=()=>{this.oscillator.disconnect(),this.panner.disconnect(),i.disconnect()},this.oscillator.start()}update(t,e){this.panner.pan.value=t,this.oscillator.frequency.value=e}destroy(){this.oscillator.stop()}}},220:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Course02=e.Course01=e.Course=void 0;const o=i(923),s=i(327),n=i(623);class r{constructor(t,e){this.info=e,null!=t&&(e.outerWalls.forEach((e=>{const i=new o.Chain(e.map((t=>this.convertPosXY(t[0],t[1]))));t.createBody().createFixture(i,{friction:1,filterCategoryBits:2})})),this.checkPoints.forEach(((e,i)=>{new n.CheckPoint(t,e,i)})))}get name(){return this.info.name}get courseId(){return this.info.courseId}get size(){return this.info.size.clone().mul(s.pixelToSim)}get startPos(){return this.convertPosVec2(this.info.startPos)}get outerWalls(){return this.info.outerWalls.map((t=>t.map((t=>this.convertPosXY(t[0],t[1])))))}get checkPoints(){return this.info.checkPoints.map((t=>[this.convertPosVec2(t[0]),this.convertPosVec2(t[1])]))}get checkPointCount(){return this.info.checkPoints.length}convertPosXY(t,e){return new o.Vec2(t,this.info.size.y-e).mul(s.pixelToSim)}convertPosVec2(t){return new o.Vec2(t.x,this.info.size.y-t.y).mul(s.pixelToSim)}static fromId(t,e){switch(t){case 0:return new a(e);case 1:return new m(e)}return new a(e)}}e.Course=r;class a extends r{constructor(t){super(t,{courseId:0,name:"コース01",size:new o.Vec2(800,480),outerWalls:[[[472,32],[486,35],[495,35],[519,40],[528,40],[547,44],[554,47],[558,47],[568,51],[572,51],[592,59],[638,84],[674,110],[691,127],[713,157],[726,184],[734,209],[735,214],[735,282],[733,288],[732,301],[730,305],[729,324],[725,347],[723,351],[722,361],[713,389],[693,425],[675,445],[654,461],[638,468],[629,470],[590,470],[589,469],[580,469],[574,467],[556,465],[529,456],[504,444],[482,426],[454,390],[443,369],[434,347],[431,343],[406,329],[400,324],[370,308],[342,308],[326,313],[205,313],[186,309],[175,309],[169,307],[151,305],[124,296],[82,267],[66,245],[54,219],[51,208],[51,174],[55,153],[62,138],[66,125],[77,104],[95,85],[110,73],[136,59],[151,54],[155,54],[177,48],[194,48],[209,44],[217,44],[226,41],[269,39],[280,36],[327,35],[342,32],[396,32],[397,31],[472,32]],[[395,123],[354,123],[342,126],[293,127],[284,130],[240,132],[230,135],[222,135],[209,139],[192,139],[178,142],[169,145],[152,157],[142,186],[142,192],[145,198],[152,206],[156,209],[170,215],[181,216],[187,218],[198,218],[217,222],[312,222],[330,217],[385,217],[405,223],[442,242],[463,256],[479,264],[494,275],[510,294],[520,313],[531,340],[552,366],[575,375],[587,376],[593,378],[601,378],[602,379],[615,375],[621,367],[629,351],[630,343],[633,336],[634,327],[637,318],[638,304],[639,303],[639,291],[644,268],[644,229],[635,207],[626,192],[616,181],[587,161],[552,142],[535,136],[531,136],[515,131],[507,131],[494,128],[484,128],[459,123],[396,122],[395,123]]],startPos:new o.Vec2(446,78),checkPoints:[[new o.Vec2(405,25),new o.Vec2(405,127)],[new o.Vec2(249,211),new o.Vec2(249,324)],[new o.Vec2(633,245),new o.Vec2(748,245)]]})}}e.Course01=a;class m extends r{constructor(t){super(t,{courseId:1,name:"コース02",size:new o.Vec2(800,480),outerWalls:[[[551,25],[564,28],[571,28],[576,30],[600,31],[611,33],[652,44],[692,62],[709,74],[722,88],[734,112],[743,143],[744,149],[744,219],[742,224],[741,241],[734,266],[733,274],[726,295],[710,330],[706,343],[689,375],[672,401],[660,417],[638,439],[616,451],[610,456],[590,463],[539,463],[510,456],[480,444],[448,417],[387,330],[360,299],[348,290],[337,285],[334,285],[328,290],[297,344],[284,362],[271,375],[237,390],[208,390],[207,389],[200,389],[190,387],[166,377],[158,372],[137,353],[121,334],[113,319],[103,305],[96,287],[86,271],[85,266],[69,231],[68,223],[63,207],[63,120],[70,95],[75,83],[96,57],[114,45],[139,33],[171,25],[551,25]],[[172,114],[152,123],[149,136],[149,193],[153,207],[178,260],[188,275],[191,283],[198,292],[218,303],[225,295],[238,273],[245,258],[259,237],[284,213],[309,200],[328,195],[357,198],[395,217],[411,228],[434,252],[436,256],[458,280],[480,313],[491,326],[506,350],[518,365],[529,371],[552,377],[572,377],[586,369],[596,358],[602,347],[616,328],[619,319],[639,279],[646,261],[654,233],[655,222],[656,221],[656,209],[658,204],[658,162],[652,142],[642,134],[623,126],[614,125],[596,119],[589,119],[584,117],[576,117],[575,116],[559,116],[538,111],[184,111],[172,114]]],startPos:new o.Vec2(382,68),checkPoints:[[new o.Vec2(292,15),new o.Vec2(292,121)],[new o.Vec2(332,171),new o.Vec2(332,304)],[new o.Vec2(639,191),new o.Vec2(757,191)]]})}}e.Course02=m},241:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SceneController=void 0;const o=i(923),s=i(422);class n extends s.Component{constructor(){super(),this.element=$('<div class="scene-ctrl">'),new ResizeObserver((()=>{var t;return null===(t=this._curScene)||void 0===t?void 0:t.onResize()})).observe(this.element[0]),window.addEventListener("keydown",(t=>{var e;t.target instanceof HTMLButtonElement&&("Enter"==t.key||" "==t.key)&&t.preventDefault(),null===(e=this._curScene)||void 0===e||e.onKeyDown(t)}),!0),window.addEventListener("keyup",(t=>{var e;null===(e=this._curScene)||void 0===e||e.onKeyUp(t)}),!0)}get screenSize(){return new o.Vec2(this.element.outerWidth(),this.element.outerHeight())}changeScene(t){var e;null===(e=this._curScene)||void 0===e||e.onEndScene(),this.element.empty().append(t.element),this._curScene=t,t.onStartScene()}}e.SceneController=n},275:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ControlState=void 0,e.ControlState=class{constructor(){this.accel=!1,this.back=!1,this.brake=!1,this.steeringRatio=0}}},285:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.radToDeg=e.degToRad=void 0,e.clamp=function(t,e,i){return Math.max(e,Math.min(t,i))},e.rotateVec2=function(t,e){return new o.Vec2(t.x*Math.cos(e)-t.y*Math.sin(e),t.x*Math.sin(e)+t.y*Math.cos(e))};const o=i(923);e.degToRad=Math.PI/180,e.radToDeg=180/Math.PI},312:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.easeInOutQuintic=function(t){const e=t*t,i=e*t;return 6*i*e+-15*e*e+10*i},e.lerpNumber=function(t,e,i){return t*(1-i)+e*i}},327:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.pixelToSim=void 0,e.pixelToSim=.01},422:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Component=void 0,e.Component=class{constructor(){this.element=$()}}},426:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CarView=void 0;const o=i(422),s=i(327),n=i(37),r=i(192),a=i(147),m=i(948),c=i(285);class h extends o.Component{constructor(t){super(),this.offset=t,this.element=$('<div class="tire">')}}class l extends o.Component{constructor(t,e,i=.2){super(),this.name=e,this.nameView=$('<div class="name-plate">'),a.soundManager.enable&&(this.sound=new r.CarSound(i)),this.element=$('<div class="car">');const o=(t,e)=>{const i=new h(new n.Vec2(t,e));return this.element.append(i.element.css({left:t,top:e})),i};this.flTire=o(0,3),this.frTire=o(11,3),this.rlTire=o(0,10),this.rrTire=o(11,10);const s=$(m.spriteSheet.crop(m.spriteInfos.car).canvas).addClass("body");null!=t&&(s[0].style.filter=`hue-rotate(${360*t}deg)`),this.element.append(s),null!=e&&this.nameView.text(e)}update(t,e,i){var o;const n=new DOMMatrix;n.multiplySelf(e);const r=t.body.getPosition();n.translateSelf(r.x,r.y),n.scaleSelf(s.pixelToSim,s.pixelToSim,1),n.rotateSelf(0,0,t.body.getAngle()*c.radToDeg),n.scaleSelf(1,-1,1),n.translateSelf(-6.5,-8,0),this.element[0].style.transform=n.toString();const a=t.getTireAngle*c.radToDeg;if(this.flTire.element[0].style.transform=this.frTire.element[0].style.transform=`rotate(${-a}deg)`,null!=this.name){const t=e.transformPoint(new DOMPoint(r.x,r.y+8*s.pixelToSim));this.nameView[0].style.transform=`translate(${t.x}px, ${t.y}px) translate(-50%, -20px)`}null===(o=this.sound)||void 0===o||o.update(r.x/i*2-1,40+100*t.body.getLinearVelocity().length())}destroy(){var t;this.element.remove(),this.nameView.remove(),null===(t=this.sound)||void 0===t||t.destroy()}}e.CarView=l},435:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LiveTimingView=void 0;const o=i(422),s=i(938);class n extends o.Component{constructor(){super(),this.lapTimeCache=new Map,this.lastUpdateSec=0,this.element=$('<div class="live-timing-view">')}clearCache(){this.lapTimeCache.clear()}update(t,e){if(!t.some((t=>!this.lapTimeCache.has(t)||this.lapTimeCache.get(t)!=t.car.bestLapTime)))return;this.lastUpdateSec=e,this.clearCache(),t.forEach((t=>this.lapTimeCache.set(t,t.car.bestLapTime)));const i=document.createDocumentFragment();[...t].sort(((t,e)=>{var i,o;return(null!==(i=t.car.bestLapTime)&&void 0!==i?i:Number.MAX_VALUE)-(null!==(o=e.car.bestLapTime)&&void 0!==o?o:Number.MAX_VALUE)})).forEach((e=>{const o=t.reduce(((t,i)=>{var o,s;return(null!==(o=e.car.bestLapTime)&&void 0!==o?o:Number.MAX_VALUE)>(null!==(s=i.car.bestLapTime)&&void 0!==s?s:Number.MAX_VALUE)?t+1:t}),1);$("<div>").text(o).appendTo(i),$("<div>").text(e.robotDriver.gene.name).appendTo(i),$("<div>").text((0,s.formatLapTime)(e.car.bestLapTime)).appendTo(i)})),this.element.empty().append(i)}}e.LiveTimingView=n},447:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HumanDriver=void 0;const o=i(275);e.HumanDriver=class{constructor(){this.controlState=new o.ControlState,this.keyState=new Set}get calcSteeringRatio(){return 0+(this.keyState.has("a")?-1:0)+(this.keyState.has("d")?1:0)}onKeyDown(t){switch(t.key){case"w":this.controlState.accel=!0;break;case"s":this.controlState.brake=!0;break;case"x":this.controlState.back=!0;break;case"a":case"d":this.keyState.add(t.key),this.controlState.steeringRatio=this.calcSteeringRatio}}onKeyUp(t){switch(t.key){case"w":this.controlState.accel=!1;break;case"s":this.controlState.brake=!1;break;case"x":this.controlState.back=!1;break;case"a":case"d":this.keyState.delete(t.key),this.controlState.steeringRatio=this.calcSteeringRatio}}}},483:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Ticker=void 0;const o=i(522);e.Ticker=class{constructor(t){this.onFrame=t,this.req=new o.AnimationFrameRequester,this.isStart=!1}start(){let t;this.stop(),this.isStart=!0;const e=i=>{if(null!=t){let e=(i-t)/1e3;if(this.onFrame(e),!this.isStart)return}t=i,this.req.request(e)};this.req.request(e)}stop(){this.isStart=!1,this.req.cancel()}}},493:function(t,e){"use strict";var i=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))((function(s,n){function r(t){try{m(o.next(t))}catch(t){n(t)}}function a(t){try{m(o.throw(t))}catch(t){n(t)}}function m(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}m((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.ImagePreloader=void 0,e.ImagePreloader=class{constructor(t){this.url=t}load(){return new Promise(((t,e)=>i(this,void 0,void 0,(function*(){const o=()=>e(`${this.url}の読み込みに失敗しました。`);try{const e=document.createElement("img");e.onload=()=>{e.width=e.naturalWidth,e.height=e.naturalHeight,this._img=$(e),t()},e.onerror=()=>o(),e.src=yield function(t){return i(this,void 0,void 0,(function*(){const e=yield fetch(t);if(!e.ok)throw"error";const i=yield e.blob();return yield function(t){return new Promise(((e,i)=>{const o=new FileReader;o.onloadend=()=>e(o.result),o.readAsDataURL(t)}))}(i)}))}(this.url)}catch(t){o()}}))))}get img(){if(null==this._img)throw"画像読み込みエラー";return this._img}}},501:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GeneticGameScene=void 0;const o=i(483),s=i(529),n=i(709),r=i(742),a=i(177),m=i(728),c=i(435),h=i(564);class l extends a.Scene{constructor(t,e){super(t,"genetic-game-scene"),this.courseView=new s.CourseView,this.robots=[],this.ticker=new o.Ticker((t=>this.onTicker(t))),this.liveTimingView=new c.LiveTimingView,this.textEl=$("<div>"),this.infoEl=$('<div class="info">').append(this.textEl,this.liveTimingView.element),this.generation=1,this.gameWorld=new r.GameWorld(e),this.element.append(this.courseView.element,this.infoEl,$('<button class="back-btn">').text("戻る").on("click",(()=>this.sceneController.changeScene(new m.TitleScene(this.sceneController))))),this.createRobots(),this.layout(),this.updateTextInfo()}onStartScene(){this.ticker.start()}onEndScene(){this.ticker.stop(),this.robots.forEach((t=>t.destroy()))}onResize(){this.layout()}onKeyDown(t){}onKeyUp(t){}layout(){const t=this.sceneController.screenSize;this.courseView.render(this.gameWorld.course,t),this.updateCarView()}updateCarView(){const t=this.gameWorld.course.size.x;this.robots.forEach((e=>e.carView.update(e.car,this.courseView.matrix,t)))}onTicker(t){this.robots.forEach((t=>{t.robotDriver.compute(t.car),t.car.update()})),this.gameWorld.step(t),this.updateCarView(),this.liveTimingView.update(this.robots,this.gameWorld.totalSec),(this.liveTimingView.lastUpdateSec+10<this.gameWorld.totalSec&&this.robots.some((t=>null!=t.car.bestLapTime))||this.liveTimingView.lastUpdateSec+30<this.gameWorld.totalSec||this.gameWorld.totalSec>60)&&this.nextGeneration()}updateTextInfo(){this.textEl.text(`第${this.generation}世代`)}nextGeneration(){console.log("次の世代へ移行します。"),this.ticker.stop(),this.generation++;const t=[...this.robots].sort(((t,e)=>{var i,o;return(null!==(i=t.car.bestLapTime)&&void 0!==i?i:Number.MAX_VALUE)-(null!==(o=e.car.bestLapTime)&&void 0!==o?o:Number.MAX_VALUE)})),e=[];for(let i=0;i<20;i++){const o=t[0],s=t[1+Math.floor(3*Math.random())];console.log(`${i}: ${o.robotDriver.gene.name} x ${s.robotDriver.gene.name}`),e.push((0,n.crossover)(o.robotDriver.gene,s.robotDriver.gene))}this.robots.forEach((t=>t.destroy())),this.robots=[],this.createRobots(e),this.updateTextInfo(),this.gameWorld.resetTotalSec(),this.ticker.start()}createRobots(t){for(let e=0;e<20;e++){const i=new h.Robot(this.gameWorld.world,t?t[e]:(0,n.createRandomGene)());this.element.append(i.carView.element,i.carView.nameView),i.car.reset(this.gameWorld.course.startPos,Math.PI/2),this.robots.push(i)}this.updateCarView()}}e.GeneticGameScene=l},522:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AnimationFrameRequester=void 0,e.AnimationFrameRequester=class{constructor(){}request(t){this.cancel(),this.handle=window.requestAnimationFrame((e=>{this.handle=void 0,t(e)}))}cancel(){null!=this.handle&&(window.cancelAnimationFrame(this.handle),this.handle=void 0)}}},523:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Rect=void 0;const o=i(37);class s{constructor(t,e,i,o){this.x=t,this.y=e,this.width=i,this.height=o}get left(){return this.x}get top(){return this.y}get right(){return this.x+this.width}get bottom(){return this.y+this.height}get center(){return new o.Vec2((this.left+this.right)/2,(this.top+this.bottom)/2)}get size(){return new o.Vec2(this.width,this.height)}get isEmpty(){return this.width<=0||this.height<=0}offset(t){return new s(this.x+t.x,this.y+t.y,this.width,this.height)}scale(t){return new s(this.x*t,this.y*t,this.width*t,this.height*t)}deflate(t){var e,i,o,n,r;const a=null!==(e=t.all)&&void 0!==e?e:0;return s.fromLeftTopRightBottom(this.left+(null!==(i=t.left)&&void 0!==i?i:a),this.top+(null!==(o=t.top)&&void 0!==o?o:a),this.right-(null!==(n=t.right)&&void 0!==n?n:a),this.bottom-(null!==(r=t.bottom)&&void 0!==r?r:a))}objectPosition(t){return new s((this.width-t.x)/2,(this.top+this.bottom-t.y)/2,t.x,t.y)}objectFitContain(t){if(this.isEmpty)return s.zero;const e=Math.min(this.width/t.x,this.height/t.y),i=t.scale(e);return this.objectPosition(i)}intersect(t){const e=Math.max(this.left,t.left),i=Math.max(this.top,t.top),o=Math.min(this.right,t.right),n=Math.min(this.bottom,t.bottom),r=Math.max(0,o-e),a=Math.max(0,n-i);return new s(e,i,r,a)}union(t){if(this.isEmpty)return t;if(t.isEmpty)return this;const e=Math.min(this.left,t.left),i=Math.min(this.top,t.top),o=Math.max(this.right,t.right),n=Math.max(this.bottom,t.bottom);return new s(e,i,o-e,n-i)}toString(){return`{ x: ${this.x}, y: ${this.y}, width: ${this.width}, height: ${this.height}}`}static fromSize(t){return new s(0,0,t.x,t.y)}static fromLeftTopRightBottom(t,e,i,o){return new s(t,e,i-t,o-e)}static fromOuterBounds(t){var e,i;return new s(0,0,null!==(e=t.outerWidth())&&void 0!==e?e:0,null!==(i=t.outerHeight())&&void 0!==i?i:0)}}e.Rect=s,s.zero=new s(0,0,0,0)},529:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CourseView=void 0;const o=i(923),s=i(422),n=i(810),r=i(327),a=i(948);class m extends s.Component{constructor(){super(),this.canvas=new n.TinyCanvas,this._matrix=new DOMMatrix,this._lastScreenSize=o.Vec2.zero(),this.element=this.canvas.element.addClass("course")}get matrix(){return this._matrix}render(t,e){if(o.Vec2.areEqual(e,this._lastScreenSize))return;this._lastScreenSize=e;const i=t.size,s=Math.min(e.x/i.x,e.y/i.y),n=o.Vec2.mul(i,s),m=o.Vec2.mul(.5,o.Vec2.sub(e,n)),c=new DOMMatrix;c.translateSelf(m.x,m.y,0),c.scaleSelf(s,s,1,0,0,0),c.translateSelf(0,i.y,0),c.scaleSelf(1,-1,1,0,0,0),this._matrix=c;const h=r.pixelToSim*c.a;this.canvas.size=e;const l=this.canvas.ctx;l.imageSmoothingEnabled=!1,l.setLineDash([]),l.lineJoin="round";const _=new Path2D;t.outerWalls.forEach((t=>t.forEach(((t,e)=>0==e?_.moveTo(t.x,t.y):_.lineTo(t.x,t.y))))),_.closePath();{l.resetTransform(),l.scale(h,h);const t=l.createPattern(a.spriteSheet.crop(a.spriteInfos.grass).canvas,"repeat");l.fillStyle=t,l.fillRect(0,0,this.canvas.canvas.width/h+10,this.canvas.canvas.height/h+10)}this.canvas.ctx.setTransform(c);{l.save(),l.clip(_),l.resetTransform(),l.scale(h,h);const t=l.createPattern(a.spriteSheet.crop(a.spriteInfos.asphalt).canvas,"repeat");l.fillStyle=t,l.fillRect(0,0,this.canvas.canvas.width/h+10,this.canvas.canvas.height/h+10),l.restore()}{const e=t.checkPoints;if(e.length>0){l.save(),l.clip(_);const t=.04,i=t=>{l.beginPath(),l.moveTo(e[0][0].x+t,e[0][0].y),l.lineTo(e[0][1].x+t,e[0][1].y),l.stroke()};l.strokeStyle="black",l.lineWidth=4*t,i(0),l.strokeStyle="white",l.lineWidth=t,l.setLineDash([t,t]),i(1.5*-t),i(.5*+t),l.lineDashOffset=t,i(.5*-t),i(1.5*+t),l.restore()}}l.save(),l.clip(_),l.lineWidth=.08,l.strokeStyle="white",l.stroke(_),l.setLineDash([.08,.08]),l.strokeStyle="red",l.lineWidth=.06,l.stroke(_),l.restore(),l.setLineDash([]),l.lineWidth=.02,l.strokeStyle="rgb(50, 50, 50)",l.stroke(_)}}e.CourseView=m},564:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Robot=void 0;const o=i(2),s=i(995),n=i(426);e.Robot=class{constructor(t,e){this.robotDriver=new o.RobotDriver(e),this.car=new s.Car(t,this.robotDriver.controlState),this.carView=new n.CarView(this.robotDriver.gene.color,this.robotDriver.gene.name,.05)}destroy(){this.car.destroy(),this.carView.destroy()}}},623:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CheckPoint=void 0;const o=i(923);e.CheckPoint=class{constructor(t,e,i){this.index=i,t.createBody({}).createFixture({shape:new o.Edge(e[0],e[1]),isSensor:!0,filterCategoryBits:4,userData:this})}}},625:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.randomName=function(){var t=["佐藤","鈴木","高橋","田中","渡辺","伊藤","山本","中村","小林","加藤","吉田","山田","佐々木","山口","斎藤","松本","井上","木村","林","清水","山崎","森","阿部","池田","橋本","山下","石川","中島","前田","藤田","小川","後藤","岡田","長谷川","村上","近藤","石井","齊藤","坂本","遠藤","青木","藤井","西村","福田","太田","三浦","岡本","松田","中川","中野","原田","小野","田村","竹内","金子","和田","中山","藤原","石田","上田","森田","原","柴田","酒井","工藤","横山","宮崎","宮本","内田","高木","安藤","谷口","大野","丸山","今井","高田","藤本","武田","村田","上野","杉山","増田","平野","大塚","千葉","久保","松井","小島","岩崎","桜井","野口","松尾","野村","木下","菊地","佐野","大西","杉本","新井","浜田","菅原","市川","水野","小松","島田","古川","小山","高野","西田","菊池","山内","西川","五十嵐","北村","安田","中田","川口","平田","川崎","飯田","吉川","本田","久保田","沢田","辻","関","吉村","渡部","岩田","中西","服部","樋口","福島","川上","永井","松岡","田口","山中","森本","土屋","矢野","広瀬","秋山","石原","松下","大橋","松浦","吉岡","小池","馬場","浅野","荒木","大久保","野田","小沢","田辺","川村","星野","黒田","堀","尾崎","望月","永田","熊谷","内藤","松村","西山","大谷","平井","大島","岩本","片山","本間","早川","横田","岡崎","荒井","大石","鎌田","成田","宮田","小田","石橋","篠原","須藤","河野","大沢","小西","南","高山","栗原","伊東","松原","三宅","福井","大森","奥村","岡","内山","片岡"],e=["大輔","誠","直樹","亮","剛","大介","学","健一","健","哲也","聡","健太郎","洋平","淳","竜也","崇","翔太","拓也","健太","翔","達也","雄太","翔平","大樹","大輔","和也","達也","翔太","徹","哲也","秀樹","英樹","浩二","健一","博","博之","修","大輝","拓海","海斗","大輔","大樹","翔太","大輝","翼","拓海","直人","康平","達也","駿","雄大","亮太","拓也","大貴","亮太","拓哉","雄大","誠","隆","茂","豊","明","浩","進","勝","洋子","恵子","京子","幸子","和子","久美子","由美子","裕子","美智子","悦子","智子","久美子","陽子","理恵","真由美","香織","恵","愛","優子","智子","裕美","真由美","めぐみ","美穂","純子","美紀","彩","美穂","成美","沙織","麻衣","舞","愛美","瞳","彩香","麻美","沙織","麻衣","由佳","あゆみ","友美","麻美","裕子","美香","恵美","直美","由美","陽子","直子","未来","萌","美咲","亜美","里奈","菜々子","彩花","遥","美咲","明日香","真由","楓","奈々","彩花","優花","桃子","美咲","佳奈","葵","菜摘","桃子","茜","明美","京子","恵子","洋子","順子","典子"];return t[Math.floor(Math.random()*t.length)]+" "+e[Math.floor(Math.random()*e.length)]}},709:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.testGene=void 0,e.clampRobotGene=function(t){const e=m.clamp(t.rayCastMinDistance),i=h.clamp(t.steeringMinRatio);return{name:t.name,color:t.color,rayCastMinDistance:e,rayCastMaxDistance:m.clamp(t.rayCastMaxDistance,e),rayCastSpeedRatio:c.clamp(t.rayCastSpeedRatio),steeringMinRatio:i,steeringMaxRatio:h.clamp(t.steeringMaxRatio,i),rayCastDirectionOffsetRad:l.clamp(t.rayCastDirectionOffsetRad)}},e.createRandomGene=function(){const t=m.rnd(),e=h.rnd();return{name:(0,n.randomName)(),color:Math.random(),rayCastMinDistance:t,rayCastMaxDistance:m.rnd(t),rayCastSpeedRatio:c.rnd(),steeringMinRatio:e,steeringMaxRatio:h.rnd(e),rayCastDirectionOffsetRad:l.rnd()}},e.crossover=function(t,e){return{name:(0,n.randomName)(),color:Math.random(),rayCastMinDistance:_(t.rayCastMinDistance,e.rayCastMinDistance,(()=>m.rnd())),rayCastMaxDistance:_(t.rayCastMaxDistance,e.rayCastMaxDistance,(()=>m.rnd())),rayCastSpeedRatio:_(t.rayCastSpeedRatio,e.rayCastSpeedRatio,(()=>c.rnd())),steeringMinRatio:_(t.steeringMinRatio,e.steeringMinRatio,(()=>h.rnd())),steeringMaxRatio:_(t.steeringMaxRatio,e.steeringMaxRatio,(()=>h.rnd())),rayCastDirectionOffsetRad:_(t.rayCastDirectionOffsetRad,e.rayCastDirectionOffsetRad,(()=>l.rnd()))}};const o=i(312),s=i(285),n=i(625),r=i(871);class a{constructor(t,e){this.min=t,this.max=e}clamp(t,e){return(0,s.clamp)(t,null!=e?e:this.min,this.max)}rnd(t){return(0,r.rndRange)(null!=t?t:this.min,this.max)}}const m=new a(.001,2),c=new a(0,1),h=new a(.001,1),l=new a(.001,60*s.degToRad);function _(t,e,i){return Math.random()<.05?i():(0,o.lerpNumber)(t,e,Math.random())}e.testGene={name:"TEST ROBOT",color:0,rayCastMinDistance:.2,rayCastMaxDistance:.7,rayCastSpeedRatio:.5,steeringMinRatio:1,steeringMaxRatio:1,rayCastDirectionOffsetRad:30*s.degToRad}},714:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GameScene=void 0;const o=i(177),s=i(995),n=i(447),r=i(426),a=i(483),m=i(529),c=i(742),h=i(938),l=i(728);class _ extends o.Scene{constructor(t,e){super(t,"game-scene"),this.courseView=new m.CourseView,this.humanDriver=new n.HumanDriver,this.carView=new r.CarView,this.ticker=new a.Ticker((t=>this.onTicker(t))),this.textEl=$('<div class="lap-info">'),this.gameWorld=new c.GameWorld(e),this.car=new s.Car(this.gameWorld.world,this.humanDriver.controlState),this.element.append(this.courseView.element,this.carView.element,this.textEl,$('<button class="back-btn">').text("戻る").on("click",(()=>this.sceneController.changeScene(new l.TitleScene(this.sceneController)))),$('<div class="operation-info">').text("[W]アクセル\n[A][D]ハンドル\n[S]ブレーキ\n[X]バック")),this.car.reset(this.gameWorld.course.startPos,Math.PI/2),this.layout()}onStartScene(){this.ticker.start()}onEndScene(){this.ticker.stop(),this.carView.destroy()}onResize(){this.layout()}onKeyDown(t){this.humanDriver.onKeyDown(t)}onKeyUp(t){this.humanDriver.onKeyUp(t)}layout(){const t=this.sceneController.screenSize;this.courseView.render(this.gameWorld.course,t),this.updateCarView()}updateCarView(){this.carView.update(this.car,this.courseView.matrix,this.gameWorld.course.size.x)}onTicker(t){this.car.update(),this.gameWorld.step(t),this.updateCarView(),this.updateTextInfo()}updateTextInfo(){const t=null==this.car.startSec?(0,h.formatLapTime)():(0,h.formatLapTime)(this.gameWorld.totalSec-this.car.startSec);this.textEl.text(`Lap: ${t}　　　Last: ${(0,h.formatLapTime)(this.car.lastLapTime)}　　　Best: ${(0,h.formatLapTime)(this.car.bestLapTime)}`)}}e.GameScene=_},728:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TitleScene=void 0;const o=i(923),s=i(220),n=i(529),r=i(177),a=i(714),m=i(501),c=i(147);class h extends r.Scene{constructor(t){super(t,"title-scene"),this.element.append($('<div class="content">').append($("<h1>").text("2D物理エンジンレースカー進化シミュレーター"),$('<div class="copyright">Copyright (C) 2025 <a href="https://takabosoft.com/" target="_blank">Takabo Soft</a></div>'),this.buildCoursePanel(new s.Course01(void 0)),this.buildCoursePanel(new s.Course02(void 0)),$('<div class="description">よくある「遺伝的アルゴリズムを用いてロボットレースカーが速くなっていくのを眺めるだけ」のゲームです。\n                        （ちょっと虫感が強くなってしまいました！）\n                        ロボットは前方の障害物の距離がいくつのときにどれだけハンドルを切るか...といったようなパラメータを遺伝子として組み替えながら次世代へ繋いでいきます。\n                        アクセルはベタ踏みです。\n        \n                        人間が操作できるモードも用意いたしました。\n                        \n                        動作環境：Chrome/Edge + 大きめのモニター\n                        ソースコード：<a href="https://github.com/takabosoft/2d-evolution-racer" target="_blank">https://github.com/takabosoft/2d-evolution-racer</a>\n                        2D物理エンジン：<a href="https://github.com/piqnt/planck.js">planck.js Copyright (c) Erin Catto, Ali Shakiba</a>\n                    </div>\n                    \n                    <div class="description"><input type="checkbox" id="sound"/><label for="sound">効果音を鳴らす（※音量注意）</label></div>'))),this.element.find("#sound").prop("checked",c.soundManager.enable).on("change",(t=>{c.soundManager.enable=$(t.target).prop("checked"),c.soundManager.enable&&c.soundManager.playButtonTap()}))}buildCoursePanel(t){const e=new n.CourseView;return e.render(t,new o.Vec2(400,240)),$('<div class="course-panel">').append(e.canvas.canvas,$('<div class="info">').append($('<div class="title">').text(t.name),$('<button class="play-button">').text("遺伝的アルゴリズムの様子を見る").on("click",(e=>{c.soundManager.playButtonTap(),this.sceneController.changeScene(new m.GeneticGameScene(this.sceneController,t.courseId))})),$('<button class="play-button">').text("自分で操作する").on("click",(e=>{c.soundManager.playButtonTap(),this.sceneController.changeScene(new a.GameScene(this.sceneController,t.courseId))}))))}}e.TitleScene=h},742:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GameWorld=void 0;const o=i(923),s=i(995),n=i(623),r=i(220);e.GameWorld=class{constructor(t){this.world=new o.World({gravity:new o.Vec2(0,0)}),this._totalSec=0,this.course=r.Course.fromId(t,this.world),this.world.on("begin-contact",(t=>{const e=t.getFixtureA().getUserData(),i=t.getFixtureB().getUserData();e instanceof s.Car?i instanceof n.CheckPoint&&e.onCheckPoint(i.index,this._totalSec,this.course.checkPointCount):i instanceof s.Car&&e instanceof n.CheckPoint&&i.onCheckPoint(e.index,this._totalSec,this.course.checkPointCount)}))}get totalSec(){return this._totalSec}step(t){t=Math.min(t,1/30),this._totalSec+=t,this.world.step(t)}resetTotalSec(){this._totalSec=0}}},810:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TinyCanvas=void 0;const o=i(422);class s extends o.Component{constructor(){super(),this.element=$("<canvas>"),this.canvas=this.element[0],this.ctx=this.canvas.getContext("2d")}set size(t){this.canvas.width=t.x,this.canvas.height=t.y,this.element.css({width:t.x,height:t.y})}clear(){const t=this.ctx.getTransform();this.ctx.resetTransform(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.setTransform(t)}}e.TinyCanvas=s},851:function(t,e,i){"use strict";var o=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))((function(s,n){function r(t){try{m(o.next(t))}catch(t){n(t)}}function a(t){try{m(o.throw(t))}catch(t){n(t)}}function m(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}m((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const s=i(241),n=i(948),r=i(728);$((()=>(new a).start()));class a{constructor(){this.sceneController=new s.SceneController}start(){return o(this,void 0,void 0,(function*(){$(document.body).append(this.sceneController.element),yield n.spriteSheet.load(),this.sceneController.changeScene(new r.TitleScene(this.sceneController))}))}}},871:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.rndRange=function(t,e){const i=Math.random();return t*(1-i)+e*i}},923:function(t,e){!function(t){"use strict";var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,i)};function i(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}var o=function(){return o=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var s in e=arguments[i])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},o.apply(this,arguments)},s=function(t,e){null==t&&(t={});var i=o({},t);for(var s in e)e.hasOwnProperty(s)&&void 0===t[s]&&(i[s]=e[s]);if("function"==typeof Object.getOwnPropertySymbols)for(var n=Object.getOwnPropertySymbols(e),r=0;r<n.length;r++){var a=n[r];e.propertyIsEnumerable(a)&&void 0===t[a]&&(i[a]=e[a])}return i},n=Math.random,r=1e-9,a=Number.isFinite;function m(t,e,i){return void 0===e?(i=1,e=0):void 0===i&&(i=e,e=0),i>e?(t=(t-e)%(i-e))+(t<0?i:e):(t=(t-i)%(e-i))+(t<=0?e:i)}function c(t,e,i){return t<e?e:t>i?i:t}var h=Object.create(Math);h.EPSILON=r,h.isFinite=a,h.nextPowerOfTwo=function(t){return t|=t>>1,t|=t>>2,t|=t>>4,1+((t|=t>>8)|t>>16)},h.isPowerOfTwo=function(t){return t>0&&!(t&t-1)},h.mod=m,h.clamp=c,h.random=function(t,e){return void 0===t?(e=1,t=0):void 0===e&&(e=t,t=0),t===e?t:n()*(e-t)+t};var l=Math.abs,_=Math.sqrt,u=Math.max,p=Math.min,y=function(){function t(e,i){if(!(this instanceof t))return new t(e,i);void 0===e?(this.x=0,this.y=0):"object"==typeof e?(this.x=e.x,this.y=e.y):(this.x=e,this.y=i)}return t.prototype._serialize=function(){return{x:this.x,y:this.y}},t._deserialize=function(e){var i=Object.create(t.prototype);return i.x=e.x,i.y=e.y,i},t.zero=function(){var e=Object.create(t.prototype);return e.x=0,e.y=0,e},t.neo=function(e,i){var o=Object.create(t.prototype);return o.x=e,o.y=i,o},t.clone=function(e){return t.neo(e.x,e.y)},t.prototype.toString=function(){return JSON.stringify(this)},t.isValid=function(t){return null!=t&&Number.isFinite(t.x)&&Number.isFinite(t.y)},t.assert=function(t){},t.prototype.clone=function(){return t.clone(this)},t.prototype.setZero=function(){return this.x=0,this.y=0,this},t.prototype.set=function(t,e){return"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),this},t.prototype.setNum=function(t,e){return this.x=t,this.y=e,this},t.prototype.setVec2=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.wSet=function(t,e,i,o){return void 0!==i||void 0!==o?this.setCombine(t,e,i,o):this.setMul(t,e)},t.prototype.setCombine=function(t,e,i,o){var s=t*e.x+i*o.x,n=t*e.y+i*o.y;return this.x=s,this.y=n,this},t.prototype.setMul=function(t,e){var i=t*e.x,o=t*e.y;return this.x=i,this.y=o,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.wAdd=function(t,e,i,o){return void 0!==i||void 0!==o?this.addCombine(t,e,i,o):this.addMul(t,e)},t.prototype.addCombine=function(t,e,i,o){var s=t*e.x+i*o.x,n=t*e.y+i*o.y;return this.x+=s,this.y+=n,this},t.prototype.addMul=function(t,e){var i=t*e.x,o=t*e.y;return this.x+=i,this.y+=o,this},t.prototype.wSub=function(t,e,i,o){return void 0!==i||void 0!==o?this.subCombine(t,e,i,o):this.subMul(t,e)},t.prototype.subCombine=function(t,e,i,o){var s=t*e.x+i*o.x,n=t*e.y+i*o.y;return this.x-=s,this.y-=n,this},t.prototype.subMul=function(t,e){var i=t*e.x,o=t*e.y;return this.x-=i,this.y-=o,this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.mul=function(t){return this.x*=t,this.y*=t,this},t.prototype.length=function(){return t.lengthOf(this)},t.prototype.lengthSquared=function(){return t.lengthSquared(this)},t.prototype.normalize=function(){var t=this.length();if(t<r)return 0;var e=1/t;return this.x*=e,this.y*=e,t},t.normalize=function(e){var i=t.lengthOf(e);if(i<r)return t.zero();var o=1/i;return t.neo(e.x*o,e.y*o)},t.lengthOf=function(t){return _(t.x*t.x+t.y*t.y)},t.lengthSquared=function(t){return t.x*t.x+t.y*t.y},t.distance=function(t,e){var i=t.x-e.x,o=t.y-e.y;return _(i*i+o*o)},t.distanceSquared=function(t,e){var i=t.x-e.x,o=t.y-e.y;return i*i+o*o},t.areEqual=function(t,e){return t===e||"object"==typeof e&&null!==e&&t.x===e.x&&t.y===e.y},t.skew=function(e){return t.neo(-e.y,e.x)},t.dot=function(t,e){return t.x*e.x+t.y*e.y},t.cross=function(e,i){return"number"==typeof i?t.neo(i*e.y,-i*e.x):"number"==typeof e?t.neo(-e*i.y,e*i.x):e.x*i.y-e.y*i.x},t.crossVec2Vec2=function(t,e){return t.x*e.y-t.y*e.x},t.crossVec2Num=function(e,i){return t.neo(i*e.y,-i*e.x)},t.crossNumVec2=function(e,i){return t.neo(-e*i.y,e*i.x)},t.addCross=function(e,i,o){return"number"==typeof o?t.neo(o*i.y+e.x,-o*i.x+e.y):"number"==typeof i?t.neo(-i*o.y+e.x,i*o.x+e.y):void 0},t.addCrossVec2Num=function(e,i,o){return t.neo(o*i.y+e.x,-o*i.x+e.y)},t.addCrossNumVec2=function(e,i,o){return t.neo(-i*o.y+e.x,i*o.x+e.y)},t.add=function(e,i){return t.neo(e.x+i.x,e.y+i.y)},t.wAdd=function(e,i,o,s){return void 0!==o||void 0!==s?t.combine(e,i,o,s):t.mulNumVec2(e,i)},t.combine=function(e,i,o,s){return t.zero().setCombine(e,i,o,s)},t.sub=function(e,i){return t.neo(e.x-i.x,e.y-i.y)},t.mul=function(e,i){return"object"==typeof e?t.neo(e.x*i,e.y*i):"object"==typeof i?t.neo(e*i.x,e*i.y):void 0},t.mulVec2Num=function(e,i){return t.neo(e.x*i,e.y*i)},t.mulNumVec2=function(e,i){return t.neo(e*i.x,e*i.y)},t.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},t.neg=function(e){return t.neo(-e.x,-e.y)},t.abs=function(e){return t.neo(l(e.x),l(e.y))},t.mid=function(e,i){return t.neo(.5*(e.x+i.x),.5*(e.y+i.y))},t.upper=function(e,i){return t.neo(u(e.x,i.x),u(e.y,i.y))},t.lower=function(e,i){return t.neo(p(e.x,i.x),p(e.y,i.y))},t.prototype.clamp=function(t){var e=this.x*this.x+this.y*this.y;if(e>t*t){var i=t/_(e);this.x*=i,this.y*=i}return this},t.clamp=function(e,i){var o=t.neo(e.x,e.y);return o.clamp(i),o},t.clampVec2=function(t,e,i){return{x:c(t.x,null==e?void 0:e.x,null==i?void 0:i.x),y:c(t.y,null==e?void 0:e.y,null==i?void 0:i.y)}},t.scaleFn=function(e,i){return function(o){return t.neo(o.x*e,o.y*i)}},t.translateFn=function(e,i){return function(o){return t.neo(o.x+e,o.y+i)}},t}(),d=Math.max,f=Math.min,v=function(){function t(e,i){if(!(this instanceof t))return new t(e,i);this.lowerBound=y.zero(),this.upperBound=y.zero(),"object"==typeof e&&this.lowerBound.setVec2(e),"object"==typeof i?this.upperBound.setVec2(i):"object"==typeof e&&this.upperBound.setVec2(e)}return t.prototype.isValid=function(){return t.isValid(this)},t.isValid=function(t){return null!=t&&y.isValid(t.lowerBound)&&y.isValid(t.upperBound)&&y.sub(t.upperBound,t.lowerBound).lengthSquared()>=0},t.assert=function(t){},t.prototype.getCenter=function(){return y.neo(.5*(this.lowerBound.x+this.upperBound.x),.5*(this.lowerBound.y+this.upperBound.y))},t.prototype.getExtents=function(){return y.neo(.5*(this.upperBound.x-this.lowerBound.x),.5*(this.upperBound.y-this.lowerBound.y))},t.prototype.getPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+this.upperBound.y-this.lowerBound.y)},t.prototype.combine=function(t,e){e=e||this;var i=t.lowerBound,o=t.upperBound,s=e.lowerBound,n=e.upperBound,r=f(i.x,s.x),a=f(i.y,s.y),m=d(n.x,o.x),c=d(n.y,o.y);this.lowerBound.setNum(r,a),this.upperBound.setNum(m,c)},t.prototype.combinePoints=function(t,e){this.lowerBound.setNum(f(t.x,e.x),f(t.y,e.y)),this.upperBound.setNum(d(t.x,e.x),d(t.y,e.y))},t.prototype.set=function(t){this.lowerBound.setNum(t.lowerBound.x,t.lowerBound.y),this.upperBound.setNum(t.upperBound.x,t.upperBound.y)},t.prototype.contains=function(t){var e=!0;return(e=(e=(e=e&&this.lowerBound.x<=t.lowerBound.x)&&this.lowerBound.y<=t.lowerBound.y)&&t.upperBound.x<=this.upperBound.x)&&t.upperBound.y<=this.upperBound.y},t.prototype.extend=function(e){return t.extend(this,e),this},t.extend=function(t,e){return t.lowerBound.x-=e,t.lowerBound.y-=e,t.upperBound.x+=e,t.upperBound.y+=e,t},t.testOverlap=function(t,e){var i=e.lowerBound.x-t.upperBound.x,o=t.lowerBound.x-e.upperBound.x,s=e.lowerBound.y-t.upperBound.y,n=t.lowerBound.y-e.upperBound.y;return!(i>0||s>0||o>0||n>0)},t.areEqual=function(t,e){return y.areEqual(t.lowerBound,e.lowerBound)&&y.areEqual(t.upperBound,e.upperBound)},t.diff=function(t,e){var i=d(0,f(t.upperBound.x,e.upperBound.x)-d(e.lowerBound.x,t.lowerBound.x)),o=d(0,f(t.upperBound.y,e.upperBound.y)-d(e.lowerBound.y,t.lowerBound.y));return(t.upperBound.x-t.lowerBound.x)*(t.upperBound.y-t.lowerBound.y)+(e.upperBound.x-e.lowerBound.x)*(e.upperBound.y-e.lowerBound.y)-i*o},t.prototype.rayCast=function(t,e){for(var i=-1/0,o=1/0,s=e.p1,n=y.sub(e.p2,e.p1),a=y.abs(n),m=y.zero(),c="x";null!==c;c="x"===c?"y":null)if(a.x<r){if(s[c]<this.lowerBound[c]||this.upperBound[c]<s[c])return!1}else{var h=1/n[c],l=(this.lowerBound[c]-s[c])*h,_=(this.upperBound[c]-s[c])*h,u=-1;if(l>_){var p=l;l=_,_=p,u=1}if(l>i&&(m.setZero(),m[c]=u,i=l),i>(o=f(o,_)))return!1}return!(i<0||e.maxFraction<i||(t.fraction=i,t.normal=m,0))},t.prototype.toString=function(){return JSON.stringify(this)},t.combinePoints=function(t,e,i){return t.lowerBound.x=f(e.x,i.x),t.lowerBound.y=f(e.y,i.y),t.upperBound.x=d(e.x,i.x),t.upperBound.y=d(e.y,i.y),t},t.combinedPerimeter=function(t,e){var i=f(t.lowerBound.x,e.lowerBound.x),o=f(t.lowerBound.y,e.lowerBound.y);return 2*(d(t.upperBound.x,e.upperBound.x)-i+d(t.upperBound.y,e.upperBound.y)-o)},t}(),x=Math.PI,g=function(){function t(){}return Object.defineProperty(t,"polygonRadius",{get:function(){return 2*t.linearSlop},enumerable:!1,configurable:!0}),t.lengthUnitsPerMeter=1,t.maxManifoldPoints=2,t.maxPolygonVertices=12,t.aabbExtension=.1,t.aabbMultiplier=2,t.linearSlop=.005,t.angularSlop=2/180*x,t.maxSubSteps=8,t.maxTOIContacts=32,t.maxTOIIterations=20,t.maxDistanceIterations=20,t.velocityThreshold=1,t.maxLinearCorrection=.2,t.maxAngularCorrection=8/180*x,t.maxTranslation=2,t.maxRotation=.5*x,t.baumgarte=.2,t.toiBaugarte=.75,t.timeToSleep=.5,t.linearSleepTolerance=.01,t.angularSleepTolerance=2/180*x,t}(),b=function(){function t(){}return Object.defineProperty(t,"maxManifoldPoints",{get:function(){return g.maxManifoldPoints},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxPolygonVertices",{get:function(){return g.maxPolygonVertices},enumerable:!1,configurable:!0}),Object.defineProperty(t,"aabbExtension",{get:function(){return g.aabbExtension*g.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"aabbMultiplier",{get:function(){return g.aabbMultiplier},enumerable:!1,configurable:!0}),Object.defineProperty(t,"linearSlop",{get:function(){return g.linearSlop*g.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"linearSlopSquared",{get:function(){return g.linearSlop*g.lengthUnitsPerMeter*g.linearSlop*g.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"angularSlop",{get:function(){return g.angularSlop},enumerable:!1,configurable:!0}),Object.defineProperty(t,"polygonRadius",{get:function(){return 2*g.linearSlop},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxSubSteps",{get:function(){return g.maxSubSteps},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxTOIContacts",{get:function(){return g.maxTOIContacts},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxTOIIterations",{get:function(){return g.maxTOIIterations},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxDistanceIterations",{get:function(){return g.maxDistanceIterations},enumerable:!1,configurable:!0}),Object.defineProperty(t,"velocityThreshold",{get:function(){return g.velocityThreshold*g.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxLinearCorrection",{get:function(){return g.maxLinearCorrection*g.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxAngularCorrection",{get:function(){return g.maxAngularCorrection},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxTranslation",{get:function(){return g.maxTranslation*g.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxTranslationSquared",{get:function(){return g.maxTranslation*g.lengthUnitsPerMeter*g.maxTranslation*g.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxRotation",{get:function(){return g.maxRotation},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxRotationSquared",{get:function(){return g.maxRotation*g.maxRotation},enumerable:!1,configurable:!0}),Object.defineProperty(t,"baumgarte",{get:function(){return g.baumgarte},enumerable:!1,configurable:!0}),Object.defineProperty(t,"toiBaugarte",{get:function(){return g.toiBaugarte},enumerable:!1,configurable:!0}),Object.defineProperty(t,"timeToSleep",{get:function(){return g.timeToSleep},enumerable:!1,configurable:!0}),Object.defineProperty(t,"linearSleepTolerance",{get:function(){return g.linearSleepTolerance*g.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"linearSleepToleranceSqr",{get:function(){return g.linearSleepTolerance*g.lengthUnitsPerMeter*g.linearSleepTolerance*g.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(t,"angularSleepTolerance",{get:function(){return g.angularSleepTolerance},enumerable:!1,configurable:!0}),Object.defineProperty(t,"angularSleepToleranceSqr",{get:function(){return g.angularSleepTolerance*g.angularSleepTolerance},enumerable:!1,configurable:!0}),t}(),A=function(){function t(t){this._list=[],this._max=1/0,this._hasCreateFn=!1,this._createCount=0,this._hasAllocateFn=!1,this._allocateCount=0,this._hasReleaseFn=!1,this._releaseCount=0,this._hasDisposeFn=!1,this._disposeCount=0,this._list=[],this._max=t.max||this._max,this._createFn=t.create,this._hasCreateFn="function"==typeof this._createFn,this._allocateFn=t.allocate,this._hasAllocateFn="function"==typeof this._allocateFn,this._releaseFn=t.release,this._hasReleaseFn="function"==typeof this._releaseFn,this._disposeFn=t.dispose,this._hasDisposeFn="function"==typeof this._disposeFn}return t.prototype.max=function(t){return"number"==typeof t?(this._max=t,this):this._max},t.prototype.size=function(){return this._list.length},t.prototype.allocate=function(){var t;return this._list.length>0?t=this._list.shift():(this._createCount++,t=this._hasCreateFn?this._createFn():{}),this._allocateCount++,this._hasAllocateFn&&this._allocateFn(t),t},t.prototype.release=function(t){this._list.length<this._max?(this._releaseCount++,this._hasReleaseFn&&this._releaseFn(t),this._list.push(t)):(this._disposeCount++,this._hasDisposeFn&&(t=this._disposeFn(t)))},t.prototype.toString=function(){return" +"+this._createCount+" >"+this._allocateCount+" <"+this._releaseCount+" -"+this._disposeCount+" ="+this._list.length+"/"+this._max},t}(),B=Math.abs,w=Math.max,V=function(){function t(t){this.aabb=new v,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=-1,this.id=t}return t.prototype.toString=function(){return this.id+": "+this.userData},t.prototype.isLeaf=function(){return null==this.child1},t}(),C=new A({create:function(){return new V},release:function(t){t.userData=null,t.parent=null,t.child1=null,t.child2=null,t.height=-1,t.id=void 0}}),M=function(){function t(){this.inputPool=new A({create:function(){return{}},release:function(t){}}),this.stackPool=new A({create:function(){return[]},release:function(t){t.length=0}}),this.iteratorPool=new A({create:function(){return new S},release:function(t){t.close()}}),this.m_root=null,this.m_nodes={},this.m_lastProxyId=0}return t.prototype.getUserData=function(t){return this.m_nodes[t].userData},t.prototype.getFatAABB=function(t){return this.m_nodes[t].aabb},t.prototype.allocateNode=function(){var t=C.allocate();return t.id=++this.m_lastProxyId,this.m_nodes[t.id]=t,t},t.prototype.freeNode=function(t){delete this.m_nodes[t.id],C.release(t)},t.prototype.createProxy=function(t,e){var i=this.allocateNode();return i.aabb.set(t),v.extend(i.aabb,b.aabbExtension),i.userData=e,i.height=0,this.insertLeaf(i),i.id},t.prototype.destroyProxy=function(t){var e=this.m_nodes[t];this.removeLeaf(e),this.freeNode(e)},t.prototype.moveProxy=function(t,e,i){var o=this.m_nodes[t];return!o.aabb.contains(e)&&(this.removeLeaf(o),o.aabb.set(e),e=o.aabb,v.extend(e,b.aabbExtension),i.x<0?e.lowerBound.x+=i.x*b.aabbMultiplier:e.upperBound.x+=i.x*b.aabbMultiplier,i.y<0?e.lowerBound.y+=i.y*b.aabbMultiplier:e.upperBound.y+=i.y*b.aabbMultiplier,this.insertLeaf(o),!0)},t.prototype.insertLeaf=function(t){if(null==this.m_root)return this.m_root=t,void(this.m_root.parent=null);for(var e=t.aabb,i=this.m_root;!i.isLeaf();){var o=i.child1,s=i.child2,n=i.aabb.getPerimeter(),r=v.combinedPerimeter(i.aabb,e),a=2*r,m=2*(r-n),c=v.combinedPerimeter(e,o.aabb)+m;o.isLeaf()||(c-=o.aabb.getPerimeter());var h=v.combinedPerimeter(e,s.aabb)+m;if(s.isLeaf()||(h-=s.aabb.getPerimeter()),a<c&&a<h)break;i=c<h?o:s}var l=i,_=l.parent,u=this.allocateNode();for(u.parent=_,u.userData=null,u.aabb.combine(e,l.aabb),u.height=l.height+1,null!=_?(_.child1===l?_.child1=u:_.child2=u,u.child1=l,u.child2=t,l.parent=u,t.parent=u):(u.child1=l,u.child2=t,l.parent=u,t.parent=u,this.m_root=u),i=t.parent;null!=i;)o=(i=this.balance(i)).child1,s=i.child2,i.height=1+w(o.height,s.height),i.aabb.combine(o.aabb,s.aabb),i=i.parent},t.prototype.removeLeaf=function(t){if(t!==this.m_root){var e,i=t.parent,o=i.parent;if(e=i.child1===t?i.child2:i.child1,null!=o){o.child1===i?o.child1=e:o.child2=e,e.parent=o,this.freeNode(i);for(var s=o;null!=s;){var n=(s=this.balance(s)).child1,r=s.child2;s.aabb.combine(n.aabb,r.aabb),s.height=1+w(n.height,r.height),s=s.parent}}else this.m_root=e,e.parent=null,this.freeNode(i)}else this.m_root=null},t.prototype.balance=function(t){var e=t;if(e.isLeaf()||e.height<2)return t;var i=e.child1,o=e.child2,s=o.height-i.height;if(s>1){var n=o.child1,r=o.child2;return o.child1=e,o.parent=e.parent,e.parent=o,null!=o.parent?o.parent.child1===t?o.parent.child1=o:o.parent.child2=o:this.m_root=o,n.height>r.height?(o.child2=n,e.child2=r,r.parent=e,e.aabb.combine(i.aabb,r.aabb),o.aabb.combine(e.aabb,n.aabb),e.height=1+w(i.height,r.height),o.height=1+w(e.height,n.height)):(o.child2=r,e.child2=n,n.parent=e,e.aabb.combine(i.aabb,n.aabb),o.aabb.combine(e.aabb,r.aabb),e.height=1+w(i.height,n.height),o.height=1+w(e.height,r.height)),o}if(s<-1){var a=i.child1,m=i.child2;return i.child1=e,i.parent=e.parent,e.parent=i,null!=i.parent?i.parent.child1===e?i.parent.child1=i:i.parent.child2=i:this.m_root=i,a.height>m.height?(i.child2=a,e.child1=m,m.parent=e,e.aabb.combine(o.aabb,m.aabb),i.aabb.combine(e.aabb,a.aabb),e.height=1+w(o.height,m.height),i.height=1+w(e.height,a.height)):(i.child2=m,e.child1=a,a.parent=e,e.aabb.combine(o.aabb,a.aabb),i.aabb.combine(e.aabb,m.aabb),e.height=1+w(o.height,a.height),i.height=1+w(e.height,m.height)),i}return e},t.prototype.getHeight=function(){return null==this.m_root?0:this.m_root.height},t.prototype.getAreaRatio=function(){if(null==this.m_root)return 0;for(var t,e=this.m_root.aabb.getPerimeter(),i=0,o=this.iteratorPool.allocate().preorder(this.m_root);t=o.next();)t.height<0||(i+=t.aabb.getPerimeter());return this.iteratorPool.release(o),i/e},t.prototype.computeHeight=function(t){var e;if((e=void 0!==t?this.m_nodes[t]:this.m_root).isLeaf())return 0;var i=this.computeHeight(e.child1.id),o=this.computeHeight(e.child2.id);return 1+w(i,o)},t.prototype.validateStructure=function(t){if(null!=t){this.m_root;var e=t.child1,i=t.child2;t.isLeaf()||(this.validateStructure(e),this.validateStructure(i))}},t.prototype.validateMetrics=function(t){if(null!=t){var e=t.child1,i=t.child2;t.isLeaf()||(e.height,i.height,(new v).combine(e.aabb,i.aabb),this.validateMetrics(e),this.validateMetrics(i))}},t.prototype.validate=function(){},t.prototype.getMaxBalance=function(){for(var t,e=0,i=this.iteratorPool.allocate().preorder(this.m_root);t=i.next();)if(!(t.height<=1)){var o=B(t.child2.height-t.child1.height);e=w(e,o)}return this.iteratorPool.release(i),e},t.prototype.rebuildBottomUp=function(){for(var t,e=[],i=0,o=this.iteratorPool.allocate().preorder(this.m_root);t=o.next();)t.height<0||(t.isLeaf()?(t.parent=null,e[i]=t,++i):this.freeNode(t));for(this.iteratorPool.release(o);i>1;){for(var s=1/0,n=-1,r=-1,a=0;a<i;++a)for(var m=e[a].aabb,c=a+1;c<i;++c){var h=e[c].aabb,l=v.combinedPerimeter(m,h);l<s&&(n=a,r=c,s=l)}var _=e[n],u=e[r],p=this.allocateNode();p.child1=_,p.child2=u,p.height=1+w(_.height,u.height),p.aabb.combine(_.aabb,u.aabb),p.parent=null,_.parent=p,u.parent=p,e[r]=e[i-1],e[n]=p,--i}this.m_root=e[0]},t.prototype.shiftOrigin=function(t){for(var e,i=this.iteratorPool.allocate().preorder(this.m_root);e=i.next();){var o=e.aabb;o.lowerBound.x-=t.x,o.lowerBound.y-=t.y,o.upperBound.x-=t.x,o.upperBound.y-=t.y}this.iteratorPool.release(i)},t.prototype.query=function(t,e){var i=this.stackPool.allocate();for(i.push(this.m_root);i.length>0;){var o=i.pop();if(null!=o&&v.testOverlap(o.aabb,t))if(o.isLeaf()){if(!1===e(o.id))return}else i.push(o.child1),i.push(o.child2)}this.stackPool.release(i)},t.prototype.rayCast=function(t,e){var i=t.p1,o=t.p2,s=y.sub(o,i);s.normalize();var n=y.crossNumVec2(1,s),r=y.abs(n),a=t.maxFraction,m=new v,c=y.combine(1-a,i,a,o);m.combinePoints(i,c);var h=this.stackPool.allocate(),l=this.inputPool.allocate();for(h.push(this.m_root);h.length>0;){var _=h.pop();if(null!=_&&!1!==v.testOverlap(_.aabb,m)){var u=_.aabb.getCenter(),p=_.aabb.getExtents();if(!(B(y.dot(n,y.sub(i,u)))-y.dot(r,p)>0))if(_.isLeaf()){l.p1=y.clone(t.p1),l.p2=y.clone(t.p2),l.maxFraction=a;var d=e(l,_.id);if(0===d)break;d>0&&(a=d,c=y.combine(1-a,i,a,o),m.combinePoints(i,c))}else h.push(_.child1),h.push(_.child2)}}this.stackPool.release(h),this.inputPool.release(l)},t}(),S=function(){function t(){this.parents=[],this.states=[]}return t.prototype.preorder=function(t){return this.parents.length=0,this.parents.push(t),this.states.length=0,this.states.push(0),this},t.prototype.next=function(){for(;this.parents.length>0;){var t=this.parents.length-1,e=this.parents[t];if(0===this.states[t])return this.states[t]=1,e;if(1===this.states[t]&&(this.states[t]=2,e.child1))return this.parents.push(e.child1),this.states.push(1),e.child1;if(2===this.states[t]&&(this.states[t]=3,e.child2))return this.parents.push(e.child2),this.states.push(1),e.child2;this.parents.pop(),this.states.pop()}},t.prototype.close=function(){this.parents.length=0},t}(),T=Math.max,P=Math.min,I=function(){function t(){var t=this;this.m_tree=new M,this.m_moveBuffer=[],this.query=function(e,i){t.m_tree.query(e,i)},this.queryCallback=function(e){if(e===t.m_queryProxyId)return!0;var i=P(e,t.m_queryProxyId),o=T(e,t.m_queryProxyId),s=t.m_tree.getUserData(i),n=t.m_tree.getUserData(o);return t.m_callback(s,n),!0}}return t.prototype.getUserData=function(t){return this.m_tree.getUserData(t)},t.prototype.testOverlap=function(t,e){var i=this.m_tree.getFatAABB(t),o=this.m_tree.getFatAABB(e);return v.testOverlap(i,o)},t.prototype.getFatAABB=function(t){return this.m_tree.getFatAABB(t)},t.prototype.getProxyCount=function(){return this.m_moveBuffer.length},t.prototype.getTreeHeight=function(){return this.m_tree.getHeight()},t.prototype.getTreeBalance=function(){return this.m_tree.getMaxBalance()},t.prototype.getTreeQuality=function(){return this.m_tree.getAreaRatio()},t.prototype.rayCast=function(t,e){this.m_tree.rayCast(t,e)},t.prototype.shiftOrigin=function(t){this.m_tree.shiftOrigin(t)},t.prototype.createProxy=function(t,e){var i=this.m_tree.createProxy(t,e);return this.bufferMove(i),i},t.prototype.destroyProxy=function(t){this.unbufferMove(t),this.m_tree.destroyProxy(t)},t.prototype.moveProxy=function(t,e,i){this.m_tree.moveProxy(t,e,i)&&this.bufferMove(t)},t.prototype.touchProxy=function(t){this.bufferMove(t)},t.prototype.bufferMove=function(t){this.m_moveBuffer.push(t)},t.prototype.unbufferMove=function(t){for(var e=0;e<this.m_moveBuffer.length;++e)this.m_moveBuffer[e]===t&&(this.m_moveBuffer[e]=null)},t.prototype.updatePairs=function(t){for(this.m_callback=t;this.m_moveBuffer.length>0;)if(this.m_queryProxyId=this.m_moveBuffer.pop(),null!==this.m_queryProxyId){var e=this.m_tree.getFatAABB(this.m_queryProxyId);this.m_tree.query(e,this.queryCallback)}},t}(),z=Math.sin,F=Math.cos,L=Math.sqrt;function q(t,e){return{x:t,y:e}}function k(t,e,i){return t.x=e,t.y=i,t}function D(t,e){return t.x=e.x,t.y=e.y,t}function R(t){return t.x=0,t.y=0,t}function O(t){return t.x=-t.x,t.y=-t.y,t}function N(t,e){return t.x+=e.x,t.y+=e.y,t}function j(t,e){return t.x-=e.x,t.y-=e.y,t}function E(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t}function W(t,e){return t.x*=e,t.y*=e,t}function J(t,e,i){return t.x=e*i.x,t.y=e*i.y,t}function Y(t,e,i){return t.x+=e*i.x,t.y+=e*i.y,t}function H(t,e,i){return t.x-=e*i.x,t.y-=e*i.y,t}function U(t,e,i,o,s){return t.x=e*i.x+o*s.x,t.y=e*i.y+o*s.y,t}function $(t,e,i,o,s,n,r){return t.x=e*i.x+o*s.x+n*r.x,t.y=e*i.y+o*s.y+n*r.y,t}function G(t){var e=L(t.x*t.x+t.y*t.y);if(e>0){var i=1/e;t.x*=i,t.y*=i}return t}function K(t,e,i){var o=i*e.y,s=-i*e.x;return t.x=o,t.y=s,t}function X(t,e,i){var o=-e*i.y,s=e*i.x;return t.x=o,t.y=s,t}function Z(t,e){return t.x*e.y-t.y*e.x}function Q(t,e){return t.x*e.x+t.y*e.y}function tt(t){return t.x*t.x+t.y*t.y}function et(t,e){var i=t.x-e.x,o=t.y-e.y;return L(i*i+o*o)}function it(t,e){var i=t.x-e.x,o=t.y-e.y;return i*i+o*o}function ot(t,e,i){return t.x=e.c*i.x-e.s*i.y,t.y=e.s*i.x+e.c*i.y,t}function st(t,e,i){var o=e.c*i.x+e.s*i.y,s=-e.s*i.x+e.c*i.y;return t.x=o,t.y=s,t}function nt(t,e,i){return{p:q(t,e),q:(o=i,{s:z(o),c:F(o)})};var o}function rt(t,e){return t.p.x=e.p.x,t.p.y=e.p.y,t.q.s=e.q.s,t.q.c=e.q.c,t}function at(t,e,i){var o=e.q.c*i.x-e.q.s*i.y+e.p.x,s=e.q.s*i.x+e.q.c*i.y+e.p.y;return t.x=o,t.y=s,t}function mt(t,e,i){var o=i.x-e.p.x,s=i.y-e.p.y,n=e.q.c*o+e.q.s*s,r=-e.q.s*o+e.q.c*s;return t.x=n,t.y=r,t}function ct(t,e,i,o){var s=e.q.c*o.x-e.q.s*o.y+e.p.x,n=e.q.s*o.x+e.q.c*o.y+e.p.y,r=s-i.p.x,a=n-i.p.y,m=i.q.c*r+i.q.s*a,c=-i.q.s*r+i.q.c*a;return t.x=m,t.y=c,t}function ht(t,e,i){var o=e.q.c*i.q.c+e.q.s*i.q.s,s=e.q.c*i.q.s-e.q.s*i.q.c,n=e.q.c*(i.p.x-e.p.x)+e.q.s*(i.p.y-e.p.y),r=-e.q.s*(i.p.x-e.p.x)+e.q.c*(i.p.y-e.p.y);return t.q.c=o,t.q.s=s,t.p.x=n,t.p.y=r,t}var lt=Math.sin,_t=Math.cos,ut=Math.atan2,pt=function(){function t(e){if(!(this instanceof t))return new t(e);"number"==typeof e?this.setAngle(e):"object"==typeof e?this.setRot(e):this.setIdentity()}return t.neo=function(e){var i=Object.create(t.prototype);return i.setAngle(e),i},t.clone=function(e){var i=Object.create(t.prototype);return i.s=e.s,i.c=e.c,i},t.identity=function(){var e=Object.create(t.prototype);return e.s=0,e.c=1,e},t.isValid=function(t){return null!=t&&Number.isFinite(t.s)&&Number.isFinite(t.c)},t.assert=function(t){},t.prototype.setIdentity=function(){this.s=0,this.c=1},t.prototype.set=function(t){"object"==typeof t?(this.s=t.s,this.c=t.c):(this.s=lt(t),this.c=_t(t))},t.prototype.setRot=function(t){this.s=t.s,this.c=t.c},t.prototype.setAngle=function(t){this.s=lt(t),this.c=_t(t)},t.prototype.getAngle=function(){return ut(this.s,this.c)},t.prototype.getXAxis=function(){return y.neo(this.c,this.s)},t.prototype.getYAxis=function(){return y.neo(-this.s,this.c)},t.mul=function(e,i){if("c"in i&&"s"in i){var o=t.identity();return o.s=e.s*i.c+e.c*i.s,o.c=e.c*i.c-e.s*i.s,o}if("x"in i&&"y"in i)return y.neo(e.c*i.x-e.s*i.y,e.s*i.x+e.c*i.y)},t.mulRot=function(e,i){var o=t.identity();return o.s=e.s*i.c+e.c*i.s,o.c=e.c*i.c-e.s*i.s,o},t.mulVec2=function(t,e){return y.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)},t.mulSub=function(t,e,i){var o=t.c*(e.x-i.x)-t.s*(e.y-i.y),s=t.s*(e.x-i.x)+t.c*(e.y-i.y);return y.neo(o,s)},t.mulT=function(e,i){if("c"in i&&"s"in i){var o=t.identity();return o.s=e.c*i.s-e.s*i.c,o.c=e.c*i.c+e.s*i.s,o}if("x"in i&&"y"in i)return y.neo(e.c*i.x+e.s*i.y,-e.s*i.x+e.c*i.y)},t.mulTRot=function(e,i){var o=t.identity();return o.s=e.c*i.s-e.s*i.c,o.c=e.c*i.c+e.s*i.s,o},t.mulTVec2=function(t,e){return y.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)},t}(),yt=Math.atan2,dt=Math.PI,ft=q(0,0),vt=function(){function t(){this.localCenter=y.zero(),this.c=y.zero(),this.a=0,this.alpha0=0,this.c0=y.zero(),this.a0=0}return t.prototype.recycle=function(){R(this.localCenter),R(this.c),this.a=0,this.alpha0=0,R(this.c0),this.a0=0},t.prototype.setTransform=function(t){at(ft,t,this.localCenter),D(this.c,ft),D(this.c0,ft),this.a=this.a0=yt(t.q.s,t.q.c)},t.prototype.setLocalCenter=function(t,e){D(this.localCenter,t),at(ft,e,this.localCenter),D(this.c,ft),D(this.c0,ft)},t.prototype.getTransform=function(t,e){var i,o;void 0===e&&(e=0),i=t.q,o=(1-e)*this.a0+e*this.a,i.c=F(o),i.s=z(o),U(t.p,1-e,this.c0,e,this.c),j(t.p,ot(ft,t.q,this.localCenter))},t.prototype.advance=function(t){var e=(t-this.alpha0)/(1-this.alpha0);U(this.c0,e,this.c,1-e,this.c0),this.a0=e*this.a+(1-e)*this.a0,this.alpha0=t},t.prototype.forward=function(){this.a0=this.a,D(this.c0,this.c)},t.prototype.normalize=function(){var t=m(this.a0,-dt,+dt);this.a-=this.a0-t,this.a0=t},t.prototype.set=function(t){D(this.localCenter,t.localCenter),D(this.c,t.c),this.a=t.a,this.alpha0=t.alpha0,D(this.c0,t.c0),this.a0=t.a0},t}(),xt=function(){function t(e,i){if(!(this instanceof t))return new t(e,i);this.p=y.zero(),this.q=pt.identity(),void 0!==e&&this.p.setVec2(e),void 0!==i&&this.q.setAngle(i)}return t.clone=function(e){var i=Object.create(t.prototype);return i.p=y.clone(e.p),i.q=pt.clone(e.q),i},t.neo=function(e,i){var o=Object.create(t.prototype);return o.p=y.clone(e),o.q=pt.clone(i),o},t.identity=function(){var e=Object.create(t.prototype);return e.p=y.zero(),e.q=pt.identity(),e},t.prototype.setIdentity=function(){this.p.setZero(),this.q.setIdentity()},t.prototype.set=function(t,e){void 0===e?(this.p.set(t.p),this.q.set(t.q)):(this.p.set(t),this.q.set(e))},t.prototype.setNum=function(t,e){this.p.setVec2(t),this.q.setAngle(e)},t.prototype.setTransform=function(t){this.p.setVec2(t.p),this.q.setRot(t.q)},t.isValid=function(t){return null!=t&&y.isValid(t.p)&&pt.isValid(t.q)},t.assert=function(t){},t.mul=function(e,i){if(Array.isArray(i)){for(var o=[],s=0;s<i.length;s++)o[s]=t.mul(e,i[s]);return o}return"x"in i&&"y"in i?t.mulVec2(e,i):"p"in i&&"q"in i?t.mulXf(e,i):void 0},t.mulAll=function(e,i){for(var o=[],s=0;s<i.length;s++)o[s]=t.mul(e,i[s]);return o},t.mulFn=function(e){return function(i){return t.mul(e,i)}},t.mulVec2=function(t,e){var i=t.q.c*e.x-t.q.s*e.y+t.p.x,o=t.q.s*e.x+t.q.c*e.y+t.p.y;return y.neo(i,o)},t.mulXf=function(e,i){var o=t.identity();return o.q=pt.mulRot(e.q,i.q),o.p=y.add(pt.mulVec2(e.q,i.p),e.p),o},t.mulT=function(e,i){return"x"in i&&"y"in i?t.mulTVec2(e,i):"p"in i&&"q"in i?t.mulTXf(e,i):void 0},t.mulTVec2=function(t,e){var i=e.x-t.p.x,o=e.y-t.p.y,s=t.q.c*i+t.q.s*o,n=-t.q.s*i+t.q.c*o;return y.neo(s,n)},t.mulTXf=function(e,i){var o=t.identity();return o.q.setRot(pt.mulTRot(e.q,i.q)),o.p.setVec2(pt.mulTVec2(e.q,y.sub(i.p,e.p))),o},t}(),gt=function(){return function(){this.v=y.zero(),this.w=0}}(),bt=Math.sin,At=Math.cos,Bt=function(){function t(){this.c=y.zero(),this.a=0}return t.prototype.getTransform=function(t,e){return t.q.c=At(this.a),t.q.s=bt(this.a),t.p.x=this.c.x-(t.q.c*e.x-t.q.s*e.y),t.p.y=this.c.y-(t.q.s*e.x+t.q.c*e.y),t},t}();function wt(t,e,i,o){return t.q.c=At(o),t.q.s=bt(o),t.p.x=i.x-(t.q.c*e.x-t.q.s*e.y),t.p.y=i.y-(t.q.s*e.x+t.q.c*e.y),t}var Vt=function(){function t(){this.style={},this.appData={}}return t.isValid=function(t){return null!=t&&"string"==typeof t.m_type&&"number"==typeof t.m_radius},t}(),Ct=new v,Mt=new v,St=q(0,0),Tt={userData:null,friction:.2,restitution:0,density:0,isSensor:!1,filterGroupIndex:0,filterCategoryBits:1,filterMaskBits:65535},Pt=function(){return function(t,e){this.aabb=new v,this.fixture=t,this.childIndex=e}}(),It=function(){function t(t,e,i){this.style={},this.appData={},e.shape?(i=e,e=e.shape):"number"==typeof i&&(i={density:i}),i=s(i,Tt),this.m_body=t,this.m_friction=i.friction,this.m_restitution=i.restitution,this.m_density=i.density,this.m_isSensor=i.isSensor,this.m_filterGroupIndex=i.filterGroupIndex,this.m_filterCategoryBits=i.filterCategoryBits,this.m_filterMaskBits=i.filterMaskBits,this.m_shape=e,this.m_next=null,this.m_proxies=[],this.m_proxyCount=0;for(var o=this.m_shape.getChildCount(),n=0;n<o;++n)this.m_proxies[n]=new Pt(this,n);this.m_userData=i.userData,"object"==typeof i.style&&null!==i.style&&(this.style=i.style)}return t.prototype._reset=function(){var t=this.getBody(),e=t.m_world.m_broadPhase;this.destroyProxies(e),this.m_shape._reset&&this.m_shape._reset();for(var i=this.m_shape.getChildCount(),o=0;o<i;++o)this.m_proxies[o]=new Pt(this,o);this.createProxies(e,t.m_xf),t.resetMassData()},t.prototype._serialize=function(){return{friction:this.m_friction,restitution:this.m_restitution,density:this.m_density,isSensor:this.m_isSensor,filterGroupIndex:this.m_filterGroupIndex,filterCategoryBits:this.m_filterCategoryBits,filterMaskBits:this.m_filterMaskBits,shape:this.m_shape}},t._deserialize=function(e,i,o){var s=o(Vt,e.shape);return s&&new t(i,s,e)},t.prototype.getType=function(){return this.m_shape.m_type},t.prototype.getShape=function(){return this.m_shape},t.prototype.isSensor=function(){return this.m_isSensor},t.prototype.setSensor=function(t){t!=this.m_isSensor&&(this.m_body.setAwake(!0),this.m_isSensor=t)},t.prototype.getUserData=function(){return this.m_userData},t.prototype.setUserData=function(t){this.m_userData=t},t.prototype.getBody=function(){return this.m_body},t.prototype.getNext=function(){return this.m_next},t.prototype.getDensity=function(){return this.m_density},t.prototype.setDensity=function(t){this.m_density=t},t.prototype.getFriction=function(){return this.m_friction},t.prototype.setFriction=function(t){this.m_friction=t},t.prototype.getRestitution=function(){return this.m_restitution},t.prototype.setRestitution=function(t){this.m_restitution=t},t.prototype.testPoint=function(t){return this.m_shape.testPoint(this.m_body.getTransform(),t)},t.prototype.rayCast=function(t,e,i){return this.m_shape.rayCast(t,e,this.m_body.getTransform(),i)},t.prototype.getMassData=function(t){this.m_shape.computeMass(t,this.m_density)},t.prototype.getAABB=function(t){return this.m_proxies[t].aabb},t.prototype.createProxies=function(t,e){this.m_proxyCount=this.m_shape.getChildCount();for(var i=0;i<this.m_proxyCount;++i){var o=this.m_proxies[i];this.m_shape.computeAABB(o.aabb,e,i),o.proxyId=t.createProxy(o.aabb,o)}},t.prototype.destroyProxies=function(t){for(var e=0;e<this.m_proxyCount;++e){var i=this.m_proxies[e];t.destroyProxy(i.proxyId),i.proxyId=null}this.m_proxyCount=0},t.prototype.synchronize=function(t,e,i){for(var o=0;o<this.m_proxyCount;++o){var s=this.m_proxies[o];this.m_shape.computeAABB(Ct,e,s.childIndex),this.m_shape.computeAABB(Mt,i,s.childIndex),s.aabb.combine(Ct,Mt),E(St,i.p,e.p),t.moveProxy(s.proxyId,s.aabb,St)}},t.prototype.setFilterData=function(t){this.m_filterGroupIndex=t.groupIndex,this.m_filterCategoryBits=t.categoryBits,this.m_filterMaskBits=t.maskBits,this.refilter()},t.prototype.getFilterGroupIndex=function(){return this.m_filterGroupIndex},t.prototype.setFilterGroupIndex=function(t){this.m_filterGroupIndex=t,this.refilter()},t.prototype.getFilterCategoryBits=function(){return this.m_filterCategoryBits},t.prototype.setFilterCategoryBits=function(t){this.m_filterCategoryBits=t,this.refilter()},t.prototype.getFilterMaskBits=function(){return this.m_filterMaskBits},t.prototype.setFilterMaskBits=function(t){this.m_filterMaskBits=t,this.refilter()},t.prototype.refilter=function(){if(null!=this.m_body){for(var t=this.m_body.getContactList();t;){var e=t.contact,i=e.getFixtureA(),o=e.getFixtureB();i!=this&&o!=this||e.flagForFiltering(),t=t.next}var s=this.m_body.getWorld();if(null!=s)for(var n=s.m_broadPhase,r=0;r<this.m_proxyCount;++r)n.touchProxy(this.m_proxies[r].proxyId)}},t.prototype.shouldCollide=function(t){if(t.m_filterGroupIndex===this.m_filterGroupIndex&&0!==t.m_filterGroupIndex)return t.m_filterGroupIndex>0;var e=!!(t.m_filterMaskBits&this.m_filterCategoryBits),i=!!(t.m_filterCategoryBits&this.m_filterMaskBits);return e&&i},t}(),zt="static",Ft="kinematic",Lt="dynamic",qt=q(0,0),kt=q(0,0),Dt=q(0,0),Rt=q(0,0),Ot=nt(0,0,0),Nt={type:zt,position:y.zero(),angle:0,linearVelocity:y.zero(),angularVelocity:0,linearDamping:0,angularDamping:0,fixedRotation:!1,bullet:!1,gravityScale:1,allowSleep:!0,awake:!0,active:!0,userData:null},jt=function(){function t(t,e){this.style={},this.appData={},e=s(e,Nt),this.m_world=t,this.m_awakeFlag=e.awake,this.m_autoSleepFlag=e.allowSleep,this.m_bulletFlag=e.bullet,this.m_fixedRotationFlag=e.fixedRotation,this.m_activeFlag=e.active,this.m_islandFlag=!1,this.m_toiFlag=!1,this.m_userData=e.userData,this.m_type=e.type,this.m_type==Lt?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_xf=xt.identity(),this.m_xf.p.setVec2(e.position),this.m_xf.q.setAngle(e.angle),this.m_sweep=new vt,this.m_sweep.setTransform(this.m_xf),this.c_velocity=new gt,this.c_position=new Bt,this.m_force=y.zero(),this.m_torque=0,this.m_linearVelocity=y.clone(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_gravityScale=e.gravityScale,this.m_sleepTime=0,this.m_jointList=null,this.m_contactList=null,this.m_fixtureList=null,this.m_prev=null,this.m_next=null,this.m_destroyed=!1,"object"==typeof e.style&&null!==e.style&&(this.style=e.style)}return t.prototype._serialize=function(){for(var t=[],e=this.m_fixtureList;e;e=e.m_next)t.push(e);return{type:this.m_type,bullet:this.m_bulletFlag,position:this.m_xf.p,angle:this.m_xf.q.getAngle(),linearVelocity:this.m_linearVelocity,angularVelocity:this.m_angularVelocity,fixtures:t}},t._deserialize=function(e,i,o){var s=new t(i,e);if(e.fixtures)for(var n=e.fixtures.length-1;n>=0;n--){var r=o(It,e.fixtures[n],s);s._addFixture(r)}return s},t.prototype.isWorldLocked=function(){return!(!this.m_world||!this.m_world.isLocked())},t.prototype.getWorld=function(){return this.m_world},t.prototype.getNext=function(){return this.m_next},t.prototype.setUserData=function(t){this.m_userData=t},t.prototype.getUserData=function(){return this.m_userData},t.prototype.getFixtureList=function(){return this.m_fixtureList},t.prototype.getJointList=function(){return this.m_jointList},t.prototype.getContactList=function(){return this.m_contactList},t.prototype.isStatic=function(){return this.m_type==zt},t.prototype.isDynamic=function(){return this.m_type==Lt},t.prototype.isKinematic=function(){return this.m_type==Ft},t.prototype.setStatic=function(){return this.setType(zt),this},t.prototype.setDynamic=function(){return this.setType(Lt),this},t.prototype.setKinematic=function(){return this.setType(Ft),this},t.prototype.getType=function(){return this.m_type},t.prototype.setType=function(t){if(1!=this.isWorldLocked()&&this.m_type!=t){this.m_type=t,this.resetMassData(),this.m_type==zt&&(this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_sweep.forward(),this.synchronizeFixtures()),this.setAwake(!0),this.m_force.setZero(),this.m_torque=0;for(var e=this.m_contactList;e;){var i=e;e=e.next,this.m_world.destroyContact(i.contact)}this.m_contactList=null;for(var o=this.m_world.m_broadPhase,s=this.m_fixtureList;s;s=s.m_next)for(var n=0;n<s.m_proxyCount;++n)o.touchProxy(s.m_proxies[n].proxyId)}},t.prototype.isBullet=function(){return this.m_bulletFlag},t.prototype.setBullet=function(t){this.m_bulletFlag=!!t},t.prototype.isSleepingAllowed=function(){return this.m_autoSleepFlag},t.prototype.setSleepingAllowed=function(t){this.m_autoSleepFlag=!!t,0==this.m_autoSleepFlag&&this.setAwake(!0)},t.prototype.isAwake=function(){return this.m_awakeFlag},t.prototype.setAwake=function(t){t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_force.setZero(),this.m_torque=0)},t.prototype.isActive=function(){return this.m_activeFlag},t.prototype.setActive=function(t){if(t!=this.m_activeFlag)if(this.m_activeFlag=!!t,this.m_activeFlag){for(var e=this.m_world.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.createProxies(e,this.m_xf);this.m_world.m_newFixture=!0}else{for(e=this.m_world.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.destroyProxies(e);for(var o=this.m_contactList;o;){var s=o;o=o.next,this.m_world.destroyContact(s.contact)}this.m_contactList=null}},t.prototype.isFixedRotation=function(){return this.m_fixedRotationFlag},t.prototype.setFixedRotation=function(t){this.m_fixedRotationFlag!=t&&(this.m_fixedRotationFlag=!!t,this.m_angularVelocity=0,this.resetMassData())},t.prototype.getTransform=function(){return this.m_xf},t.prototype.setTransform=function(t,e){if(1!=this.isWorldLocked()){"number"==typeof e?this.m_xf.setNum(t,e):this.m_xf.setTransform(t),this.m_sweep.setTransform(this.m_xf);for(var i=this.m_world.m_broadPhase,o=this.m_fixtureList;o;o=o.m_next)o.synchronize(i,this.m_xf,this.m_xf);this.setAwake(!0)}},t.prototype.synchronizeTransform=function(){this.m_sweep.getTransform(this.m_xf,1)},t.prototype.synchronizeFixtures=function(){this.m_sweep.getTransform(Ot,0);for(var t=this.m_world.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.synchronize(t,Ot,this.m_xf)},t.prototype.advance=function(t){this.m_sweep.advance(t),D(this.m_sweep.c,this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_sweep.getTransform(this.m_xf,1)},t.prototype.getPosition=function(){return this.m_xf.p},t.prototype.setPosition=function(t){this.setTransform(t,this.m_sweep.a)},t.prototype.getAngle=function(){return this.m_sweep.a},t.prototype.setAngle=function(t){this.setTransform(this.m_xf.p,t)},t.prototype.getWorldCenter=function(){return this.m_sweep.c},t.prototype.getLocalCenter=function(){return this.m_sweep.localCenter},t.prototype.getLinearVelocity=function(){return this.m_linearVelocity},t.prototype.getLinearVelocityFromWorldPoint=function(t){var e=y.sub(t,this.m_sweep.c);return y.add(this.m_linearVelocity,y.crossNumVec2(this.m_angularVelocity,e))},t.prototype.getLinearVelocityFromLocalPoint=function(t){return this.getLinearVelocityFromWorldPoint(this.getWorldPoint(t))},t.prototype.setLinearVelocity=function(t){this.m_type!=zt&&(y.dot(t,t)>0&&this.setAwake(!0),this.m_linearVelocity.setVec2(t))},t.prototype.getAngularVelocity=function(){return this.m_angularVelocity},t.prototype.setAngularVelocity=function(t){this.m_type!=zt&&(t*t>0&&this.setAwake(!0),this.m_angularVelocity=t)},t.prototype.getLinearDamping=function(){return this.m_linearDamping},t.prototype.setLinearDamping=function(t){this.m_linearDamping=t},t.prototype.getAngularDamping=function(){return this.m_angularDamping},t.prototype.setAngularDamping=function(t){this.m_angularDamping=t},t.prototype.getGravityScale=function(){return this.m_gravityScale},t.prototype.setGravityScale=function(t){this.m_gravityScale=t},t.prototype.getMass=function(){return this.m_mass},t.prototype.getInertia=function(){return this.m_I+this.m_mass*y.dot(this.m_sweep.localCenter,this.m_sweep.localCenter)},t.prototype.getMassData=function(t){t.mass=this.m_mass,t.I=this.getInertia(),D(t.center,this.m_sweep.localCenter)},t.prototype.resetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,R(this.m_sweep.localCenter),this.isStatic()||this.isKinematic())return D(this.m_sweep.c0,this.m_xf.p),D(this.m_sweep.c,this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);R(kt);for(var t=this.m_fixtureList;t;t=t.m_next)if(0!=t.m_density){var e={mass:0,center:q(0,0),I:0};t.getMassData(e),this.m_mass+=e.mass,Y(kt,e.mass,e.center),this.m_I+=e.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,J(kt,this.m_invMass,kt)):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&0==this.m_fixedRotationFlag?(this.m_I-=this.m_mass*Q(kt,kt),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0),D(qt,this.m_sweep.c),this.m_sweep.setLocalCenter(kt,this.m_xf),E(Dt,this.m_sweep.c,qt),X(Rt,this.m_angularVelocity,Dt),N(this.m_linearVelocity,Rt)},t.prototype.setMassData=function(t){1!=this.isWorldLocked()&&this.m_type==Lt&&(this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&0==this.m_fixedRotationFlag&&(this.m_I=t.I-this.m_mass*Q(t.center,t.center),this.m_invI=1/this.m_I),D(qt,this.m_sweep.c),this.m_sweep.setLocalCenter(t.center,this.m_xf),E(Dt,this.m_sweep.c,qt),X(Rt,this.m_angularVelocity,Dt),N(this.m_linearVelocity,Rt))},t.prototype.applyForce=function(t,e,i){void 0===i&&(i=!0),this.m_type==Lt&&(i&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_force.add(t),this.m_torque+=y.crossVec2Vec2(y.sub(e,this.m_sweep.c),t)))},t.prototype.applyForceToCenter=function(t,e){void 0===e&&(e=!0),this.m_type==Lt&&(e&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&this.m_force.add(t))},t.prototype.applyTorque=function(t,e){void 0===e&&(e=!0),this.m_type==Lt&&(e&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))},t.prototype.applyLinearImpulse=function(t,e,i){void 0===i&&(i=!0),this.m_type==Lt&&(i&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.addMul(this.m_invMass,t),this.m_angularVelocity+=this.m_invI*y.crossVec2Vec2(y.sub(e,this.m_sweep.c),t)))},t.prototype.applyAngularImpulse=function(t,e){void 0===e&&(e=!0),this.m_type==Lt&&(e&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},t.prototype.shouldCollide=function(t){if(this.m_type!=Lt&&t.m_type!=Lt)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&0==e.joint.m_collideConnected)return!1;return!0},t.prototype._addFixture=function(t){if(1==this.isWorldLocked())return null;if(this.m_activeFlag){var e=this.m_world.m_broadPhase;t.createProxies(e,this.m_xf)}return t.m_next=this.m_fixtureList,this.m_fixtureList=t,t.m_density>0&&this.resetMassData(),this.m_world.m_newFixture=!0,t},t.prototype.createFixture=function(t,e){if(1==this.isWorldLocked())return null;var i=new It(this,t,e);return this._addFixture(i),i},t.prototype.destroyFixture=function(t){if(1!=this.isWorldLocked()){if(this.m_fixtureList===t)this.m_fixtureList=t.m_next;else for(var e=this.m_fixtureList;null!=e;){if(e.m_next===t){e.m_next=t.m_next;break}e=e.m_next}for(var i=this.m_contactList;i;){var o=i.contact;i=i.next;var s=o.getFixtureA(),n=o.getFixtureB();t!=s&&t!=n||this.m_world.destroyContact(o)}if(this.m_activeFlag){var r=this.m_world.m_broadPhase;t.destroyProxies(r)}t.m_body=null,t.m_next=null,this.m_world.publish("remove-fixture",t),this.resetMassData()}},t.prototype.getWorldPoint=function(t){return xt.mulVec2(this.m_xf,t)},t.prototype.getWorldVector=function(t){return pt.mulVec2(this.m_xf.q,t)},t.prototype.getLocalPoint=function(t){return xt.mulTVec2(this.m_xf,t)},t.prototype.getLocalVector=function(t){return pt.mulTVec2(this.m_xf.q,t)},t.STATIC="static",t.KINEMATIC="kinematic",t.DYNAMIC="dynamic",t}(),Et=function(){return function(){this.other=null,this.joint=null,this.prev=null,this.next=null}}(),Wt=function(){function t(t,e,i){this.m_type="unknown-joint",this.m_prev=null,this.m_next=null,this.m_edgeA=new Et,this.m_edgeB=new Et,this.m_islandFlag=!1,this.style={},this.appData={},e="bodyA"in t?t.bodyA:e,i="bodyB"in t?t.bodyB:i,this.m_bodyA=e,this.m_bodyB=i,this.m_collideConnected=!!t.collideConnected,this.m_userData=t.userData,"object"==typeof t.style&&null!==t.style&&(this.style=t.style)}return t.prototype.isActive=function(){return this.m_bodyA.isActive()&&this.m_bodyB.isActive()},t.prototype.getType=function(){return this.m_type},t.prototype.getBodyA=function(){return this.m_bodyA},t.prototype.getBodyB=function(){return this.m_bodyB},t.prototype.getNext=function(){return this.m_next},t.prototype.getUserData=function(){return this.m_userData},t.prototype.setUserData=function(t){this.m_userData=t},t.prototype.getCollideConnected=function(){return this.m_collideConnected},t.prototype.shiftOrigin=function(t){},t.prototype._resetAnchors=function(t){return this._reset(t)},t}(),Jt={gjkCalls:0,gjkIters:0,gjkMaxIters:0,toiTime:0,toiMaxTime:0,toiCalls:0,toiIters:0,toiMaxIters:0,toiRootIters:0,toiMaxRootIters:0,toString:function(t){t="string"==typeof t?t:"\n";var e="";for(var i in this)"function"!=typeof this[i]&&"object"!=typeof this[i]&&(e+=i+": "+this[i]+t);return e}};const Yt=function(){return Date.now()},Ht=function(t){return Date.now()-t};var Ut=Math.max,$t=q(0,0),Gt=q(0,0),Kt=q(0,0),Xt=q(0,0),Zt=q(0,0),Qt=q(0,0),te=q(0,0);Jt.gjkCalls=0,Jt.gjkIters=0,Jt.gjkMaxIters=0;var ee=function(){function t(){this.proxyA=new ne,this.proxyB=new ne,this.transformA=xt.identity(),this.transformB=xt.identity(),this.useRadii=!1}return t.prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.transformA.setIdentity(),this.transformB.setIdentity(),this.useRadii=!1},t}(),ie=function(){function t(){this.pointA=q(0,0),this.pointB=q(0,0),this.distance=0,this.iterations=0}return t.prototype.recycle=function(){R(this.pointA),R(this.pointB),this.distance=0,this.iterations=0},t}(),oe=function(){function t(){this.metric=0,this.indexA=[],this.indexB=[],this.count=0}return t.prototype.recycle=function(){this.metric=0,this.indexA.length=0,this.indexB.length=0,this.count=0},t}(),se=function(t,e,i){++Jt.gjkCalls;var o=i.proxyA,s=i.proxyB,n=i.transformA,a=i.transformB;he.recycle(),he.readCache(e,o,n,s,a);for(var m=he.m_v,c=b.maxDistanceIterations,h=[],l=[],_=0,u=0;u<c;){_=he.m_count;for(var p=0;p<_;++p)h[p]=m[p].indexA,l[p]=m[p].indexB;if(he.solve(),3===he.m_count)break;var y=he.getSearchDirection();if(tt(y)<1e-18)break;var d=m[he.m_count];d.indexA=o.getSupport(st($t,n.q,J($t,-1,y))),at(d.wA,n,o.getVertex(d.indexA)),d.indexB=s.getSupport(st($t,a.q,y)),at(d.wB,a,s.getVertex(d.indexB)),E(d.w,d.wB,d.wA),++u,++Jt.gjkIters;var f=!1;for(p=0;p<_;++p)if(d.indexA===h[p]&&d.indexB===l[p]){f=!0;break}if(f)break;++he.m_count}if(Jt.gjkMaxIters=Ut(Jt.gjkMaxIters,u),he.getWitnessPoints(t.pointA,t.pointB),t.distance=et(t.pointA,t.pointB),t.iterations=u,he.writeCache(e),i.useRadii){var v=o.m_radius,x=s.m_radius;if(t.distance>v+x&&t.distance>r)t.distance-=v+x,E(Gt,t.pointB,t.pointA),G(Gt),Y(t.pointA,v,Gt),H(t.pointB,x,Gt);else{var g=E($t,t.pointA,t.pointB);D(t.pointA,g),D(t.pointB,g),t.distance=0}}},ne=function(){function t(){this.m_vertices=[],this.m_count=0,this.m_radius=0}return t.prototype.recycle=function(){this.m_vertices.length=0,this.m_count=0,this.m_radius=0},t.prototype.getVertexCount=function(){return this.m_count},t.prototype.getVertex=function(t){return this.m_vertices[t]},t.prototype.getSupport=function(t){for(var e=-1,i=-1/0,o=0;o<this.m_count;++o){var s=Q(this.m_vertices[o],t);s>i&&(e=o,i=s)}return e},t.prototype.getSupportVertex=function(t){return this.m_vertices[this.getSupport(t)]},t.prototype.set=function(t,e){t.computeDistanceProxy(this,e)},t.prototype.setVertices=function(t,e,i){this.m_vertices=t,this.m_count=e,this.m_radius=i},t}(),re=function(){function t(){this.wA=q(0,0),this.indexA=0,this.wB=q(0,0),this.indexB=0,this.w=q(0,0),this.a=0}return t.prototype.recycle=function(){this.indexA=0,this.indexB=0,R(this.wA),R(this.wB),R(this.w),this.a=0},t.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,D(this.wA,t.wA),D(this.wB,t.wB),D(this.w,t.w),this.a=t.a},t}(),ae=q(0,0),me=q(0,0),ce=function(){function t(){this.m_v1=new re,this.m_v2=new re,this.m_v3=new re,this.m_v=[this.m_v1,this.m_v2,this.m_v3]}return t.prototype.recycle=function(){this.m_v1.recycle(),this.m_v2.recycle(),this.m_v3.recycle(),this.m_count=0},t.prototype.toString=function(){return 3===this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y,this.m_v3.a,this.m_v3.wA.x,this.m_v3.wA.y,this.m_v3.wB.x,this.m_v3.wB.y].toString():2===this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y].toString():1===this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y].toString():"+"+this.m_count},t.prototype.readCache=function(t,e,i,o,s){this.m_count=t.count;for(var n=0;n<this.m_count;++n){(l=this.m_v[n]).indexA=t.indexA[n],l.indexB=t.indexB[n];var a=e.getVertex(l.indexA),m=o.getVertex(l.indexB);at(l.wA,i,a),at(l.wB,s,m),E(l.w,l.wB,l.wA),l.a=0}if(this.m_count>1){var c=t.metric,h=this.getMetric();(h<.5*c||2*c<h||h<r)&&(this.m_count=0)}var l;0===this.m_count&&((l=this.m_v[0]).indexA=0,l.indexB=0,a=e.getVertex(0),m=o.getVertex(0),at(l.wA,i,a),at(l.wB,s,m),E(l.w,l.wB,l.wA),l.a=1,this.m_count=1)},t.prototype.writeCache=function(t){t.metric=this.getMetric(),t.count=this.m_count;for(var e=0;e<this.m_count;++e)t.indexA[e]=this.m_v[e].indexA,t.indexB[e]=this.m_v[e].indexB},t.prototype.getSearchDirection=function(){var t=this.m_v1,e=this.m_v2;switch(this.m_v3,this.m_count){case 1:return k(ae,-t.w.x,-t.w.y);case 2:return E(Kt,e.w,t.w),-Z(Kt,t.w)>0?k(ae,-Kt.y,Kt.x):k(ae,Kt.y,-Kt.x);default:return R(ae)}},t.prototype.getClosestPoint=function(){var t=this.m_v1,e=this.m_v2;switch(this.m_v3,this.m_count){case 0:case 3:default:return R(me);case 1:return D(me,t.w);case 2:return U(me,t.a,t.w,e.a,e.w)}},t.prototype.getWitnessPoints=function(t,e){var i=this.m_v1,o=this.m_v2,s=this.m_v3;switch(this.m_count){case 0:break;case 1:D(t,i.wA),D(e,i.wB);break;case 2:U(t,i.a,i.wA,o.a,o.wA),U(e,i.a,i.wB,o.a,o.wB);break;case 3:$(t,i.a,i.wA,o.a,o.wA,s.a,s.wA),D(e,t)}},t.prototype.getMetric=function(){switch(this.m_count){case 0:case 1:default:return 0;case 2:return et(this.m_v1.w,this.m_v2.w);case 3:return Z(E(Qt,this.m_v2.w,this.m_v1.w),E(te,this.m_v3.w,this.m_v1.w))}},t.prototype.solve=function(){switch(this.m_count){case 1:break;case 2:this.solve2();break;case 3:this.solve3()}},t.prototype.solve2=function(){var t=this.m_v1.w,e=this.m_v2.w;E(Kt,e,t);var i=-Q(t,Kt);if(i<=0)return this.m_v1.a=1,void(this.m_count=1);var o=Q(e,Kt);if(o<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);var s=1/(o+i);this.m_v1.a=o*s,this.m_v2.a=i*s,this.m_count=2},t.prototype.solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w;E(Kt,e,t);var o=Q(t,Kt),s=Q(e,Kt),n=-o;E(Xt,i,t);var r=Q(t,Xt),a=Q(i,Xt),m=-r;E(Zt,i,e);var c=Q(e,Zt),h=Q(i,Zt),l=-c,_=Z(Kt,Xt),u=_*Z(e,i),p=_*Z(i,t),y=_*Z(t,e);if(n<=0&&m<=0)return this.m_v1.a=1,void(this.m_count=1);if(s>0&&n>0&&y<=0){var d=1/(s+n);return this.m_v1.a=s*d,this.m_v2.a=n*d,void(this.m_count=2)}if(a>0&&m>0&&p<=0){var f=1/(a+m);return this.m_v1.a=a*f,this.m_v3.a=m*f,this.m_count=2,void this.m_v2.set(this.m_v3)}if(s<=0&&l<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);if(a<=0&&h<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.set(this.m_v3);if(h>0&&l>0&&u<=0){var v=1/(h+l);return this.m_v2.a=h*v,this.m_v3.a=l*v,this.m_count=2,void this.m_v1.set(this.m_v3)}var x=1/(u+p+y);this.m_v1.a=u*x,this.m_v2.a=p*x,this.m_v3.a=y*x,this.m_count=3},t}(),he=new ce,le=new ee,_e=new oe,ue=new ie,pe=function(t,e,i,o,s,n){return le.recycle(),le.proxyA.set(t,e),le.proxyB.set(i,o),rt(le.transformA,s),rt(le.transformB,n),le.useRadii=!0,ue.recycle(),_e.recycle(),se(ue,_e,le),ue.distance<1e-8};se.testOverlap=pe,se.Input=ee,se.Output=ie,se.Proxy=ne,se.Cache=oe;var ye,de=function(){function t(){this.proxyA=new ne,this.proxyB=new ne,this.transformA=xt.identity(),this.transformB=xt.identity(),this.translationB=y.zero()}return t.prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.transformA.setIdentity(),this.transformB.setIdentity(),R(this.translationB)},t}(),fe=function(){return function(){this.point=y.zero(),this.normal=y.zero(),this.lambda=1,this.iterations=0}}(),ve=function(t,e){t.iterations=0,t.lambda=1,t.normal.setZero(),t.point.setZero();var i=e.proxyA,o=e.proxyB,s=Ut(i.m_radius,b.polygonRadius),n=s+Ut(o.m_radius,b.polygonRadius),r=e.transformA,a=e.transformB,m=e.translationB,c=y.zero(),h=0,l=new ce;l.m_count=0;for(var _=l.m_v,u=i.getSupport(pt.mulTVec2(r.q,y.neg(m))),p=xt.mulVec2(r,i.getVertex(u)),d=o.getSupport(pt.mulTVec2(a.q,m)),f=xt.mulVec2(a,o.getVertex(d)),v=y.sub(p,f),x=Ut(b.polygonRadius,n-b.polygonRadius),g=.5*b.linearSlop,A=0;A<20&&v.length()-x>g;){t.iterations+=1,u=i.getSupport(pt.mulTVec2(r.q,y.neg(v))),p=xt.mulVec2(r,i.getVertex(u)),d=o.getSupport(pt.mulTVec2(a.q,v)),f=xt.mulVec2(a,o.getVertex(d));var B=y.sub(p,f);v.normalize();var w=y.dot(v,B),V=y.dot(v,m);if(w-x>h*V){if(V<=0)return!1;if((h=(w-x)/V)>1)return!1;c.setMul(-1,v),l.m_count=0}var C=_[l.m_count];switch(C.indexA=d,C.wA=y.combine(1,f,h,m),C.indexB=u,C.wB=p,C.w=y.sub(C.wB,C.wA),C.a=1,l.m_count+=1,l.m_count){case 1:break;case 2:l.solve2();break;case 3:l.solve3()}if(3==l.m_count)return!1;v.setVec2(l.getClosestPoint()),++A}if(0==A)return!1;var M=y.zero(),S=y.zero();return l.getWitnessPoints(S,M),v.lengthSquared()>0&&(c.setMul(-1,v),c.normalize()),t.point=y.combine(1,M,s,c),t.normal=c,t.lambda=h,t.iterations=A,!0},xe=Math.abs,ge=Math.max,be=function(){function t(){this.proxyA=new ne,this.proxyB=new ne,this.sweepA=new vt,this.sweepB=new vt}return t.prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.sweepA.recycle(),this.sweepB.recycle(),this.tMax=-1},t}();t.TOIOutputState=void 0,(ye=t.TOIOutputState||(t.TOIOutputState={}))[ye.e_unset=-1]="e_unset",ye[ye.e_unknown=0]="e_unknown",ye[ye.e_failed=1]="e_failed",ye[ye.e_overlapped=2]="e_overlapped",ye[ye.e_touching=3]="e_touching",ye[ye.e_separated=4]="e_separated";var Ae=function(){function e(){this.state=t.TOIOutputState.e_unset,this.t=-1}return e.prototype.recycle=function(){this.state=t.TOIOutputState.e_unset,this.t=-1},e}();Jt.toiTime=0,Jt.toiMaxTime=0,Jt.toiCalls=0,Jt.toiIters=0,Jt.toiMaxIters=0,Jt.toiRootIters=0,Jt.toiMaxRootIters=0;var Be,we,Ve=new ee,Ce=new ie,Me=new oe,Se=nt(0,0,0),Te=nt(0,0,0),Pe=q(0,0),Ie=q(0,0),ze=q(0,0),Fe=q(0,0),Le=q(0,0),qe=q(0,0),ke=q(0,0),De=q(0,0),Re=function(e,i){var o=Yt();++Jt.toiCalls,e.state=t.TOIOutputState.e_unknown,e.t=i.tMax;var s=i.proxyA,n=i.proxyB,r=i.sweepA,a=i.sweepB;r.normalize(),a.normalize();var m=i.tMax,c=s.m_radius+n.m_radius,h=ge(b.linearSlop,c-3*b.linearSlop),l=.25*b.linearSlop,_=0,u=b.maxTOIIterations,p=0;for(Me.recycle(),Ve.proxyA.setVertices(s.m_vertices,s.m_count,s.m_radius),Ve.proxyB.setVertices(n.m_vertices,n.m_count,n.m_radius),Ve.useRadii=!1;;){if(r.getTransform(Se,_),a.getTransform(Te,_),rt(Ve.transformA,Se),rt(Ve.transformB,Te),se(Ce,Me,Ve),Ce.distance<=0){e.state=t.TOIOutputState.e_overlapped,e.t=0;break}if(Ce.distance<h+l){e.state=t.TOIOutputState.e_touching,e.t=_;break}Oe.initialize(Me,s,r,n,a,_);for(var y=!1,d=m,f=0;;){var v=Oe.findMinSeparation(d);if(v>h+l){e.state=t.TOIOutputState.e_separated,e.t=m,y=!0;break}if(v>h-l){_=d;break}var x=Oe.evaluate(_);if(x<h-l){e.state=t.TOIOutputState.e_failed,e.t=_,y=!0;break}if(x<=h+l){e.state=t.TOIOutputState.e_touching,e.t=_,y=!0;break}for(var g=0,A=_,B=d;;){var w;w=1&g?A+(h-x)*(B-A)/(v-x):.5*(A+B),++g,++Jt.toiRootIters;var V=Oe.evaluate(w);if(xe(V-h)<l){d=w;break}if(V>h?(A=w,x=V):(B=w,v=V),50===g)break}if(Jt.toiMaxRootIters=ge(Jt.toiMaxRootIters,g),++f===b.maxPolygonVertices)break}if(++p,++Jt.toiIters,y)break;if(p===u){e.state=t.TOIOutputState.e_failed,e.t=_;break}}Jt.toiMaxIters=ge(Jt.toiMaxIters,p);var C=Ht(o);Jt.toiMaxTime=ge(Jt.toiMaxTime,C),Jt.toiTime+=C,Oe.recycle()};(we=Be||(Be={}))[we.e_unset=-1]="e_unset",we[we.e_points=1]="e_points",we[we.e_faceA=2]="e_faceA",we[we.e_faceB=3]="e_faceB";var Oe=new(function(){function t(){this.m_proxyA=null,this.m_proxyB=null,this.m_sweepA=null,this.m_sweepB=null,this.m_type=Be.e_unset,this.m_localPoint=q(0,0),this.m_axis=q(0,0),this.indexA=-1,this.indexB=-1}return t.prototype.recycle=function(){this.m_proxyA=null,this.m_proxyB=null,this.m_sweepA=null,this.m_sweepB=null,this.m_type=Be.e_unset,R(this.m_localPoint),R(this.m_axis),this.indexA=-1,this.indexB=-1},t.prototype.initialize=function(t,e,i,o,s,n){var r=t.count;if(this.m_proxyA=e,this.m_proxyB=o,this.m_sweepA=i,this.m_sweepB=s,this.m_sweepA.getTransform(Se,n),this.m_sweepB.getTransform(Te,n),1===r){this.m_type=Be.e_points;var a=this.m_proxyA.getVertex(t.indexA[0]),m=this.m_proxyB.getVertex(t.indexB[0]);return at(Ie,Se,a),at(ze,Te,m),E(this.m_axis,ze,Ie),function(t){var e=L(t.x*t.x+t.y*t.y);if(0!==e){var i=1/e;t.x*=i,t.y*=i}return e}(this.m_axis)}if(t.indexA[0]===t.indexA[1]){this.m_type=Be.e_faceB;var c=o.getVertex(t.indexB[0]),h=o.getVertex(t.indexB[1]);K(this.m_axis,E(Pe,h,c),1),G(this.m_axis),ot(Fe,Te.q,this.m_axis),U(this.m_localPoint,.5,c,.5,h),at(ze,Te,this.m_localPoint);var l=e.getVertex(t.indexA[0]);return(p=Q(xt.mulVec2(Se,l),Fe)-Q(ze,Fe))<0&&(O(this.m_axis),p=-p),p}this.m_type=Be.e_faceA;var _=this.m_proxyA.getVertex(t.indexA[0]),u=this.m_proxyA.getVertex(t.indexA[1]);K(this.m_axis,E(Pe,u,_),1),G(this.m_axis),ot(Fe,Se.q,this.m_axis),U(this.m_localPoint,.5,_,.5,u),at(Ie,Se,this.m_localPoint);var p,y=this.m_proxyB.getVertex(t.indexB[0]);return at(ze,Te,y),(p=Q(ze,Fe)-Q(Ie,Fe))<0&&(O(this.m_axis),p=-p),p},t.prototype.compute=function(t,e){switch(this.m_sweepA.getTransform(Se,e),this.m_sweepB.getTransform(Te,e),this.m_type){case Be.e_points:return t&&(st(Le,Se.q,this.m_axis),st(qe,Te.q,J(Pe,-1,this.m_axis)),this.indexA=this.m_proxyA.getSupport(Le),this.indexB=this.m_proxyB.getSupport(qe)),D(ke,this.m_proxyA.getVertex(this.indexA)),D(De,this.m_proxyB.getVertex(this.indexB)),at(Ie,Se,ke),at(ze,Te,De),Q(ze,this.m_axis)-Q(Ie,this.m_axis);case Be.e_faceA:return ot(Fe,Se.q,this.m_axis),at(Ie,Se,this.m_localPoint),t&&(st(qe,Te.q,J(Pe,-1,Fe)),this.indexA=-1,this.indexB=this.m_proxyB.getSupport(qe)),D(De,this.m_proxyB.getVertex(this.indexB)),at(ze,Te,De),Q(ze,Fe)-Q(Ie,Fe);case Be.e_faceB:return ot(Fe,Te.q,this.m_axis),at(ze,Te,this.m_localPoint),t&&(st(Le,Se.q,J(Pe,-1,Fe)),this.indexB=-1,this.indexA=this.m_proxyA.getSupport(Le)),D(ke,this.m_proxyA.getVertex(this.indexA)),at(Ie,Se,ke),Q(Ie,Fe)-Q(ze,Fe);default:return t&&(this.indexA=-1,this.indexB=-1),0}},t.prototype.findMinSeparation=function(t){return this.compute(!0,t)},t.prototype.evaluate=function(t){return this.compute(!1,t)},t}());Re.Input=be,Re.Output=Ae;var Ne=Math.abs,je=Math.sqrt,Ee=Math.min,We=function(){function t(){this.dt=0,this.inv_dt=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1,this.blockSolve=!0,this.inv_dt0=0,this.dtRatio=1}return t.prototype.reset=function(t){this.dt>0&&(this.inv_dt0=this.inv_dt),this.dt=t,this.inv_dt=0==t?0:1/t,this.dtRatio=t*this.inv_dt0},t}(),Je=new We,Ye=q(0,0),He=q(0,0),Ue=q(0,0),$e=new be,Ge=new Ae,Ke=new vt,Xe=new vt,Ze=new vt,Qe=function(){function t(t){this.contact=t,this.normals=[],this.tangents=[]}return t.prototype.recycle=function(){this.normals.length=0,this.tangents.length=0},Object.defineProperty(t.prototype,"normalImpulses",{get:function(){var t=this.contact,e=this.normals;e.length=0;for(var i=0;i<t.v_points.length;++i)e.push(t.v_points[i].normalImpulse);return e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tangentImpulses",{get:function(){var t=this.contact,e=this.tangents;e.length=0;for(var i=0;i<t.v_points.length;++i)e.push(t.v_points[i].tangentImpulse);return e},enumerable:!1,configurable:!0}),t}(),ti=function(){function e(t){this.m_world=t,this.m_stack=[],this.m_bodies=[],this.m_contacts=[],this.m_joints=[]}return e.prototype.clear=function(){this.m_stack.length=0,this.m_bodies.length=0,this.m_contacts.length=0,this.m_joints.length=0},e.prototype.addBody=function(t){this.m_bodies.push(t)},e.prototype.addContact=function(t){this.m_contacts.push(t)},e.prototype.addJoint=function(t){this.m_joints.push(t)},e.prototype.solveWorld=function(t){for(var e=this.m_world,i=e.m_bodyList;i;i=i.m_next)i.m_islandFlag=!1;for(var o=e.m_contactList;o;o=o.m_next)o.m_islandFlag=!1;for(var s=e.m_jointList;s;s=s.m_next)s.m_islandFlag=!1;for(var n=this.m_stack,r=e.m_bodyList;r;r=r.m_next)if(!r.m_islandFlag&&0!=r.isAwake()&&0!=r.isActive()&&!r.isStatic()){for(this.clear(),n.push(r),r.m_islandFlag=!0;n.length>0;)if(i=n.pop(),this.addBody(i),i.m_awakeFlag=!0,!i.isStatic()){for(var a=i.m_contactList;a;a=a.next){var m=a.contact;if(!m.m_islandFlag&&0!=m.isEnabled()&&0!=m.isTouching()){var c=m.m_fixtureA.m_isSensor,h=m.m_fixtureB.m_isSensor;c||h||(this.addContact(m),m.m_islandFlag=!0,(_=a.other).m_islandFlag||(n.push(_),_.m_islandFlag=!0))}}for(var l=i.m_jointList;l;l=l.next){var _;1!=l.joint.m_islandFlag&&0!=(_=l.other).isActive()&&(this.addJoint(l.joint),l.joint.m_islandFlag=!0,_.m_islandFlag||(n.push(_),_.m_islandFlag=!0))}}this.solveIsland(t);for(var u=0;u<this.m_bodies.length;++u)(i=this.m_bodies[u]).isStatic()&&(i.m_islandFlag=!1)}},e.prototype.solveIsland=function(t){for(var e=this.m_world,i=e.m_gravity,o=e.m_allowSleep,s=t.dt,n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n];D(Ye,r.m_sweep.c);var a=r.m_sweep.a;D(He,r.m_linearVelocity);var m=r.m_angularVelocity;D(r.m_sweep.c0,r.m_sweep.c),r.m_sweep.a0=r.m_sweep.a,r.isDynamic()&&(Y(He,s*r.m_gravityScale,i),Y(He,s*r.m_invMass,r.m_force),m+=s*r.m_invI*r.m_torque,J(He,1/(1+s*r.m_linearDamping),He),m*=1/(1+s*r.m_angularDamping)),D(r.c_position.c,Ye),r.c_position.a=a,D(r.c_velocity.v,He),r.c_velocity.w=m}for(n=0;n<this.m_contacts.length;++n)this.m_contacts[n].initConstraint(t);for(n=0;n<this.m_contacts.length;++n)this.m_contacts[n].initVelocityConstraint(t);if(t.warmStarting)for(n=0;n<this.m_contacts.length;++n)this.m_contacts[n].warmStartConstraint(t);for(n=0;n<this.m_joints.length;++n)this.m_joints[n].initVelocityConstraints(t);for(n=0;n<t.velocityIterations;++n){for(var c=0;c<this.m_joints.length;++c)this.m_joints[c].solveVelocityConstraints(t);for(c=0;c<this.m_contacts.length;++c)this.m_contacts[c].solveVelocityConstraint(t)}for(n=0;n<this.m_contacts.length;++n)this.m_contacts[n].storeConstraintImpulses(t);for(n=0;n<this.m_bodies.length;++n){r=this.m_bodies[n],D(Ye,r.c_position.c),a=r.c_position.a,D(He,r.c_velocity.v),m=r.c_velocity.w,J(Ue,s,He);var h=tt(Ue);if(h>b.maxTranslationSquared){var l=b.maxTranslation/je(h);W(He,l)}var _=s*m;_*_>b.maxRotationSquared&&(m*=l=b.maxRotation/Ne(_)),Y(Ye,s,He),a+=s*m,D(r.c_position.c,Ye),r.c_position.a=a,D(r.c_velocity.v,He),r.c_velocity.w=m}var u=!1;for(n=0;n<t.positionIterations;++n){var p=0;for(c=0;c<this.m_contacts.length;++c){var y=this.m_contacts[c].solvePositionConstraint(t);p=Ee(p,y)}var d=p>=-3*b.linearSlop,f=!0;for(c=0;c<this.m_joints.length;++c){var v=this.m_joints[c].solvePositionConstraints(t);f=f&&v}if(d&&f){u=!0;break}}for(n=0;n<this.m_bodies.length;++n)D((r=this.m_bodies[n]).m_sweep.c,r.c_position.c),r.m_sweep.a=r.c_position.a,D(r.m_linearVelocity,r.c_velocity.v),r.m_angularVelocity=r.c_velocity.w,r.synchronizeTransform();if(this.postSolveIsland(),o){var x=1/0,g=b.linearSleepToleranceSqr,A=b.angularSleepToleranceSqr;for(n=0;n<this.m_bodies.length;++n)(r=this.m_bodies[n]).isStatic()||(0==r.m_autoSleepFlag||r.m_angularVelocity*r.m_angularVelocity>A||tt(r.m_linearVelocity)>g?(r.m_sleepTime=0,x=0):(r.m_sleepTime+=s,x=Ee(x,r.m_sleepTime)));if(x>=b.timeToSleep&&u)for(n=0;n<this.m_bodies.length;++n)(r=this.m_bodies[n]).setAwake(!1)}},e.prototype.solveWorldTOI=function(e){var i=this.m_world;if(i.m_stepComplete){for(var o=i.m_bodyList;o;o=o.m_next)o.m_islandFlag=!1,o.m_sweep.alpha0=0;for(var s=i.m_contactList;s;s=s.m_next)s.m_toiFlag=!1,s.m_islandFlag=!1,s.m_toiCount=0,s.m_toi=1}for(;;){for(var n=null,r=1,a=i.m_contactList;a;a=a.m_next)if(0!=a.isEnabled()&&!(a.m_toiCount>b.maxSubSteps)){var m=1;if(a.m_toiFlag)m=a.m_toi;else{var c=a.getFixtureA(),h=a.getFixtureB();if(c.isSensor()||h.isSensor())continue;var l=c.getBody(),_=h.getBody(),u=l.isAwake()&&!l.isStatic(),p=_.isAwake()&&!_.isStatic();if(0==u&&0==p)continue;var y=l.isBullet()||!l.isDynamic(),d=_.isBullet()||!_.isDynamic();if(0==y&&0==d)continue;var f=l.m_sweep.alpha0;l.m_sweep.alpha0<_.m_sweep.alpha0?(f=_.m_sweep.alpha0,l.m_sweep.advance(f)):_.m_sweep.alpha0<l.m_sweep.alpha0&&(f=l.m_sweep.alpha0,_.m_sweep.advance(f));var v=a.getChildIndexA(),x=a.getChildIndexB();l.m_sweep,_.m_sweep,$e.proxyA.set(c.getShape(),v),$e.proxyB.set(h.getShape(),x),$e.sweepA.set(l.m_sweep),$e.sweepB.set(_.m_sweep),$e.tMax=1,Re(Ge,$e);var g=Ge.t;m=Ge.state==t.TOIOutputState.e_touching?Ee(f+(1-f)*g,1):1,a.m_toi=m,a.m_toiFlag=!0}m<r&&(n=a,r=m)}if(null==n||1-1e-8<r){i.m_stepComplete=!0;break}var A=n.getFixtureA(),B=n.getFixtureB(),w=A.getBody(),V=B.getBody();if(Xe.set(w.m_sweep),Ze.set(V.m_sweep),w.advance(r),V.advance(r),n.update(i),n.m_toiFlag=!1,++n.m_toiCount,0!=n.isEnabled()&&0!=n.isTouching()){w.setAwake(!0),V.setAwake(!0),this.clear(),this.addBody(w),this.addBody(V),this.addContact(n),w.m_islandFlag=!0,V.m_islandFlag=!0,n.m_islandFlag=!0;for(var C=[w,V],M=0;M<C.length;++M)if((F=C[M]).isDynamic())for(var S=F.m_contactList;S;S=S.next){var T=S.contact;if(!T.m_islandFlag){var P=S.other;if(!P.isDynamic()||F.isBullet()||P.isBullet()){var I=T.m_fixtureA.m_isSensor,z=T.m_fixtureB.m_isSensor;I||z||(Ke.set(P.m_sweep),0==P.m_islandFlag&&P.advance(r),T.update(i),0!=T.isEnabled()&&0!=T.isTouching()?(T.m_islandFlag=!0,this.addContact(T),P.m_islandFlag||(P.m_islandFlag=!0,P.isStatic()||P.setAwake(!0),this.addBody(P))):(P.m_sweep.set(Ke),P.synchronizeTransform()))}}}for(Je.reset((1-r)*e.dt),Je.dtRatio=1,Je.positionIterations=20,Je.velocityIterations=e.velocityIterations,Je.warmStarting=!1,this.solveIslandTOI(Je,w,V),M=0;M<this.m_bodies.length;++M){var F;if((F=this.m_bodies[M]).m_islandFlag=!1,F.isDynamic())for(F.synchronizeFixtures(),S=F.m_contactList;S;S=S.next)S.contact.m_toiFlag=!1,S.contact.m_islandFlag=!1}if(i.findNewContacts(),i.m_subStepping){i.m_stepComplete=!1;break}}else n.setEnabled(!1),w.m_sweep.set(Xe),V.m_sweep.set(Ze),w.synchronizeTransform(),V.synchronizeTransform()}},e.prototype.solveIslandTOI=function(t,e,i){for(var o=0;o<this.m_bodies.length;++o)D((m=this.m_bodies[o]).c_position.c,m.m_sweep.c),m.c_position.a=m.m_sweep.a,D(m.c_velocity.v,m.m_linearVelocity),m.c_velocity.w=m.m_angularVelocity;for(o=0;o<this.m_contacts.length;++o)this.m_contacts[o].initConstraint(t);for(o=0;o<t.positionIterations;++o){for(var s=0,n=0;n<this.m_contacts.length;++n){var r=this.m_contacts[n].solvePositionConstraintTOI(t,e,i);s=Ee(s,r)}if(s>=-1.5*b.linearSlop)break}for(D(e.m_sweep.c0,e.c_position.c),e.m_sweep.a0=e.c_position.a,D(i.m_sweep.c0,i.c_position.c),i.m_sweep.a0=i.c_position.a,o=0;o<this.m_contacts.length;++o)this.m_contacts[o].initVelocityConstraint(t);for(o=0;o<t.velocityIterations;++o)for(n=0;n<this.m_contacts.length;++n)this.m_contacts[n].solveVelocityConstraint(t);var a=t.dt;for(o=0;o<this.m_bodies.length;++o){var m=this.m_bodies[o];D(Ye,m.c_position.c);var c=m.c_position.a;D(He,m.c_velocity.v);var h=m.c_velocity.w;J(Ue,a,He);var l=tt(Ue);if(l>b.maxTranslationSquared){var _=b.maxTranslation/je(l);W(He,_)}var u=a*h;u*u>b.maxRotationSquared&&(h*=_=b.maxRotation/Ne(u)),Y(Ye,a,He),c+=a*h,D(m.c_position.c,Ye),m.c_position.a=c,D(m.c_velocity.v,He),m.c_velocity.w=h,D(m.m_sweep.c,Ye),m.m_sweep.a=c,D(m.m_linearVelocity,He),m.m_angularVelocity=h,m.synchronizeTransform()}this.postSolveIsland()},e.prototype.postSolveIsland=function(){for(var t=0;t<this.m_contacts.length;++t){var e=this.m_contacts[t];this.m_world.postSolve(e,e.m_impulse)}},e}();ti.TimeStep=We;var ei,ii,oi,si=function(){function t(t,e,i,o){"object"==typeof t&&null!==t?(this.ex=y.clone(t),this.ey=y.clone(e)):"number"==typeof t?(this.ex=y.neo(t,i),this.ey=y.neo(e,o)):(this.ex=y.zero(),this.ey=y.zero())}return t.prototype.toString=function(){return JSON.stringify(this)},t.isValid=function(t){return null!=t&&y.isValid(t.ex)&&y.isValid(t.ey)},t.assert=function(t){},t.prototype.set=function(t,e,i,o){"number"==typeof t&&"number"==typeof e&&"number"==typeof i&&"number"==typeof o?(this.ex.setNum(t,i),this.ey.setNum(e,o)):"object"==typeof t&&"object"==typeof e?(this.ex.setVec2(t),this.ey.setVec2(e)):"object"==typeof t&&(this.ex.setVec2(t.ex),this.ey.setVec2(t.ey))},t.prototype.setIdentity=function(){this.ex.x=1,this.ey.x=0,this.ex.y=0,this.ey.y=1},t.prototype.setZero=function(){this.ex.x=0,this.ey.x=0,this.ex.y=0,this.ey.y=0},t.prototype.getInverse=function(){var e=this.ex.x,i=this.ey.x,o=this.ex.y,s=this.ey.y,n=e*s-i*o;0!==n&&(n=1/n);var r=new t;return r.ex.x=n*s,r.ey.x=-n*i,r.ex.y=-n*o,r.ey.y=n*e,r},t.prototype.solve=function(t){var e=this.ex.x,i=this.ey.x,o=this.ex.y,s=this.ey.y,n=e*s-i*o;0!==n&&(n=1/n);var r=y.zero();return r.x=n*(s*t.x-i*t.y),r.y=n*(e*t.y-o*t.x),r},t.mul=function(e,i){if(i&&"x"in i&&"y"in i){var o=e.ex.x*i.x+e.ey.x*i.y,s=e.ex.y*i.x+e.ey.y*i.y;return y.neo(o,s)}if(i&&"ex"in i&&"ey"in i)return new t(e.ex.x*i.ex.x+e.ey.x*i.ex.y,e.ex.x*i.ey.x+e.ey.x*i.ey.y,e.ex.y*i.ex.x+e.ey.y*i.ex.y,e.ex.y*i.ey.x+e.ey.y*i.ey.y)},t.mulVec2=function(t,e){var i=t.ex.x*e.x+t.ey.x*e.y,o=t.ex.y*e.x+t.ey.y*e.y;return y.neo(i,o)},t.mulMat22=function(e,i){return new t(e.ex.x*i.ex.x+e.ey.x*i.ex.y,e.ex.x*i.ey.x+e.ey.x*i.ey.y,e.ex.y*i.ex.x+e.ey.y*i.ex.y,e.ex.y*i.ey.x+e.ey.y*i.ey.y)},t.mulT=function(e,i){return i&&"x"in i&&"y"in i?y.neo(y.dot(i,e.ex),y.dot(i,e.ey)):i&&"ex"in i&&"ey"in i?new t(y.neo(y.dot(e.ex,i.ex),y.dot(e.ey,i.ex)),y.neo(y.dot(e.ex,i.ey),y.dot(e.ey,i.ey))):void 0},t.mulTVec2=function(t,e){return y.neo(y.dot(e,t.ex),y.dot(e,t.ey))},t.mulTMat22=function(e,i){return new t(y.neo(y.dot(e.ex,i.ex),y.dot(e.ey,i.ex)),y.neo(y.dot(e.ex,i.ey),y.dot(e.ey,i.ey)))},t.abs=function(e){return new t(y.abs(e.ex),y.abs(e.ey))},t.add=function(e,i){return new t(y.add(e.ex,i.ex),y.add(e.ey,i.ey))},t}(),ni=Math.sqrt,ri=q(0,0),ai=q(0,0),mi=q(0,0),ci=q(0,0),hi=q(0,0),li=q(0,0),_i=q(0,0),ui=q(0,0);t.ManifoldType=void 0,(oi=t.ManifoldType||(t.ManifoldType={}))[oi.e_unset=-1]="e_unset",oi[oi.e_circles=0]="e_circles",oi[oi.e_faceA=1]="e_faceA",oi[oi.e_faceB=2]="e_faceB",t.ContactFeatureType=void 0,(ii=t.ContactFeatureType||(t.ContactFeatureType={}))[ii.e_unset=-1]="e_unset",ii[ii.e_vertex=0]="e_vertex",ii[ii.e_face=1]="e_face",t.PointState=void 0,(ei=t.PointState||(t.PointState={}))[ei.nullState=0]="nullState",ei[ei.addState=1]="addState",ei[ei.persistState=2]="persistState",ei[ei.removeState=3]="removeState";var pi=function(){function t(){this.v=q(0,0),this.id=new fi}return t.prototype.set=function(t){D(this.v,t.v),this.id.set(t.id)},t.prototype.recycle=function(){R(this.v),this.id.recycle()},t}(),yi=function(){function e(){this.localNormal=q(0,0),this.localPoint=q(0,0),this.points=[new di,new di],this.pointCount=0}return e.prototype.set=function(t){this.type=t.type,D(this.localNormal,t.localNormal),D(this.localPoint,t.localPoint),this.pointCount=t.pointCount,this.points[0].set(t.points[0]),this.points[1].set(t.points[1])},e.prototype.recycle=function(){this.type=t.ManifoldType.e_unset,R(this.localNormal),R(this.localPoint),this.pointCount=0,this.points[0].recycle(),this.points[1].recycle()},e.prototype.getWorldManifold=function(e,i,o,s,n){if(0==this.pointCount)return e;(e=e||new vi).pointCount=this.pointCount;var r=e.normal,a=e.points,m=e.separations;switch(this.type){case t.ManifoldType.e_circles:k(r,1,0);var c=this.points[0];at(ri,i,this.localPoint),at(ai,s,c.localPoint),E(li,ai,ri);var h=tt(li);h>1e-18&&J(r,1/ni(h),li),U(ci,1,ri,o,r),U(hi,1,ai,-n,r),U(a[0],.5,ci,.5,hi),m[0]=Q(E(mi,hi,ci),r);break;case t.ManifoldType.e_faceA:ot(r,i.q,this.localNormal),at(_i,i,this.localPoint);for(var l=0;l<this.pointCount;++l)c=this.points[l],at(ui,s,c.localPoint),U(ci,1,ui,o-Q(E(mi,ui,_i),r),r),U(hi,1,ui,-n,r),U(a[l],.5,ci,.5,hi),m[l]=Q(E(mi,hi,ci),r);break;case t.ManifoldType.e_faceB:for(ot(r,s.q,this.localNormal),at(_i,s,this.localPoint),l=0;l<this.pointCount;++l)c=this.points[l],at(ui,i,c.localPoint),U(hi,1,ui,n-Q(E(mi,ui,_i),r),r),U(ci,1,ui,-o,r),U(a[l],.5,ci,.5,hi),m[l]=Q(E(mi,ci,hi),r);O(r)}return e},e.clipSegmentToLine=gi,e.ClipVertex=pi,e.getPointStates=xi,e.PointState=t.PointState,e}(),di=function(){function t(){this.localPoint=q(0,0),this.normalImpulse=0,this.tangentImpulse=0,this.id=new fi}return t.prototype.set=function(t){D(this.localPoint,t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.set(t.id)},t.prototype.recycle=function(){R(this.localPoint),this.normalImpulse=0,this.tangentImpulse=0,this.id.recycle()},t}(),fi=function(){function e(){this.key=-1,this.indexA=-1,this.indexB=-1,this.typeA=t.ContactFeatureType.e_unset,this.typeB=t.ContactFeatureType.e_unset}return e.prototype.setFeatures=function(t,e,i,o){this.indexA=t,this.indexB=i,this.typeA=e,this.typeB=o,this.key=this.indexA+4*this.indexB+16*this.typeA+64*this.typeB},e.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.typeA=t.typeA,this.typeB=t.typeB,this.key=this.indexA+4*this.indexB+16*this.typeA+64*this.typeB},e.prototype.swapFeatures=function(){var t=this.indexA,e=this.indexB,i=this.typeA,o=this.typeB;this.indexA=e,this.indexB=t,this.typeA=o,this.typeB=i,this.key=this.indexA+4*this.indexB+16*this.typeA+64*this.typeB},e.prototype.recycle=function(){this.indexA=0,this.indexB=0,this.typeA=t.ContactFeatureType.e_unset,this.typeB=t.ContactFeatureType.e_unset,this.key=-1},e}(),vi=function(){function t(){this.normal=q(0,0),this.points=[q(0,0),q(0,0)],this.separations=[0,0],this.pointCount=0}return t.prototype.recycle=function(){R(this.normal),R(this.points[0]),R(this.points[1]),this.separations[0]=0,this.separations[1]=0,this.pointCount=0},t}();function xi(e,i,o,s){for(var n=0;n<o.pointCount;++n){var r=o.points[n].id;e[n]=t.PointState.removeState;for(var a=0;a<s.pointCount;++a)if(s.points[a].id.key===r.key){e[n]=t.PointState.persistState;break}}for(n=0;n<s.pointCount;++n)for(r=s.points[n].id,i[n]=t.PointState.addState,a=0;a<o.pointCount;++a)if(o.points[a].id.key===r.key){i[n]=t.PointState.persistState;break}}function gi(e,i,o,s,n){var r=0,a=Q(o,i[0].v)-s,m=Q(o,i[1].v)-s;if(a<=0&&e[r++].set(i[0]),m<=0&&e[r++].set(i[1]),a*m<0){var c=a/(a-m);U(e[r].v,1-c,i[0].v,c,i[1].v),e[r].id.setFeatures(n,t.ContactFeatureType.e_vertex,i[0].id.indexB,t.ContactFeatureType.e_face),++r}return r}var bi=Math.sqrt,Ai=Math.max,Bi=Math.min,wi=new A({create:function(){return new so},release:function(t){t.recycle()}}),Vi=new yi,Ci=new vi,Mi=function(){function t(t){this.prev=null,this.next=null,this.other=null,this.contact=t}return t.prototype.recycle=function(){this.prev=null,this.next=null,this.other=null},t}();function Si(t,e){return bi(t*e)}function Ti(t,e){return t>e?t:e}var Pi=[],Ii=function(){function t(){this.rA=q(0,0),this.rB=q(0,0),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}return t.prototype.recycle=function(){R(this.rA),R(this.rB),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0},t}(),zi=q(0,0),Fi=q(0,0),Li=q(0,0),qi=q(0,0),ki=q(0,0),Di=nt(0,0,0),Ri=nt(0,0,0),Oi=q(0,0),Ni=q(0,0),ji=q(0,0),Ei=q(0,0),Wi=q(0,0),Ji=q(0,0),Yi=q(0,0),Hi=q(0,0),Ui=q(0,0),$i=q(0,0),Gi=q(0,0),Ki=q(0,0),Xi=q(0,0),Zi=q(0,0),Qi=q(0,0),to=q(0,0),eo=q(0,0),io=q(0,0),oo=q(0,0),so=function(){function e(){this.m_nodeA=new Mi(this),this.m_nodeB=new Mi(this),this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=-1,this.m_indexB=-1,this.m_evaluateFcn=null,this.m_manifold=new yi,this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_impulse=new Qe(this),this.v_points=[new Ii,new Ii],this.v_normal=q(0,0),this.v_normalMass=new si,this.v_K=new si,this.v_pointCount=0,this.v_tangentSpeed=0,this.v_friction=0,this.v_restitution=0,this.v_invMassA=0,this.v_invMassB=0,this.v_invIA=0,this.v_invIB=0,this.p_localPoints=[q(0,0),q(0,0)],this.p_localNormal=q(0,0),this.p_localPoint=q(0,0),this.p_localCenterA=q(0,0),this.p_localCenterB=q(0,0),this.p_type=t.ManifoldType.e_unset,this.p_radiusA=0,this.p_radiusB=0,this.p_pointCount=0,this.p_invMassA=0,this.p_invMassB=0,this.p_invIA=0,this.p_invIB=0}return e.prototype.initialize=function(t,e,i,o,s){this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=o,this.m_evaluateFcn=s,this.m_friction=Si(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=Ti(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},e.prototype.recycle=function(){this.m_nodeA.recycle(),this.m_nodeB.recycle(),this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=-1,this.m_indexB=-1,this.m_evaluateFcn=null,this.m_manifold.recycle(),this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_impulse.recycle();for(var e=0,i=this.v_points;e<i.length;e++)i[e].recycle();R(this.v_normal),this.v_normalMass.setZero(),this.v_K.setZero(),this.v_pointCount=0,this.v_tangentSpeed=0,this.v_friction=0,this.v_restitution=0,this.v_invMassA=0,this.v_invMassB=0,this.v_invIA=0,this.v_invIB=0;for(var o=0,s=this.p_localPoints;o<s.length;o++)R(s[o]);R(this.p_localNormal),R(this.p_localPoint),R(this.p_localCenterA),R(this.p_localCenterB),this.p_type=t.ManifoldType.e_unset,this.p_radiusA=0,this.p_radiusB=0,this.p_pointCount=0,this.p_invMassA=0,this.p_invMassB=0,this.p_invIA=0,this.p_invIB=0},e.prototype.initConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var o=e.m_body,s=i.m_body;if(null!==o&&null!==s){var n=e.m_shape,r=i.m_shape;if(null!==n&&null!==r){var a=this.m_manifold,m=a.pointCount;this.v_invMassA=o.m_invMass,this.v_invMassB=s.m_invMass,this.v_invIA=o.m_invI,this.v_invIB=s.m_invI,this.v_friction=this.m_friction,this.v_restitution=this.m_restitution,this.v_tangentSpeed=this.m_tangentSpeed,this.v_pointCount=m,this.v_K.setZero(),this.v_normalMass.setZero(),this.p_invMassA=o.m_invMass,this.p_invMassB=s.m_invMass,this.p_invIA=o.m_invI,this.p_invIB=s.m_invI,D(this.p_localCenterA,o.m_sweep.localCenter),D(this.p_localCenterB,s.m_sweep.localCenter),this.p_radiusA=n.m_radius,this.p_radiusB=r.m_radius,this.p_type=a.type,D(this.p_localNormal,a.localNormal),D(this.p_localPoint,a.localPoint),this.p_pointCount=m;for(var c=0;c<b.maxManifoldPoints;++c)this.v_points[c].recycle(),R(this.p_localPoints[c]);for(c=0;c<m;++c){var h=a.points[c],l=this.v_points[c];t.warmStarting&&(l.normalImpulse=t.dtRatio*h.normalImpulse,l.tangentImpulse=t.dtRatio*h.tangentImpulse),D(this.p_localPoints[c],h.localPoint)}}}}},e.prototype.getManifold=function(){return this.m_manifold},e.prototype.getWorldManifold=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var o=e.m_body,s=i.m_body;if(null!==o&&null!==s){var n=e.m_shape,r=i.m_shape;if(null!==n&&null!==r)return this.m_manifold.getWorldManifold(t,o.getTransform(),n.m_radius,s.getTransform(),r.m_radius)}}},e.prototype.setEnabled=function(t){this.m_enabledFlag=!!t},e.prototype.isEnabled=function(){return this.m_enabledFlag},e.prototype.isTouching=function(){return this.m_touchingFlag},e.prototype.getNext=function(){return this.m_next},e.prototype.getFixtureA=function(){return this.m_fixtureA},e.prototype.getFixtureB=function(){return this.m_fixtureB},e.prototype.getChildIndexA=function(){return this.m_indexA},e.prototype.getChildIndexB=function(){return this.m_indexB},e.prototype.flagForFiltering=function(){this.m_filterFlag=!0},e.prototype.setFriction=function(t){this.m_friction=t},e.prototype.getFriction=function(){return this.m_friction},e.prototype.resetFriction=function(){var t=this.m_fixtureA,e=this.m_fixtureB;null!==t&&null!==e&&(this.m_friction=Si(t.m_friction,e.m_friction))},e.prototype.setRestitution=function(t){this.m_restitution=t},e.prototype.getRestitution=function(){return this.m_restitution},e.prototype.resetRestitution=function(){var t=this.m_fixtureA,e=this.m_fixtureB;null!==t&&null!==e&&(this.m_restitution=Ti(t.m_restitution,e.m_restitution))},e.prototype.setTangentSpeed=function(t){this.m_tangentSpeed=t},e.prototype.getTangentSpeed=function(){return this.m_tangentSpeed},e.prototype.evaluate=function(t,e,i){var o=this.m_fixtureA,s=this.m_fixtureB;null!==o&&null!==s&&this.m_evaluateFcn(t,e,o,this.m_indexA,i,s,this.m_indexB)},e.prototype.update=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var o=e.m_body,s=i.m_body;if(null!==o&&null!==s){var n=e.m_shape,r=i.m_shape;if(null!==n&&null!==r){this.m_enabledFlag=!0;var a=!1,m=this.m_touchingFlag,c=e.m_isSensor,h=i.m_isSensor,l=c||h,_=o.m_xf,u=s.m_xf;if(l)a=pe(n,this.m_indexA,r,this.m_indexB,_,u),this.m_manifold.pointCount=0;else{Vi.recycle(),Vi.set(this.m_manifold),this.m_manifold.recycle(),this.evaluate(this.m_manifold,_,u),a=this.m_manifold.pointCount>0;for(var p=0;p<this.m_manifold.pointCount;++p){var y=this.m_manifold.points[p];y.normalImpulse=0,y.tangentImpulse=0;for(var d=0;d<Vi.pointCount;++d){var f=Vi.points[d];if(f.id.key===y.id.key){y.normalImpulse=f.normalImpulse,y.tangentImpulse=f.tangentImpulse;break}}}a!==m&&(o.setAwake(!0),s.setAwake(!0))}this.m_touchingFlag=a;var v="object"==typeof t&&null!==t;!m&&a&&v&&t.beginContact(this),m&&!a&&v&&t.endContact(this),!l&&a&&v&&Vi&&t.preSolve(this,Vi)}}}},e.prototype.solvePositionConstraint=function(t){return this._solvePositionConstraint(t,null,null)},e.prototype.solvePositionConstraintTOI=function(t,e,i){return this._solvePositionConstraint(t,e,i)},e.prototype._solvePositionConstraint=function(e,i,o){var s=null!==i&&null!==o,n=0,r=this.m_fixtureA,a=this.m_fixtureB;if(null===r||null===a)return n;var m=r.m_body,h=a.m_body;if(null===m||null===h)return n;m.c_velocity,h.c_velocity;var l=m.c_position,_=h.c_position,u=this.p_localCenterA,p=this.p_localCenterB,y=0,d=0;s&&m!==i&&m!==o||(y=this.p_invMassA,d=this.p_invIA);var f=0,v=0;s&&h!==i&&h!==o||(f=this.p_invMassB,v=this.p_invIB),D(zi,l.c);var x=l.a;D(Li,_.c);for(var g=_.a,A=0;A<this.p_pointCount;++A){wt(Di,u,zi,x),wt(Ri,p,Li,g);var B=void 0;switch(this.p_type){case t.ManifoldType.e_circles:at(Oi,Di,this.p_localPoint),at(Ni,Ri,this.p_localPoints[0]),E(Hi,Ni,Oi),G(Hi),U(Ui,.5,Oi,.5,Ni),B=Q(Ni,Hi)-Q(Oi,Hi)-this.p_radiusA-this.p_radiusB;break;case t.ManifoldType.e_faceA:ot(Hi,Di.q,this.p_localNormal),at(Ei,Di,this.p_localPoint),at(ji,Ri,this.p_localPoints[A]),B=Q(ji,Hi)-Q(Ei,Hi)-this.p_radiusA-this.p_radiusB,D(Ui,ji);break;case t.ManifoldType.e_faceB:ot(Hi,Ri.q,this.p_localNormal),at(Ei,Ri,this.p_localPoint),at(ji,Di,this.p_localPoints[A]),B=Q(ji,Hi)-Q(Ei,Hi)-this.p_radiusA-this.p_radiusB,D(Ui,ji),O(Hi);break;default:return n}E(Wi,Ui,zi),E(Ji,Ui,Li),n=Bi(n,B);var w=c((s?b.toiBaugarte:b.baumgarte)*(B+b.linearSlop),-b.maxLinearCorrection,0),V=Z(Wi,Hi),C=Z(Ji,Hi),M=y+f+d*V*V+v*C*C;J(Yi,M>0?-w/M:0,Hi),H(zi,y,Yi),x-=d*Z(Wi,Yi),Y(Li,f,Yi),g+=v*Z(Ji,Yi)}return D(l.c,zi),l.a=x,D(_.c,Li),_.a=g,n},e.prototype.initVelocityConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var o=e.m_body,s=i.m_body;if(null!==o&&null!==s){var n=o.c_velocity,r=s.c_velocity,a=o.c_position,m=s.c_position,c=this.p_radiusA,h=this.p_radiusB,l=this.m_manifold,_=this.v_invMassA,u=this.v_invMassB,p=this.v_invIA,y=this.v_invIB,d=this.p_localCenterA,f=this.p_localCenterB;D(zi,a.c);var v=a.a;D(Fi,n.v);var x=n.w;D(Li,m.c);var g=m.a;D(qi,r.v);var A=r.w;wt(Di,d,zi,v),wt(Ri,f,Li,g),Ci.recycle(),l.getWorldManifold(Ci,Di,c,Ri,h),D(this.v_normal,Ci.normal);for(var B=0;B<this.v_pointCount;++B){var w=this.v_points[B],V=Ci.points[B];E(w.rA,V,zi),E(w.rB,V,Li);var C=Z(w.rA,this.v_normal),M=Z(w.rB,this.v_normal),S=_+u+p*C*C+y*M*M;w.normalMass=S>0?1/S:0,K(ki,this.v_normal,1);var T=Z(w.rA,ki),P=Z(w.rB,ki),I=_+u+p*T*T+y*P*P;w.tangentMass=I>0?1/I:0,w.velocityBias=0;var z=0;z+=Q(this.v_normal,qi),z+=Q(this.v_normal,X(oo,A,w.rB)),z-=Q(this.v_normal,Fi),(z-=Q(this.v_normal,X(oo,x,w.rA)))<-b.velocityThreshold&&(w.velocityBias=-this.v_restitution*z)}if(2==this.v_pointCount&&t.blockSolve){var F=this.v_points[0],L=this.v_points[1],q=Z(F.rA,this.v_normal),k=Z(F.rB,this.v_normal),R=Z(L.rA,this.v_normal),O=Z(L.rB,this.v_normal),N=_+u+p*q*q+y*k*k,j=_+u+p*R*R+y*O*O,W=_+u+p*q*R+y*k*O;if(N*N<1e3*(N*j-W*W)){this.v_K.ex.setNum(N,W),this.v_K.ey.setNum(W,j);var J=this.v_K.ex.x,Y=this.v_K.ey.x,H=this.v_K.ex.y,U=this.v_K.ey.y,$=J*U-Y*H;0!==$&&($=1/$),this.v_normalMass.ex.x=$*U,this.v_normalMass.ey.x=-$*Y,this.v_normalMass.ex.y=-$*H,this.v_normalMass.ey.y=$*J}else this.v_pointCount=1}D(a.c,zi),a.a=v,D(n.v,Fi),n.w=x,D(m.c,Li),m.a=g,D(r.v,qi),r.w=A}}},e.prototype.warmStartConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var o=e.m_body,s=i.m_body;if(null!==o&&null!==s){var n=o.c_velocity,r=s.c_velocity;o.c_position,s.c_position;var a=this.v_invMassA,m=this.v_invIA,c=this.v_invMassB,h=this.v_invIB;D(Fi,n.v);var l=n.w;D(qi,r.v);var _=r.w;D(Hi,this.v_normal),K(ki,Hi,1);for(var u=0;u<this.v_pointCount;++u){var p=this.v_points[u];U(Yi,p.normalImpulse,Hi,p.tangentImpulse,ki),l-=m*Z(p.rA,Yi),H(Fi,a,Yi),_+=h*Z(p.rB,Yi),Y(qi,c,Yi)}D(n.v,Fi),n.w=l,D(r.v,qi),r.w=_}}},e.prototype.storeConstraintImpulses=function(t){for(var e=this.m_manifold,i=0;i<this.v_pointCount;++i)e.points[i].normalImpulse=this.v_points[i].normalImpulse,e.points[i].tangentImpulse=this.v_points[i].tangentImpulse},e.prototype.solveVelocityConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB;if(null!==e&&null!==i){var o=e.m_body,s=i.m_body;if(null!==o&&null!==s){var n=o.c_velocity;o.c_position;var r=s.c_velocity;s.c_position;var a=this.v_invMassA,m=this.v_invIA,h=this.v_invMassB,l=this.v_invIB;D(Fi,n.v);var _=n.w;D(qi,r.v);var u=r.w;D(Hi,this.v_normal),K(ki,Hi,1);for(var p=this.v_friction,y=0;y<this.v_pointCount;++y){var d=this.v_points[y];R($i),N($i,qi),N($i,X(oo,u,d.rB)),j($i,Fi),j($i,X(oo,_,d.rA));var f=Q($i,ki)-this.v_tangentSpeed,v=d.tangentMass*-f,x=p*d.normalImpulse;v=(b=c(d.tangentImpulse+v,-x,x))-d.tangentImpulse,d.tangentImpulse=b,J(Yi,v,ki),H(Fi,a,Yi),_-=m*Z(d.rA,Yi),Y(qi,h,Yi),u+=l*Z(d.rB,Yi)}if(1==this.v_pointCount||0==t.blockSolve)for(var g=0;g<this.v_pointCount;++g){d=this.v_points[g],R($i),N($i,qi),N($i,X(oo,u,d.rB)),j($i,Fi),j($i,X(oo,_,d.rA));var b,A=Q($i,Hi);v=-d.normalMass*(A-d.velocityBias),v=(b=Ai(d.normalImpulse+v,0))-d.normalImpulse,d.normalImpulse=b,J(Yi,v,Hi),H(Fi,a,Yi),_-=m*Z(d.rA,Yi),Y(qi,h,Yi),u+=l*Z(d.rB,Yi)}else{var B=this.v_points[0],w=this.v_points[1];k(Zi,B.normalImpulse,w.normalImpulse),R(Gi),N(Gi,qi),N(Gi,X(oo,u,B.rB)),j(Gi,Fi),j(Gi,X(oo,_,B.rA)),R(Ki),N(Ki,qi),N(Ki,X(oo,u,w.rB)),j(Ki,Fi),j(Ki,X(oo,_,w.rA));var V=Q(Gi,Hi),C=Q(Ki,Hi);for(k(Xi,V-B.velocityBias,C-w.velocityBias),Xi.x-=this.v_K.ex.x*Zi.x+this.v_K.ey.x*Zi.y,Xi.y-=this.v_K.ex.y*Zi.x+this.v_K.ey.y*Zi.y;;){if(R(Qi),Qi.x=-(this.v_normalMass.ex.x*Xi.x+this.v_normalMass.ey.x*Xi.y),Qi.y=-(this.v_normalMass.ex.y*Xi.x+this.v_normalMass.ey.y*Xi.y),Qi.x>=0&&Qi.y>=0){E(to,Qi,Zi),J(eo,to.x,Hi),J(io,to.y,Hi),$(Fi,-a,eo,-a,io,1,Fi),_-=m*(Z(B.rA,eo)+Z(w.rA,io)),$(qi,h,eo,h,io,1,qi),u+=l*(Z(B.rB,eo)+Z(w.rB,io)),B.normalImpulse=Qi.x,w.normalImpulse=Qi.y;break}if(Qi.x=-B.normalMass*Xi.x,Qi.y=0,V=0,C=this.v_K.ex.y*Qi.x+Xi.y,Qi.x>=0&&C>=0){E(to,Qi,Zi),J(eo,to.x,Hi),J(io,to.y,Hi),$(Fi,-a,eo,-a,io,1,Fi),_-=m*(Z(B.rA,eo)+Z(w.rA,io)),$(qi,h,eo,h,io,1,qi),u+=l*(Z(B.rB,eo)+Z(w.rB,io)),B.normalImpulse=Qi.x,w.normalImpulse=Qi.y;break}if(Qi.x=0,Qi.y=-w.normalMass*Xi.y,V=this.v_K.ey.x*Qi.y+Xi.x,C=0,Qi.y>=0&&V>=0){E(to,Qi,Zi),J(eo,to.x,Hi),J(io,to.y,Hi),$(Fi,-a,eo,-a,io,1,Fi),_-=m*(Z(B.rA,eo)+Z(w.rA,io)),$(qi,h,eo,h,io,1,qi),u+=l*(Z(B.rB,eo)+Z(w.rB,io)),B.normalImpulse=Qi.x,w.normalImpulse=Qi.y;break}if(Qi.x=0,Qi.y=0,V=Xi.x,C=Xi.y,V>=0&&C>=0){E(to,Qi,Zi),J(eo,to.x,Hi),J(io,to.y,Hi),$(Fi,-a,eo,-a,io,1,Fi),_-=m*(Z(B.rA,eo)+Z(w.rA,io)),$(qi,h,eo,h,io,1,qi),u+=l*(Z(B.rB,eo)+Z(w.rB,io)),B.normalImpulse=Qi.x,w.normalImpulse=Qi.y;break}break}}D(n.v,Fi),n.w=_,D(r.v,qi),r.w=u}}},e.addType=function(t,e,i){Pi[t]=Pi[t]||{},Pi[t][e]=i},e.create=function(t,e,i,o){var s,n=t.m_shape.m_type,r=i.m_shape.m_type,a=wi.allocate();if(s=Pi[n]&&Pi[n][r])a.initialize(t,e,i,o,s);else{if(!(s=Pi[r]&&Pi[r][n]))return null;a.initialize(i,o,t,e,s)}t=a.m_fixtureA,i=a.m_fixtureB,e=a.getChildIndexA(),o=a.getChildIndexB();var m=t.m_body,c=i.m_body;return a.m_nodeA.contact=a,a.m_nodeA.other=c,a.m_nodeA.prev=null,a.m_nodeA.next=m.m_contactList,null!=m.m_contactList&&(m.m_contactList.prev=a.m_nodeA),m.m_contactList=a.m_nodeA,a.m_nodeB.contact=a,a.m_nodeB.other=m,a.m_nodeB.prev=null,a.m_nodeB.next=c.m_contactList,null!=c.m_contactList&&(c.m_contactList.prev=a.m_nodeB),c.m_contactList=a.m_nodeB,0==t.isSensor()&&0==i.isSensor()&&(m.setAwake(!0),c.setAwake(!0)),a},e.destroy=function(t,e){var i=t.m_fixtureA,o=t.m_fixtureB;if(null!==i&&null!==o){var s=i.m_body,n=o.m_body;null!==s&&null!==n&&(t.isTouching()&&e.endContact(t),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==s.m_contactList&&(s.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==n.m_contactList&&(n.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&!i.m_isSensor&&!o.m_isSensor&&(s.setAwake(!0),n.setAwake(!0)),wi.release(t))}},e}(),no={gravity:y.zero(),allowSleep:!0,warmStarting:!0,continuousPhysics:!0,subStepping:!1,blockSolve:!0,velocityIterations:8,positionIterations:3},ro=function(){function t(e){if(!(this instanceof t))return new t(e);this.s_step=new We,e?y.isValid(e)&&(e={gravity:e}):e={},e=s(e,no),this.m_solver=new ti(this),this.m_broadPhase=new I,this.m_contactList=null,this.m_contactCount=0,this.m_bodyList=null,this.m_bodyCount=0,this.m_jointList=null,this.m_jointCount=0,this.m_stepComplete=!0,this.m_allowSleep=e.allowSleep,this.m_gravity=y.clone(e.gravity),this.m_clearForces=!0,this.m_newFixture=!1,this.m_locked=!1,this.m_warmStarting=e.warmStarting,this.m_continuousPhysics=e.continuousPhysics,this.m_subStepping=e.subStepping,this.m_blockSolve=e.blockSolve,this.m_velocityIterations=e.velocityIterations,this.m_positionIterations=e.positionIterations,this.m_t=0,this.m_step_callback=[]}return t.prototype._serialize=function(){for(var t=[],e=[],i=this.getBodyList();i;i=i.getNext())t.push(i);for(var o=this.getJointList();o;o=o.getNext())"function"==typeof o._serialize&&e.push(o);return{gravity:this.m_gravity,bodies:t,joints:e}},t._deserialize=function(e,i,o){if(!e)return new t;var s=new t(e.gravity);if(e.bodies)for(var n=e.bodies.length-1;n>=0;n-=1)s._addBody(o(jt,e.bodies[n],s));if(e.joints)for(n=e.joints.length-1;n>=0;n--)s.createJoint(o(Wt,e.joints[n],s));return s},t.prototype.getBodyList=function(){return this.m_bodyList},t.prototype.getJointList=function(){return this.m_jointList},t.prototype.getContactList=function(){return this.m_contactList},t.prototype.getBodyCount=function(){return this.m_bodyCount},t.prototype.getJointCount=function(){return this.m_jointCount},t.prototype.getContactCount=function(){return this.m_contactCount},t.prototype.setGravity=function(t){this.m_gravity.set(t)},t.prototype.getGravity=function(){return this.m_gravity},t.prototype.isLocked=function(){return this.m_locked},t.prototype.setAllowSleeping=function(t){if(t!=this.m_allowSleep&&(this.m_allowSleep=t,0==this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.setAwake(!0)},t.prototype.getAllowSleeping=function(){return this.m_allowSleep},t.prototype.setWarmStarting=function(t){this.m_warmStarting=t},t.prototype.getWarmStarting=function(){return this.m_warmStarting},t.prototype.setContinuousPhysics=function(t){this.m_continuousPhysics=t},t.prototype.getContinuousPhysics=function(){return this.m_continuousPhysics},t.prototype.setSubStepping=function(t){this.m_subStepping=t},t.prototype.getSubStepping=function(){return this.m_subStepping},t.prototype.setAutoClearForces=function(t){this.m_clearForces=t},t.prototype.getAutoClearForces=function(){return this.m_clearForces},t.prototype.clearForces=function(){for(var t=this.m_bodyList;t;t=t.getNext())t.m_force.setZero(),t.m_torque=0},t.prototype.queryAABB=function(t,e){var i=this.m_broadPhase;this.m_broadPhase.query(t,(function(t){var o=i.getUserData(t);return e(o.fixture)}))},t.prototype.rayCast=function(t,e,i){var o=this.m_broadPhase;this.m_broadPhase.rayCast({maxFraction:1,p1:t,p2:e},(function(t,e){var s=o.getUserData(e),n=s.fixture,r=s.childIndex,a={};if(n.rayCast(a,t,r)){var m=a.fraction,c=y.add(y.mulNumVec2(1-m,t.p1),y.mulNumVec2(m,t.p2));return i(n,c,a.normal,m)}return t.maxFraction}))},t.prototype.getProxyCount=function(){return this.m_broadPhase.getProxyCount()},t.prototype.getTreeHeight=function(){return this.m_broadPhase.getTreeHeight()},t.prototype.getTreeBalance=function(){return this.m_broadPhase.getTreeBalance()},t.prototype.getTreeQuality=function(){return this.m_broadPhase.getTreeQuality()},t.prototype.shiftOrigin=function(t){if(!this.isLocked()){for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.sub(t),e.m_sweep.c0.sub(t),e.m_sweep.c.sub(t);for(var i=this.m_jointList;i;i=i.m_next)i.shiftOrigin(t);this.m_broadPhase.shiftOrigin(t)}},t.prototype._addBody=function(t){this.isLocked()||(t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount)},t.prototype.createBody=function(t,e){if(this.isLocked())return null;var i={};t&&(y.isValid(t)?i={position:t,angle:e}:"object"==typeof t&&(i=t));var o=new jt(this,i);return this._addBody(o),o},t.prototype.createDynamicBody=function(t,e){var i={};return t&&(y.isValid(t)?i={position:t,angle:e}:"object"==typeof t&&(i=t)),i.type="dynamic",this.createBody(i)},t.prototype.createKinematicBody=function(t,e){var i={};return t&&(y.isValid(t)?i={position:t,angle:e}:"object"==typeof t&&(i=t)),i.type="kinematic",this.createBody(i)},t.prototype.destroyBody=function(t){if(!this.isLocked()){if(t.m_destroyed)return!1;for(var e=t.m_jointList;e;){var i=e;e=e.next,this.publish("remove-joint",i.joint),this.destroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;for(var o=t.m_contactList;o;){var s=o;o=o.next,this.destroyContact(s.contact),t.m_contactList=o}t.m_contactList=null;for(var n=t.m_fixtureList;n;){var r=n;n=n.m_next,this.publish("remove-fixture",r),r.destroyProxies(this.m_broadPhase),t.m_fixtureList=n}return t.m_fixtureList=null,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),t.m_destroyed=!0,--this.m_bodyCount,this.publish("remove-body",t),!0}},t.prototype.createJoint=function(t){if(this.isLocked())return null;if(t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB,0==t.m_collideConnected)for(var e=t.m_bodyB.getContactList();e;e=e.next)e.other==t.m_bodyA&&e.contact.flagForFiltering();return t},t.prototype.destroyJoint=function(t){if(!this.isLocked()){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var e=t.m_bodyA,i=t.m_bodyB;if(e.setAwake(!0),i.setAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==e.m_jointList&&(e.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==i.m_jointList&&(i.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,--this.m_jointCount,0==t.m_collideConnected)for(var o=i.getContactList();o;)o.other==e&&o.contact.flagForFiltering(),o=o.next;this.publish("remove-joint",t)}},t.prototype.step=function(t,e,i){if(this.publish("pre-step",t),(0|e)!==e&&(e=0),e=e||this.m_velocityIterations,i=i||this.m_positionIterations,this.m_newFixture&&(this.findNewContacts(),this.m_newFixture=!1),this.m_locked=!0,this.s_step.reset(t),this.s_step.velocityIterations=e,this.s_step.positionIterations=i,this.s_step.warmStarting=this.m_warmStarting,this.s_step.blockSolve=this.m_blockSolve,this.updateContacts(),this.m_stepComplete&&t>0){this.m_solver.solveWorld(this.s_step);for(var o=this.m_bodyList;o;o=o.getNext())0!=o.m_islandFlag&&(o.isStatic()||o.synchronizeFixtures());this.findNewContacts()}var s;for(this.m_continuousPhysics&&t>0&&this.m_solver.solveWorldTOI(this.s_step),this.m_clearForces&&this.clearForces(),this.m_locked=!1;s=this.m_step_callback.shift();)s(this);this.publish("post-step",t)},t.prototype.queueUpdate=function(t){this.isLocked()?this.m_step_callback.push(t):t(this)},t.prototype.findNewContacts=function(){var t=this;this.m_broadPhase.updatePairs((function(e,i){return t.createContact(e,i)}))},t.prototype.createContact=function(t,e){var i=t.fixture,o=e.fixture,s=t.childIndex,n=e.childIndex,r=i.getBody(),a=o.getBody();if(r!=a){for(var m=a.getContactList();m;){if(m.other==r){var c=m.contact.getFixtureA(),h=m.contact.getFixtureB(),l=m.contact.getChildIndexA(),_=m.contact.getChildIndexB();if(c==i&&h==o&&l==s&&_==n)return;if(c==o&&h==i&&l==n&&_==s)return}m=m.next}if(0!=a.shouldCollide(r)&&0!=o.shouldCollide(i)){var u=so.create(i,s,o,n);null!=u&&(u.m_prev=null,null!=this.m_contactList&&(u.m_next=this.m_contactList,this.m_contactList.m_prev=u),this.m_contactList=u,++this.m_contactCount)}}},t.prototype.updateContacts=function(){for(var t,e=this.m_contactList;t=e;){e=t.getNext();var i=t.getFixtureA(),o=t.getFixtureB(),s=t.getChildIndexA(),n=t.getChildIndexB(),r=i.getBody(),a=o.getBody();if(t.m_filterFlag){if(0==a.shouldCollide(r)){this.destroyContact(t);continue}if(0==o.shouldCollide(i)){this.destroyContact(t);continue}t.m_filterFlag=!1}var m=r.isAwake()&&!r.isStatic(),c=a.isAwake()&&!a.isStatic();if(0!=m||0!=c){var h=i.m_proxies[s].proxyId,l=o.m_proxies[n].proxyId;0!=this.m_broadPhase.testOverlap(h,l)?t.update(this):this.destroyContact(t)}}},t.prototype.destroyContact=function(t){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_contactList&&(this.m_contactList=t.m_next),so.destroy(t,this),--this.m_contactCount},t.prototype.on=function(t,e){return"string"!=typeof t||"function"!=typeof e||(this._listeners||(this._listeners={}),this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e)),this},t.prototype.off=function(t,e){if("string"!=typeof t||"function"!=typeof e)return this;var i=this._listeners&&this._listeners[t];if(!i||!i.length)return this;var o=i.indexOf(e);return o>=0&&i.splice(o,1),this},t.prototype.publish=function(t,e,i,o){var s=this._listeners&&this._listeners[t];if(!s||!s.length)return 0;for(var n=0;n<s.length;n++)s[n].call(this,e,i,o);return s.length},t.prototype.beginContact=function(t){this.publish("begin-contact",t)},t.prototype.endContact=function(t){this.publish("end-contact",t)},t.prototype.preSolve=function(t,e){this.publish("pre-solve",t,e)},t.prototype.postSolve=function(t,e){this.publish("post-solve",t,e)},t}(),ao=function(){function t(e,i,o){if(!(this instanceof t))return new t(e,i,o);void 0===e?(this.x=0,this.y=0,this.z=0):"object"==typeof e?(this.x=e.x,this.y=e.y,this.z=e.z):(this.x=e,this.y=i,this.z=o)}return t.prototype._serialize=function(){return{x:this.x,y:this.y,z:this.z}},t._deserialize=function(e){var i=Object.create(t.prototype);return i.x=e.x,i.y=e.y,i.z=e.z,i},t.neo=function(e,i,o){var s=Object.create(t.prototype);return s.x=e,s.y=i,s.z=o,s},t.zero=function(){var e=Object.create(t.prototype);return e.x=0,e.y=0,e.z=0,e},t.clone=function(e){return t.neo(e.x,e.y,e.z)},t.prototype.toString=function(){return JSON.stringify(this)},t.isValid=function(t){return null!=t&&Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)},t.assert=function(t){},t.prototype.setZero=function(){return this.x=0,this.y=0,this.z=0,this},t.prototype.set=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype.mul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.areEqual=function(t,e){return t===e||"object"==typeof t&&null!==t&&"object"==typeof e&&null!==e&&t.x===e.x&&t.y===e.y&&t.z===e.z},t.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},t.cross=function(e,i){return new t(e.y*i.z-e.z*i.y,e.z*i.x-e.x*i.z,e.x*i.y-e.y*i.x)},t.add=function(e,i){return new t(e.x+i.x,e.y+i.y,e.z+i.z)},t.sub=function(e,i){return new t(e.x-i.x,e.y-i.y,e.z-i.z)},t.mul=function(e,i){return new t(i*e.x,i*e.y,i*e.z)},t.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},t.neg=function(e){return new t(-e.x,-e.y,-e.z)},t}(),mo=q(0,0),co=q(0,0),ho=function(t){function e(i,o){var s=this;return s instanceof e?((s=t.call(this)||this).m_type=e.TYPE,s.m_radius=b.polygonRadius,s.m_vertex1=i?y.clone(i):y.zero(),s.m_vertex2=o?y.clone(o):y.zero(),s.m_vertex0=y.zero(),s.m_vertex3=y.zero(),s.m_hasVertex0=!1,s.m_hasVertex3=!1,s):new e(i,o)}return i(e,t),e.prototype._serialize=function(){return{type:this.m_type,vertex1:this.m_vertex1,vertex2:this.m_vertex2,vertex0:this.m_vertex0,vertex3:this.m_vertex3,hasVertex0:this.m_hasVertex0,hasVertex3:this.m_hasVertex3}},e._deserialize=function(t){var i=new e(t.vertex1,t.vertex2);return i.m_hasVertex0&&i.setPrevVertex(t.vertex0),i.m_hasVertex3&&i.setNextVertex(t.vertex3),i},e.prototype._reset=function(){},e.prototype.getRadius=function(){return this.m_radius},e.prototype.getType=function(){return this.m_type},e.prototype.setNext=function(t){return this.setNextVertex(t)},e.prototype.setNextVertex=function(t){return t?(this.m_vertex3.setVec2(t),this.m_hasVertex3=!0):(this.m_vertex3.setZero(),this.m_hasVertex3=!1),this},e.prototype.getNextVertex=function(){return this.m_vertex3},e.prototype.setPrev=function(t){return this.setPrevVertex(t)},e.prototype.setPrevVertex=function(t){return t?(this.m_vertex0.setVec2(t),this.m_hasVertex0=!0):(this.m_vertex0.setZero(),this.m_hasVertex0=!1),this},e.prototype.getPrevVertex=function(){return this.m_vertex0},e.prototype._set=function(t,e){return this.m_vertex1.setVec2(t),this.m_vertex2.setVec2(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},e.prototype._clone=function(){var t=new e;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_vertex1.setVec2(this.m_vertex1),t.m_vertex2.setVec2(this.m_vertex2),t.m_vertex0.setVec2(this.m_vertex0),t.m_vertex3.setVec2(this.m_vertex3),t.m_hasVertex0=this.m_hasVertex0,t.m_hasVertex3=this.m_hasVertex3,t},e.prototype.getChildCount=function(){return 1},e.prototype.testPoint=function(t,e){return!1},e.prototype.rayCast=function(t,e,i,o){var s=pt.mulTVec2(i.q,y.sub(e.p1,i.p)),n=pt.mulTVec2(i.q,y.sub(e.p2,i.p)),r=y.sub(n,s),a=this.m_vertex1,m=this.m_vertex2,c=y.sub(m,a),h=y.neo(c.y,-c.x);h.normalize();var l=y.dot(h,y.sub(a,s)),_=y.dot(h,r);if(0==_)return!1;var u=l/_;if(u<0||e.maxFraction<u)return!1;var p=y.add(s,y.mulNumVec2(u,r)),d=y.sub(m,a),f=y.dot(d,d);if(0==f)return!1;var v=y.dot(y.sub(p,a),d)/f;return!(v<0||1<v||(t.fraction=u,t.normal=l>0?pt.mulVec2(i.q,h).neg():pt.mulVec2(i.q,h),0))},e.prototype.computeAABB=function(t,e,i){at(mo,e,this.m_vertex1),at(co,e,this.m_vertex2),v.combinePoints(t,mo,co),v.extend(t,this.m_radius)},e.prototype.computeMass=function(t,e){t.mass=0,U(t.center,.5,this.m_vertex1,.5,this.m_vertex2),t.I=0},e.prototype.computeDistanceProxy=function(t){t.m_vertices[0]=this.m_vertex1,t.m_vertices[1]=this.m_vertex2,t.m_vertices.length=2,t.m_count=2,t.m_radius=this.m_radius},e.TYPE="edge",e}(Vt),lo=ho,_o=q(0,0),uo=q(0,0),po=function(t){function e(i,o){var s=this;return s instanceof e?((s=t.call(this)||this).m_type=e.TYPE,s.m_radius=b.polygonRadius,s.m_vertices=[],s.m_count=0,s.m_prevVertex=null,s.m_nextVertex=null,s.m_hasPrevVertex=!1,s.m_hasNextVertex=!1,s.m_isLoop=!!o,i&&i.length&&(o?s._createLoop(i):s._createChain(i)),s):new e(i,o)}return i(e,t),e.prototype._serialize=function(){var t={type:this.m_type,vertices:this.m_isLoop?this.m_vertices.slice(0,this.m_vertices.length-1):this.m_vertices,isLoop:this.m_isLoop,hasPrevVertex:this.m_hasPrevVertex,hasNextVertex:this.m_hasNextVertex,prevVertex:null,nextVertex:null};return this.m_prevVertex&&(t.prevVertex=this.m_prevVertex),this.m_nextVertex&&(t.nextVertex=this.m_nextVertex),t},e._deserialize=function(t,i,o){var s=[];if(t.vertices)for(var n=0;n<t.vertices.length;n++)s.push(o(y,t.vertices[n]));var r=new e(s,t.isLoop);return t.prevVertex&&r.setPrevVertex(t.prevVertex),t.nextVertex&&r.setNextVertex(t.nextVertex),r},e.prototype.getType=function(){return this.m_type},e.prototype.getRadius=function(){return this.m_radius},e.prototype._createLoop=function(t){if(!(t.length<3)){for(var e=1;e<t.length;++e)t[e-1],t[e];for(this.m_vertices=[],this.m_count=t.length+1,e=0;e<t.length;++e)this.m_vertices[e]=y.clone(t[e]);return this.m_vertices[t.length]=y.clone(t[0]),this.m_prevVertex=this.m_vertices[this.m_count-2],this.m_nextVertex=this.m_vertices[1],this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this}},e.prototype._createChain=function(t){for(var e=1;e<t.length;++e)t[e-1],t[e];for(this.m_vertices=[],this.m_count=t.length,e=0;e<t.length;++e)this.m_vertices[e]=y.clone(t[e]);return this.m_prevVertex=null,this.m_nextVertex=null,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this},e.prototype._reset=function(){this.m_isLoop?this._createLoop(this.m_vertices.slice(0,this.m_vertices.length-1)):this._createChain(this.m_vertices)},e.prototype.setPrevVertex=function(t){this.m_prevVertex=t,this.m_hasPrevVertex=!0},e.prototype.getPrevVertex=function(){return this.m_prevVertex},e.prototype.setNextVertex=function(t){this.m_nextVertex=t,this.m_hasNextVertex=!0},e.prototype.getNextVertex=function(){return this.m_nextVertex},e.prototype._clone=function(){var t=new e;return t._createChain(this.m_vertices),t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_prevVertex=this.m_prevVertex,t.m_nextVertex=this.m_nextVertex,t.m_hasPrevVertex=this.m_hasPrevVertex,t.m_hasNextVertex=this.m_hasNextVertex,t},e.prototype.getChildCount=function(){return this.m_count-1},e.prototype.getChildEdge=function(t,e){t.m_type=ho.TYPE,t.m_radius=this.m_radius,t.m_vertex1=this.m_vertices[e],t.m_vertex2=this.m_vertices[e+1],e>0?(t.m_vertex0=this.m_vertices[e-1],t.m_hasVertex0=!0):(t.m_vertex0=this.m_prevVertex,t.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(t.m_vertex3=this.m_vertices[e+2],t.m_hasVertex3=!0):(t.m_vertex3=this.m_nextVertex,t.m_hasVertex3=this.m_hasNextVertex)},e.prototype.getVertex=function(t){return t<this.m_count?this.m_vertices[t]:this.m_vertices[0]},e.prototype.isLoop=function(){return this.m_isLoop},e.prototype.testPoint=function(t,e){return!1},e.prototype.rayCast=function(t,e,i,o){return new ho(this.getVertex(o),this.getVertex(o+1)).rayCast(t,e,i,0)},e.prototype.computeAABB=function(t,e,i){at(_o,e,this.getVertex(i)),at(uo,e,this.getVertex(i+1)),v.combinePoints(t,_o,uo)},e.prototype.computeMass=function(t,e){t.mass=0,R(t.center),t.I=0},e.prototype.computeDistanceProxy=function(t,e){t.m_vertices[0]=this.getVertex(e),t.m_vertices[1]=this.getVertex(e+1),t.m_count=2,t.m_radius=this.m_radius},e.TYPE="chain",e}(Vt),yo=po,fo=Math.max,vo=Math.min,xo=q(0,0),go=q(0,0),bo=q(0,0),Ao=q(0,0),Bo=q(0,0),wo=q(0,0),Vo=function(t){function e(i){var o=this;return o instanceof e?((o=t.call(this)||this).m_type=e.TYPE,o.m_radius=b.polygonRadius,o.m_centroid=y.zero(),o.m_vertices=[],o.m_normals=[],o.m_count=0,i&&i.length&&o._set(i),o):new e(i)}return i(e,t),e.prototype._serialize=function(){return{type:this.m_type,vertices:this.m_vertices}},e._deserialize=function(t,i,o){var s=[];if(t.vertices)for(var n=0;n<t.vertices.length;n++)s.push(o(y,t.vertices[n]));return new e(s)},e.prototype.getType=function(){return this.m_type},e.prototype.getRadius=function(){return this.m_radius},e.prototype._clone=function(){var t=new e;t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_count=this.m_count,t.m_centroid.setVec2(this.m_centroid);for(var i=0;i<this.m_count;i++)t.m_vertices.push(this.m_vertices[i].clone());for(i=0;i<this.m_normals.length;i++)t.m_normals.push(this.m_normals[i].clone());return t},e.prototype.getChildCount=function(){return 1},e.prototype._reset=function(){this._set(this.m_vertices)},e.prototype._set=function(t){if(t.length<3)this._setAsBox(1,1);else{for(var e=vo(t.length,b.maxPolygonVertices),i=[],o=0;o<e;++o){for(var s=t[o],n=!0,r=0;r<i.length;++r)if(y.distanceSquared(s,i[r])<.25*b.linearSlopSquared){n=!1;break}n&&i.push(y.clone(s))}if((e=i.length)<3)this._setAsBox(1,1);else{var a=0,m=i[0].x;for(o=1;o<e;++o){var c=i[o].x;(c>m||c===m&&i[o].y<i[a].y)&&(a=o,m=c)}for(var h=[],l=0,_=a;;){h[l]=_;var u=0;for(r=1;r<e;++r)if(u!==_){var p=y.sub(i[u],i[h[l]]),d=(s=y.sub(i[r],i[h[l]]),y.crossVec2Vec2(p,s));d<0&&(u=r),0===d&&s.lengthSquared()>p.lengthSquared()&&(u=r)}else u=r;if(++l,_=u,u===a)break}if(l<3)this._setAsBox(1,1);else{for(this.m_count=l,this.m_vertices=[],o=0;o<l;++o)this.m_vertices[o]=i[h[o]];for(o=0;o<l;++o){var f=o,v=o+1<l?o+1:0,x=y.sub(this.m_vertices[v],this.m_vertices[f]);this.m_normals[o]=y.crossVec2Num(x,1),this.m_normals[o].normalize()}this.m_centroid=function(t,e){for(var i=y.zero(),o=0,s=y.zero(),n=1/3,r=0;r<e;++r){var a=s,m=t[r],c=r+1<e?t[r+1]:t[0],h=y.sub(m,a),l=y.sub(c,a),_=.5*y.crossVec2Vec2(h,l);o+=_,$(xo,1,a,1,m,1,c),Y(i,_*n,xo)}return i.mul(1/o),i}(this.m_vertices,l)}}}},e.prototype._setAsBox=function(t,e,i,o){if(this.m_vertices[0]=y.neo(t,-e),this.m_vertices[1]=y.neo(t,e),this.m_vertices[2]=y.neo(-t,e),this.m_vertices[3]=y.neo(-t,-e),this.m_normals[0]=y.neo(1,0),this.m_normals[1]=y.neo(0,1),this.m_normals[2]=y.neo(-1,0),this.m_normals[3]=y.neo(0,-1),this.m_count=4,i&&y.isValid(i)){o=o||0,D(this.m_centroid,i);var s=xt.identity();s.p.setVec2(i),s.q.setAngle(o);for(var n=0;n<this.m_count;++n)this.m_vertices[n]=xt.mulVec2(s,this.m_vertices[n]),this.m_normals[n]=pt.mulVec2(s.q,this.m_normals[n])}},e.prototype.testPoint=function(t,e){for(var i=mt(xo,t,e),o=0;o<this.m_count;++o)if(Q(this.m_normals[o],i)-Q(this.m_normals[o],this.m_vertices[o])>0)return!1;return!0},e.prototype.rayCast=function(t,e,i,o){for(var s=pt.mulTVec2(i.q,y.sub(e.p1,i.p)),n=pt.mulTVec2(i.q,y.sub(e.p2,i.p)),r=y.sub(n,s),a=0,m=e.maxFraction,c=-1,h=0;h<this.m_count;++h){var l=y.dot(this.m_normals[h],y.sub(this.m_vertices[h],s)),_=y.dot(this.m_normals[h],r);if(0==_){if(l<0)return!1}else _<0&&l<a*_?(a=l/_,c=h):_>0&&l<m*_&&(m=l/_);if(m<a)return!1}return c>=0&&(t.fraction=a,t.normal=pt.mulVec2(i.q,this.m_normals[c]),!0)},e.prototype.computeAABB=function(t,e,i){for(var o=1/0,s=1/0,n=-1/0,r=-1/0,a=0;a<this.m_count;++a){var m=at(xo,e,this.m_vertices[a]);o=vo(o,m.x),n=fo(n,m.x),s=vo(s,m.y),r=fo(r,m.y)}k(t.lowerBound,o-this.m_radius,s-this.m_radius),k(t.upperBound,n+this.m_radius,r+this.m_radius)},e.prototype.computeMass=function(t,e){R(Bo);var i=0,o=0;R(wo);for(var s=0;s<this.m_count;++s)N(wo,this.m_vertices[s]);J(wo,1/this.m_count,wo);var n,r,a,m=1/3;for(s=0;s<this.m_count;++s){E(bo,this.m_vertices[s],wo),s+1<this.m_count?E(Ao,this.m_vertices[s+1],wo):E(Ao,this.m_vertices[0],wo);var c=Z(bo,Ao),h=.5*c;i+=h,U(xo,h*m,bo,h*m,Ao),N(Bo,xo);var l=bo.x,_=bo.y,u=Ao.x,p=Ao.y;o+=.25*m*c*(l*l+u*l+u*u+(_*_+p*_+p*p))}t.mass=e*i,J(Bo,1/i,Bo),n=t.center,r=Bo,a=wo,n.x=r.x+a.x,n.y=r.x+a.y,t.I=e*o,t.I+=t.mass*(Q(t.center,t.center)-Q(Bo,Bo))},e.prototype.validate=function(){for(var t=0;t<this.m_count;++t){var e=t,i=t<this.m_count-1?e+1:0,o=this.m_vertices[e];E(go,this.m_vertices[i],o);for(var s=0;s<this.m_count;++s)if(s!=e&&s!=i&&Z(go,E(xo,this.m_vertices[s],o))<0)return!1}return!0},e.prototype.computeDistanceProxy=function(t){for(var e=0;e<this.m_count;++e)t.m_vertices[e]=this.m_vertices[e];t.m_vertices.length=this.m_count,t.m_count=this.m_count,t.m_radius=this.m_radius},e.TYPE="polygon",e}(Vt);var Co,Mo,So=Vo,To=Math.sqrt,Po=Math.PI,Io=q(0,0),zo=function(t){function e(i,o){var s=this;return s instanceof e?((s=t.call(this)||this).m_type=e.TYPE,s.m_p=y.zero(),s.m_radius=1,"object"==typeof i&&y.isValid(i)?(s.m_p.setVec2(i),"number"==typeof o&&(s.m_radius=o)):"number"==typeof i&&(s.m_radius=i),s):new e(i,o)}return i(e,t),e.prototype._serialize=function(){return{type:this.m_type,p:this.m_p,radius:this.m_radius}},e._deserialize=function(t){return new e(t.p,t.radius)},e.prototype._reset=function(){},e.prototype.getType=function(){return this.m_type},e.prototype.getRadius=function(){return this.m_radius},e.prototype.getCenter=function(){return this.m_p},e.prototype._clone=function(){var t=new e;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_p=this.m_p.clone(),t},e.prototype.getChildCount=function(){return 1},e.prototype.testPoint=function(t,e){return it(e,at(Io,t,this.m_p))<=this.m_radius*this.m_radius},e.prototype.rayCast=function(t,e,i,o){var s=y.add(i.p,pt.mulVec2(i.q,this.m_p)),n=y.sub(e.p1,s),a=y.dot(n,n)-this.m_radius*this.m_radius,m=y.sub(e.p2,e.p1),c=y.dot(n,m),h=y.dot(m,m),l=c*c-h*a;if(l<0||h<r)return!1;var _=-(c+To(l));return 0<=_&&_<=e.maxFraction*h&&(_/=h,t.fraction=_,t.normal=y.add(n,y.mulNumVec2(_,m)),t.normal.normalize(),!0)},e.prototype.computeAABB=function(t,e,i){var o=at(Io,e,this.m_p);k(t.lowerBound,o.x-this.m_radius,o.y-this.m_radius),k(t.upperBound,o.x+this.m_radius,o.y+this.m_radius)},e.prototype.computeMass=function(t,e){t.mass=e*Po*this.m_radius*this.m_radius,D(t.center,this.m_p),t.I=t.mass*(.5*this.m_radius*this.m_radius+tt(this.m_p))},e.prototype.computeDistanceProxy=function(t){t.m_vertices[0]=this.m_p,t.m_vertices.length=1,t.m_count=1,t.m_radius=this.m_radius},e.TYPE="circle",e}(Vt),Fo=zo,Lo=Math.abs,qo=Math.PI,ko={frequencyHz:0,dampingRatio:0},Do=function(t){function e(i,o,n,r,a){var m=this;if(!(m instanceof e))return new e(i,o,n,r,a);if(n&&r&&"m_type"in r&&"x"in n&&"y"in n){var c=n;n=r,r=c}return i=s(i,ko),o=(m=t.call(this,i,o,n)||this).m_bodyA,n=m.m_bodyB,m.m_type=e.TYPE,m.m_localAnchorA=y.clone(r?o.getLocalPoint(r):i.localAnchorA||y.zero()),m.m_localAnchorB=y.clone(a?n.getLocalPoint(a):i.localAnchorB||y.zero()),m.m_length=Number.isFinite(i.length)?i.length:y.distance(o.getWorldPoint(m.m_localAnchorA),n.getWorldPoint(m.m_localAnchorB)),m.m_frequencyHz=i.frequencyHz,m.m_dampingRatio=i.dampingRatio,m.m_impulse=0,m.m_gamma=0,m.m_bias=0,m}return i(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,length:this.m_length,impulse:this.m_impulse,gamma:this.m_gamma,bias:this.m_bias}},e._deserialize=function(t,i,s){return(t=o({},t)).bodyA=s(jt,t.bodyA,i),t.bodyB=s(jt,t.bodyB,i),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),t.length>0?this.m_length=+t.length:t.length<0||(t.anchorA||t.anchorA||t.anchorA||t.anchorA)&&(this.m_length=y.distance(this.m_bodyA.getWorldPoint(this.m_localAnchorA),this.m_bodyB.getWorldPoint(this.m_localAnchorB))),Number.isFinite(t.frequencyHz)&&(this.m_frequencyHz=t.frequencyHz),Number.isFinite(t.dampingRatio)&&(this.m_dampingRatio=t.dampingRatio)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.setLength=function(t){this.m_length=t},e.prototype.getLength=function(){return this.m_length},e.prototype.setFrequency=function(t){this.m_frequencyHz=t},e.prototype.getFrequency=function(){return this.m_frequencyHz},e.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.getDampingRatio=function(){return this.m_dampingRatio},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return y.mulNumVec2(this.m_impulse,this.m_u).mul(t)},e.prototype.getReactionTorque=function(t){return 0},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,c=pt.neo(i),h=pt.neo(r);this.m_rA=pt.mulVec2(c,y.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=pt.mulVec2(h,y.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_u=y.sub(y.add(n,this.m_rB),y.add(e,this.m_rA));var l=this.m_u.length();l>b.linearSlop?this.m_u.mul(1/l):this.m_u.setNum(0,0);var _=y.crossVec2Vec2(this.m_rA,this.m_u),u=y.crossVec2Vec2(this.m_rB,this.m_u),p=this.m_invMassA+this.m_invIA*_*_+this.m_invMassB+this.m_invIB*u*u;if(this.m_mass=0!=p?1/p:0,this.m_frequencyHz>0){var d=l-this.m_length,f=2*qo*this.m_frequencyHz,v=2*this.m_mass*this.m_dampingRatio*f,x=this.m_mass*f*f,g=t.dt;this.m_gamma=g*(v+g*x),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=d*g*x*this.m_gamma,p+=this.m_gamma,this.m_mass=0!=p?1/p:0}else this.m_gamma=0,this.m_bias=0;if(t.warmStarting){this.m_impulse*=t.dtRatio;var A=y.mulNumVec2(this.m_impulse,this.m_u);o.subMul(this.m_invMassA,A),s-=this.m_invIA*y.crossVec2Vec2(this.m_rA,A),a.addMul(this.m_invMassB,A),m+=this.m_invIB*y.crossVec2Vec2(this.m_rB,A)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(o),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.setVec2(a),this.m_bodyB.c_velocity.w=m},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=y.add(e,y.crossNumVec2(i,this.m_rA)),r=y.add(o,y.crossNumVec2(s,this.m_rB)),a=y.dot(this.m_u,r)-y.dot(this.m_u,n),m=-this.m_mass*(a+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=m;var c=y.mulNumVec2(m,this.m_u);e.subMul(this.m_invMassA,c),i-=this.m_invIA*y.crossVec2Vec2(this.m_rA,c),o.addMul(this.m_invMassB,c),s+=this.m_invIB*y.crossVec2Vec2(this.m_rB,c),this.m_bodyA.c_velocity.v.setVec2(e),this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v.setVec2(o),this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){if(this.m_frequencyHz>0)return!0;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=pt.neo(i),r=pt.neo(s),a=pt.mulSub(n,this.m_localAnchorA,this.m_localCenterA),m=pt.mulSub(r,this.m_localAnchorB,this.m_localCenterB),h=y.sub(y.add(o,m),y.add(e,a)),l=c(h.normalize()-this.m_length,-b.maxLinearCorrection,b.maxLinearCorrection),_=-this.m_mass*l,u=y.mulNumVec2(_,h);return e.subMul(this.m_invMassA,u),i-=this.m_invIA*y.crossVec2Vec2(a,u),o.addMul(this.m_invMassB,u),s+=this.m_invIB*y.crossVec2Vec2(m,u),this.m_bodyA.c_position.c.setVec2(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.setVec2(o),this.m_bodyB.c_position.a=s,Lo(l)<b.linearSlop},e.TYPE="distance-joint",e}(Wt),Ro={maxForce:0,maxTorque:0},Oo=function(t){function e(i,o,n,r){var a=this;return a instanceof e?(i=s(i,Ro),o=(a=t.call(this,i,o,n)||this).m_bodyA,n=a.m_bodyB,a.m_type=e.TYPE,a.m_localAnchorA=y.clone(r?o.getLocalPoint(r):i.localAnchorA||y.zero()),a.m_localAnchorB=y.clone(r?n.getLocalPoint(r):i.localAnchorB||y.zero()),a.m_linearImpulse=y.zero(),a.m_angularImpulse=0,a.m_maxForce=i.maxForce,a.m_maxTorque=i.maxTorque,a):new e(i,o,n,r)}return i(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB}},e._deserialize=function(t,i,s){return(t=o({},t)).bodyA=s(jt,t.bodyA,i),t.bodyB=s(jt,t.bodyB,i),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),Number.isFinite(t.maxForce)&&(this.m_maxForce=t.maxForce),Number.isFinite(t.maxTorque)&&(this.m_maxTorque=t.maxTorque)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.setMaxForce=function(t){this.m_maxForce=t},e.prototype.getMaxForce=function(){return this.m_maxForce},e.prototype.setMaxTorque=function(t){this.m_maxTorque=t},e.prototype.getMaxTorque=function(){return this.m_maxTorque},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return y.mulNumVec2(t,this.m_linearImpulse)},e.prototype.getReactionTorque=function(t){return t*this.m_angularImpulse},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=pt.neo(e),m=pt.neo(s);this.m_rA=pt.mulVec2(a,y.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=pt.mulVec2(m,y.sub(this.m_localAnchorB,this.m_localCenterB));var c=this.m_invMassA,h=this.m_invMassB,l=this.m_invIA,_=this.m_invIB,u=new si;if(u.ex.x=c+h+l*this.m_rA.y*this.m_rA.y+_*this.m_rB.y*this.m_rB.y,u.ex.y=-l*this.m_rA.x*this.m_rA.y-_*this.m_rB.x*this.m_rB.y,u.ey.x=u.ex.y,u.ey.y=c+h+l*this.m_rA.x*this.m_rA.x+_*this.m_rB.x*this.m_rB.x,this.m_linearMass=u.getInverse(),this.m_angularMass=l+_,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;var p=y.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);i.subMul(c,p),o-=l*(y.crossVec2Vec2(this.m_rA,p)+this.m_angularImpulse),n.addMul(h,p),r+=_*(y.crossVec2Vec2(this.m_rB,p)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,m=this.m_invIB,h=t.dt,l=s-i,_=-this.m_angularMass*l,u=this.m_angularImpulse,p=h*this.m_maxTorque;this.m_angularImpulse=c(this.m_angularImpulse+_,-p,p),i-=a*(_=this.m_angularImpulse-u),s+=m*_,l=y.sub(y.add(o,y.crossNumVec2(s,this.m_rB)),y.add(e,y.crossNumVec2(i,this.m_rA))),_=y.neg(si.mulVec2(this.m_linearMass,l)),u=this.m_linearImpulse,this.m_linearImpulse.add(_),p=h*this.m_maxForce,this.m_linearImpulse.lengthSquared()>p*p&&(this.m_linearImpulse.normalize(),this.m_linearImpulse.mul(p)),_=y.sub(this.m_linearImpulse,u),e.subMul(n,_),i-=a*y.crossVec2Vec2(this.m_rA,_),o.addMul(r,_),s+=m*y.crossVec2Vec2(this.m_rB,_),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){return!0},e.TYPE="friction-joint",e}(Wt),No=function(){function t(t,e,i){"object"==typeof t&&null!==t?(this.ex=ao.clone(t),this.ey=ao.clone(e),this.ez=ao.clone(i)):(this.ex=ao.zero(),this.ey=ao.zero(),this.ez=ao.zero())}return t.prototype.toString=function(){return JSON.stringify(this)},t.isValid=function(t){return null!=t&&ao.isValid(t.ex)&&ao.isValid(t.ey)&&ao.isValid(t.ez)},t.assert=function(t){},t.prototype.setZero=function(){return this.ex.setZero(),this.ey.setZero(),this.ez.setZero(),this},t.prototype.solve33=function(t){var e=this.ey.y*this.ez.z-this.ey.z*this.ez.y,i=this.ey.z*this.ez.x-this.ey.x*this.ez.z,o=this.ey.x*this.ez.y-this.ey.y*this.ez.x,s=this.ex.x*e+this.ex.y*i+this.ex.z*o;0!==s&&(s=1/s);var n=new ao;return e=this.ey.y*this.ez.z-this.ey.z*this.ez.y,i=this.ey.z*this.ez.x-this.ey.x*this.ez.z,o=this.ey.x*this.ez.y-this.ey.y*this.ez.x,n.x=s*(t.x*e+t.y*i+t.z*o),e=t.y*this.ez.z-t.z*this.ez.y,i=t.z*this.ez.x-t.x*this.ez.z,o=t.x*this.ez.y-t.y*this.ez.x,n.y=s*(this.ex.x*e+this.ex.y*i+this.ex.z*o),e=this.ey.y*t.z-this.ey.z*t.y,i=this.ey.z*t.x-this.ey.x*t.z,o=this.ey.x*t.y-this.ey.y*t.x,n.z=s*(this.ex.x*e+this.ex.y*i+this.ex.z*o),n},t.prototype.solve22=function(t){var e=this.ex.x,i=this.ey.x,o=this.ex.y,s=this.ey.y,n=e*s-i*o;0!==n&&(n=1/n);var r=y.zero();return r.x=n*(s*t.x-i*t.y),r.y=n*(e*t.y-o*t.x),r},t.prototype.getInverse22=function(t){var e=this.ex.x,i=this.ey.x,o=this.ex.y,s=this.ey.y,n=e*s-i*o;0!==n&&(n=1/n),t.ex.x=n*s,t.ey.x=-n*i,t.ex.z=0,t.ex.y=-n*o,t.ey.y=n*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},t.prototype.getSymInverse33=function(t){var e=ao.dot(this.ex,ao.cross(this.ey,this.ez));0!==e&&(e=1/e);var i=this.ex.x,o=this.ey.x,s=this.ez.x,n=this.ey.y,r=this.ez.y,a=this.ez.z;t.ex.x=e*(n*a-r*r),t.ex.y=e*(s*r-o*a),t.ex.z=e*(o*r-s*n),t.ey.x=t.ex.y,t.ey.y=e*(i*a-s*s),t.ey.z=e*(s*o-i*r),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*n-o*o)},t.mul=function(t,e){if(e&&"z"in e&&"y"in e&&"x"in e){var i=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,o=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,s=t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z;return new ao(i,o,s)}if(e&&"y"in e&&"x"in e)return i=t.ex.x*e.x+t.ey.x*e.y,o=t.ex.y*e.x+t.ey.y*e.y,y.neo(i,o)},t.mulVec3=function(t,e){var i=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,o=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,s=t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z;return new ao(i,o,s)},t.mulVec2=function(t,e){var i=t.ex.x*e.x+t.ey.x*e.y,o=t.ex.y*e.x+t.ey.y*e.y;return y.neo(i,o)},t.add=function(e,i){return new t(ao.add(e.ex,i.ex),ao.add(e.ey,i.ey),ao.add(e.ez,i.ez))},t}(),jo=Math.abs;(Mo=Co||(Co={}))[Mo.inactiveLimit=0]="inactiveLimit",Mo[Mo.atLowerLimit=1]="atLowerLimit",Mo[Mo.atUpperLimit=2]="atUpperLimit",Mo[Mo.equalLimits=3]="equalLimits";var Eo,Wo=0,Jo=0,Yo=0,Ho=0,Uo=!1,$o=!1,Go=function(t){function e(i,o,s,n){var r,a,m,c,h,l,_=this;return _ instanceof e?(i=null!=i?i:{},o=(_=t.call(this,i,o,s)||this).m_bodyA,s=_.m_bodyB,_.m_mass=new No,_.m_limitState=Co.inactiveLimit,_.m_type=e.TYPE,y.isValid(n)?_.m_localAnchorA=o.getLocalPoint(n):y.isValid(i.localAnchorA)?_.m_localAnchorA=y.clone(i.localAnchorA):_.m_localAnchorA=y.zero(),y.isValid(n)?_.m_localAnchorB=s.getLocalPoint(n):y.isValid(i.localAnchorB)?_.m_localAnchorB=y.clone(i.localAnchorB):_.m_localAnchorB=y.zero(),Number.isFinite(i.referenceAngle)?_.m_referenceAngle=i.referenceAngle:_.m_referenceAngle=s.getAngle()-o.getAngle(),_.m_impulse=new ao,_.m_motorImpulse=0,_.m_lowerAngle=null!==(r=i.lowerAngle)&&void 0!==r?r:Wo,_.m_upperAngle=null!==(a=i.upperAngle)&&void 0!==a?a:Jo,_.m_maxMotorTorque=null!==(m=i.maxMotorTorque)&&void 0!==m?m:Yo,_.m_motorSpeed=null!==(c=i.motorSpeed)&&void 0!==c?c:Ho,_.m_enableLimit=null!==(h=i.enableLimit)&&void 0!==h?h:Uo,_.m_enableMotor=null!==(l=i.enableMotor)&&void 0!==l?l:$o,_):new e(i,o,s,n)}return i(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerAngle:this.m_lowerAngle,upperAngle:this.m_upperAngle,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},e._deserialize=function(t,i,s){return(t=o({},t)).bodyA=s(jt,t.bodyA,i),t.bodyB=s(jt,t.bodyB,i),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),Number.isFinite(t.referenceAngle)&&(this.m_referenceAngle=t.referenceAngle),void 0!==t.enableLimit&&(this.m_enableLimit=t.enableLimit),Number.isFinite(t.lowerAngle)&&(this.m_lowerAngle=t.lowerAngle),Number.isFinite(t.upperAngle)&&(this.m_upperAngle=t.upperAngle),Number.isFinite(t.maxMotorTorque)&&(this.m_maxMotorTorque=t.maxMotorTorque),Number.isFinite(t.motorSpeed)&&(this.m_motorSpeed=t.motorSpeed),void 0!==t.enableMotor&&(this.m_enableMotor=t.enableMotor)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.getReferenceAngle=function(){return this.m_referenceAngle},e.prototype.getJointAngle=function(){var t=this.m_bodyA;return this.m_bodyB.m_sweep.a-t.m_sweep.a-this.m_referenceAngle},e.prototype.getJointSpeed=function(){var t=this.m_bodyA;return this.m_bodyB.m_angularVelocity-t.m_angularVelocity},e.prototype.isMotorEnabled=function(){return this.m_enableMotor},e.prototype.enableMotor=function(t){t!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t)},e.prototype.getMotorTorque=function(t){return t*this.m_motorImpulse},e.prototype.setMotorSpeed=function(t){t!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t)},e.prototype.getMotorSpeed=function(){return this.m_motorSpeed},e.prototype.setMaxMotorTorque=function(t){t!=this.m_maxMotorTorque&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t)},e.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},e.prototype.isLimitEnabled=function(){return this.m_enableLimit},e.prototype.enableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},e.prototype.getLowerLimit=function(){return this.m_lowerAngle},e.prototype.getUpperLimit=function(){return this.m_upperAngle},e.prototype.setLimits=function(t,e){t==this.m_lowerAngle&&e==this.m_upperAngle||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return y.neo(this.m_impulse.x,this.m_impulse.y).mul(t)},e.prototype.getReactionTorque=function(t){return t*this.m_impulse.z},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=pt.neo(e),m=pt.neo(s);this.m_rA=pt.mulVec2(a,y.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=pt.mulVec2(m,y.sub(this.m_localAnchorB,this.m_localCenterB));var c=this.m_invMassA,h=this.m_invMassB,l=this.m_invIA,_=this.m_invIB,u=l+_===0;if(this.m_mass.ex.x=c+h+this.m_rA.y*this.m_rA.y*l+this.m_rB.y*this.m_rB.y*_,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*l-this.m_rB.y*this.m_rB.x*_,this.m_mass.ez.x=-this.m_rA.y*l-this.m_rB.y*_,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=c+h+this.m_rA.x*this.m_rA.x*l+this.m_rB.x*this.m_rB.x*_,this.m_mass.ez.y=this.m_rA.x*l+this.m_rB.x*_,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=l+_,this.m_motorMass=l+_,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),(0==this.m_enableMotor||u)&&(this.m_motorImpulse=0),this.m_enableLimit&&0==u){var p=s-e-this.m_referenceAngle;jo(this.m_upperAngle-this.m_lowerAngle)<2*b.angularSlop?this.m_limitState=Co.equalLimits:p<=this.m_lowerAngle?(this.m_limitState!=Co.atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=Co.atLowerLimit):p>=this.m_upperAngle?(this.m_limitState!=Co.atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=Co.atUpperLimit):(this.m_limitState=Co.inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=Co.inactiveLimit;if(t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;var d=y.neo(this.m_impulse.x,this.m_impulse.y);i.subMul(c,d),o-=l*(y.crossVec2Vec2(this.m_rA,d)+this.m_motorImpulse+this.m_impulse.z),n.addMul(h,d),r+=_*(y.crossVec2Vec2(this.m_rB,d)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,m=this.m_invIB,h=a+m===0;if(this.m_enableMotor&&this.m_limitState!=Co.equalLimits&&0==h){var l=s-i-this.m_motorSpeed,_=-this.m_motorMass*l,u=this.m_motorImpulse,p=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=c(this.m_motorImpulse+_,-p,p),i-=a*(_=this.m_motorImpulse-u),s+=m*_}if(this.m_enableLimit&&this.m_limitState!=Co.inactiveLimit&&0==h){var d=y.zero();d.addCombine(1,o,1,y.crossNumVec2(s,this.m_rB)),d.subCombine(1,e,1,y.crossNumVec2(i,this.m_rA));var f=s-i;if(l=new ao(d.x,d.y,f),_=ao.neg(this.m_mass.solve33(l)),this.m_limitState==Co.equalLimits)this.m_impulse.add(_);else if(this.m_limitState==Co.atLowerLimit)if(this.m_impulse.z+_.z<0){var v=y.combine(-1,d,this.m_impulse.z,y.neo(this.m_mass.ez.x,this.m_mass.ez.y)),x=this.m_mass.solve22(v);_.x=x.x,_.y=x.y,_.z=-this.m_impulse.z,this.m_impulse.x+=x.x,this.m_impulse.y+=x.y,this.m_impulse.z=0}else this.m_impulse.add(_);else this.m_limitState==Co.atUpperLimit&&(this.m_impulse.z+_.z>0?(v=y.combine(-1,d,this.m_impulse.z,y.neo(this.m_mass.ez.x,this.m_mass.ez.y)),x=this.m_mass.solve22(v),_.x=x.x,_.y=x.y,_.z=-this.m_impulse.z,this.m_impulse.x+=x.x,this.m_impulse.y+=x.y,this.m_impulse.z=0):this.m_impulse.add(_));var g=y.neo(_.x,_.y);e.subMul(n,g),i-=a*(y.crossVec2Vec2(this.m_rA,g)+_.z),o.addMul(r,g),s+=m*(y.crossVec2Vec2(this.m_rB,g)+_.z)}else(l=y.zero()).addCombine(1,o,1,y.crossNumVec2(s,this.m_rB)),l.subCombine(1,e,1,y.crossNumVec2(i,this.m_rA)),_=this.m_mass.solve22(y.neg(l)),this.m_impulse.x+=_.x,this.m_impulse.y+=_.y,e.subMul(n,_),i-=a*y.crossVec2Vec2(this.m_rA,_),o.addMul(r,_),s+=m*y.crossVec2Vec2(this.m_rB,_);this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){var e,i=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,r=pt.neo(o),a=pt.neo(n),m=0,h=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&this.m_limitState!=Co.inactiveLimit&&0==h){var l=n-o-this.m_referenceAngle,_=0;if(this.m_limitState==Co.equalLimits){var u=c(l-this.m_lowerAngle,-b.maxAngularCorrection,b.maxAngularCorrection);_=-this.m_motorMass*u,m=jo(u)}else this.m_limitState==Co.atLowerLimit?(m=-(u=l-this.m_lowerAngle),u=c(u+b.angularSlop,-b.maxAngularCorrection,0),_=-this.m_motorMass*u):this.m_limitState==Co.atUpperLimit&&(m=u=l-this.m_upperAngle,u=c(u-b.angularSlop,0,b.maxAngularCorrection),_=-this.m_motorMass*u);o-=this.m_invIA*_,n+=this.m_invIB*_}r.setAngle(o),a.setAngle(n);var p=pt.mulVec2(r,y.sub(this.m_localAnchorA,this.m_localCenterA)),d=pt.mulVec2(a,y.sub(this.m_localAnchorB,this.m_localCenterB));(u=y.zero()).addCombine(1,s,1,d),u.subCombine(1,i,1,p),e=u.length();var f=this.m_invMassA,v=this.m_invMassB,x=this.m_invIA,g=this.m_invIB,A=new si;A.ex.x=f+v+x*p.y*p.y+g*d.y*d.y,A.ex.y=-x*p.x*p.y-g*d.x*d.y,A.ey.x=A.ex.y,A.ey.y=f+v+x*p.x*p.x+g*d.x*d.x;var B=y.neg(A.solve(u));return i.subMul(f,B),o-=x*y.crossVec2Vec2(p,B),s.addMul(v,B),n+=g*y.crossVec2Vec2(d,B),this.m_bodyA.c_position.c.setVec2(i),this.m_bodyA.c_position.a=o,this.m_bodyB.c_position.c.setVec2(s),this.m_bodyB.c_position.a=n,e<=b.linearSlop&&m<=b.angularSlop},e.TYPE="revolute-joint",e}(Wt),Ko=Math.abs,Xo=Math.max,Zo=Math.min;!function(t){t[t.inactiveLimit=0]="inactiveLimit",t[t.atLowerLimit=1]="atLowerLimit",t[t.atUpperLimit=2]="atUpperLimit",t[t.equalLimits=3]="equalLimits"}(Eo||(Eo={}));var Qo,ts={enableLimit:!1,lowerTranslation:0,upperTranslation:0,enableMotor:!1,maxMotorForce:0,motorSpeed:0},es=function(t){function e(i,o,n,r,a){var m=this;return m instanceof e?(i=s(i,ts),o=(m=t.call(this,i,o,n)||this).m_bodyA,n=m.m_bodyB,m.m_type=e.TYPE,m.m_localAnchorA=y.clone(r?o.getLocalPoint(r):i.localAnchorA||y.zero()),m.m_localAnchorB=y.clone(r?n.getLocalPoint(r):i.localAnchorB||y.zero()),m.m_localXAxisA=y.clone(a?o.getLocalVector(a):i.localAxisA||y.neo(1,0)),m.m_localXAxisA.normalize(),m.m_localYAxisA=y.crossNumVec2(1,m.m_localXAxisA),m.m_referenceAngle=Number.isFinite(i.referenceAngle)?i.referenceAngle:n.getAngle()-o.getAngle(),m.m_impulse=new ao,m.m_motorMass=0,m.m_motorImpulse=0,m.m_lowerTranslation=i.lowerTranslation,m.m_upperTranslation=i.upperTranslation,m.m_maxMotorForce=i.maxMotorForce,m.m_motorSpeed=i.motorSpeed,m.m_enableLimit=i.enableLimit,m.m_enableMotor=i.enableMotor,m.m_limitState=Eo.inactiveLimit,m.m_axis=y.zero(),m.m_perp=y.zero(),m.m_K=new No,m):new e(i,o,n,r,a)}return i(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerTranslation:this.m_lowerTranslation,upperTranslation:this.m_upperTranslation,maxMotorForce:this.m_maxMotorForce,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA,referenceAngle:this.m_referenceAngle}},e._deserialize=function(t,i,s){return(t=o({},t)).bodyA=s(jt,t.bodyA,i),t.bodyB=s(jt,t.bodyB,i),t.localAxisA=y.clone(t.localAxisA),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),t.localAxisA&&(this.m_localXAxisA.setVec2(t.localAxisA),this.m_localYAxisA.setVec2(y.crossNumVec2(1,t.localAxisA))),Number.isFinite(t.referenceAngle)&&(this.m_referenceAngle=t.referenceAngle),void 0!==t.enableLimit&&(this.m_enableLimit=!!t.enableLimit),Number.isFinite(t.lowerTranslation)&&(this.m_lowerTranslation=t.lowerTranslation),Number.isFinite(t.upperTranslation)&&(this.m_upperTranslation=t.upperTranslation),void 0!==t.enableMotor&&(this.m_enableMotor=!!t.enableMotor),Number.isFinite(t.maxMotorForce)&&(this.m_maxMotorForce=t.maxMotorForce),Number.isFinite(t.motorSpeed)&&(this.m_motorSpeed=t.motorSpeed)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.getLocalAxisA=function(){return this.m_localXAxisA},e.prototype.getReferenceAngle=function(){return this.m_referenceAngle},e.prototype.getJointTranslation=function(){var t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),e=this.m_bodyB.getWorldPoint(this.m_localAnchorB),i=y.sub(e,t),o=this.m_bodyA.getWorldVector(this.m_localXAxisA);return y.dot(i,o)},e.prototype.getJointSpeed=function(){var t=this.m_bodyA,e=this.m_bodyB,i=pt.mulVec2(t.m_xf.q,y.sub(this.m_localAnchorA,t.m_sweep.localCenter)),o=pt.mulVec2(e.m_xf.q,y.sub(this.m_localAnchorB,e.m_sweep.localCenter)),s=y.add(t.m_sweep.c,i),n=y.add(e.m_sweep.c,o),r=y.sub(n,s),a=pt.mulVec2(t.m_xf.q,this.m_localXAxisA),m=t.m_linearVelocity,c=e.m_linearVelocity,h=t.m_angularVelocity,l=e.m_angularVelocity;return y.dot(r,y.crossNumVec2(h,a))+y.dot(a,y.sub(y.addCrossNumVec2(c,l,o),y.addCrossNumVec2(m,h,i)))},e.prototype.isLimitEnabled=function(){return this.m_enableLimit},e.prototype.enableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},e.prototype.getLowerLimit=function(){return this.m_lowerTranslation},e.prototype.getUpperLimit=function(){return this.m_upperTranslation},e.prototype.setLimits=function(t,e){t==this.m_lowerTranslation&&e==this.m_upperTranslation||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)},e.prototype.isMotorEnabled=function(){return this.m_enableMotor},e.prototype.enableMotor=function(t){t!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t)},e.prototype.setMotorSpeed=function(t){t!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t)},e.prototype.setMaxMotorForce=function(t){t!=this.m_maxMotorForce&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorForce=t)},e.prototype.getMaxMotorForce=function(){return this.m_maxMotorForce},e.prototype.getMotorSpeed=function(){return this.m_motorSpeed},e.prototype.getMotorForce=function(t){return t*this.m_motorImpulse},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return y.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis).mul(t)},e.prototype.getReactionTorque=function(t){return t*this.m_impulse.y},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,c=pt.neo(i),h=pt.neo(r),l=pt.mulVec2(c,y.sub(this.m_localAnchorA,this.m_localCenterA)),_=pt.mulVec2(h,y.sub(this.m_localAnchorB,this.m_localCenterB)),u=y.zero();u.addCombine(1,n,1,_),u.subCombine(1,e,1,l);var p=this.m_invMassA,d=this.m_invMassB,f=this.m_invIA,v=this.m_invIB;this.m_axis=pt.mulVec2(c,this.m_localXAxisA),this.m_a1=y.crossVec2Vec2(y.add(u,l),this.m_axis),this.m_a2=y.crossVec2Vec2(_,this.m_axis),this.m_motorMass=p+d+f*this.m_a1*this.m_a1+v*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_perp=pt.mulVec2(c,this.m_localYAxisA),this.m_s1=y.crossVec2Vec2(y.add(u,l),this.m_perp),this.m_s2=y.crossVec2Vec2(_,this.m_perp),y.crossVec2Vec2(l,this.m_perp);var x=p+d+f*this.m_s1*this.m_s1+v*this.m_s2*this.m_s2,g=f*this.m_s1+v*this.m_s2,A=f*this.m_s1*this.m_a1+v*this.m_s2*this.m_a2,B=f+v;0==B&&(B=1);var w=f*this.m_a1+v*this.m_a2,V=p+d+f*this.m_a1*this.m_a1+v*this.m_a2*this.m_a2;if(this.m_K.ex.set(x,g,A),this.m_K.ey.set(g,B,w),this.m_K.ez.set(A,w,V),this.m_enableLimit){var C=y.dot(this.m_axis,u);Ko(this.m_upperTranslation-this.m_lowerTranslation)<2*b.linearSlop?this.m_limitState=Eo.equalLimits:C<=this.m_lowerTranslation?this.m_limitState!=Eo.atLowerLimit&&(this.m_limitState=Eo.atLowerLimit,this.m_impulse.z=0):C>=this.m_upperTranslation?this.m_limitState!=Eo.atUpperLimit&&(this.m_limitState=Eo.atUpperLimit,this.m_impulse.z=0):(this.m_limitState=Eo.inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=Eo.inactiveLimit,this.m_impulse.z=0;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;var M=y.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis),S=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,T=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;o.subMul(p,M),s-=f*S,a.addMul(d,M),m+=v*T}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(o),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.setVec2(a),this.m_bodyB.c_velocity.w=m},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,m=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!=Eo.equalLimits){var h=y.dot(this.m_axis,y.sub(o,e))+this.m_a2*s-this.m_a1*i,l=this.m_motorMass*(this.m_motorSpeed-h),_=this.m_motorImpulse,u=t.dt*this.m_maxMotorForce;this.m_motorImpulse=c(this.m_motorImpulse+l,-u,u),l=this.m_motorImpulse-_;var p=y.mulNumVec2(l,this.m_axis),d=l*this.m_a1,f=l*this.m_a2;e.subMul(n,p),i-=a*d,o.addMul(r,p),s+=m*f}var v=y.zero();if(v.x+=y.dot(this.m_perp,o)+this.m_s2*s,v.x-=y.dot(this.m_perp,e)+this.m_s1*i,v.y=s-i,this.m_enableLimit&&this.m_limitState!=Eo.inactiveLimit){var x=0;x+=y.dot(this.m_axis,o)+this.m_a2*s,x-=y.dot(this.m_axis,e)+this.m_a1*i,h=new ao(v.x,v.y,x);var g=ao.clone(this.m_impulse),b=this.m_K.solve33(ao.neg(h));this.m_impulse.add(b),this.m_limitState==Eo.atLowerLimit?this.m_impulse.z=Xo(this.m_impulse.z,0):this.m_limitState==Eo.atUpperLimit&&(this.m_impulse.z=Zo(this.m_impulse.z,0));var A=y.combine(-1,v,-(this.m_impulse.z-g.z),y.neo(this.m_K.ez.x,this.m_K.ez.y)),B=y.add(this.m_K.solve22(A),y.neo(g.x,g.y));this.m_impulse.x=B.x,this.m_impulse.y=B.y,b=ao.sub(this.m_impulse,g),p=y.combine(b.x,this.m_perp,b.z,this.m_axis),d=b.x*this.m_s1+b.y+b.z*this.m_a1,f=b.x*this.m_s2+b.y+b.z*this.m_a2,e.subMul(n,p),i-=a*d,o.addMul(r,p),s+=m*f}else b=this.m_K.solve22(y.neg(v)),this.m_impulse.x+=b.x,this.m_impulse.y+=b.y,p=y.mulNumVec2(b.x,this.m_perp),d=b.x*this.m_s1+b.y,f=b.x*this.m_s2+b.y,e.subMul(n,p),i-=a*d,o.addMul(r,p),s+=m*f;this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=pt.neo(i),r=pt.neo(s),a=this.m_invMassA,m=this.m_invMassB,h=this.m_invIA,l=this.m_invIB,_=pt.mulVec2(n,y.sub(this.m_localAnchorA,this.m_localCenterA)),u=pt.mulVec2(r,y.sub(this.m_localAnchorB,this.m_localCenterB)),p=y.sub(y.add(o,u),y.add(e,_)),d=pt.mulVec2(n,this.m_localXAxisA),f=y.crossVec2Vec2(y.add(p,_),d),v=y.crossVec2Vec2(u,d),x=pt.mulVec2(n,this.m_localYAxisA),g=y.crossVec2Vec2(y.add(p,_),x),A=y.crossVec2Vec2(u,x),B=new ao,w=y.zero();w.x=y.dot(x,p),w.y=s-i-this.m_referenceAngle;var V=Ko(w.x),C=Ko(w.y),M=b.linearSlop,S=b.maxLinearCorrection,T=!1,P=0;if(this.m_enableLimit){var I=y.dot(d,p);Ko(this.m_upperTranslation-this.m_lowerTranslation)<2*M?(P=c(I,-S,S),V=Xo(V,Ko(I)),T=!0):I<=this.m_lowerTranslation?(P=c(I-this.m_lowerTranslation+M,-S,0),V=Math.max(V,this.m_lowerTranslation-I),T=!0):I>=this.m_upperTranslation&&(P=c(I-this.m_upperTranslation-M,0,S),V=Math.max(V,I-this.m_upperTranslation),T=!0)}if(T){var z=a+m+h*g*g+l*A*A,F=h*g+l*A,L=h*g*f+l*A*v;0==(R=h+l)&&(R=1);var q=h*f+l*v,k=a+m+h*f*f+l*v*v;(O=new No).ex.set(z,F,L),O.ey.set(F,R,q),O.ez.set(L,q,k);var D=new ao;D.x=w.x,D.y=w.y,D.z=P,B=O.solve33(ao.neg(D))}else{var R,O;z=a+m+h*g*g+l*A*A,F=h*g+l*A,0==(R=h+l)&&(R=1),(O=new si).ex.setNum(z,F),O.ey.setNum(F,R);var N=O.solve(y.neg(w));B.x=N.x,B.y=N.y,B.z=0}var j=y.combine(B.x,x,B.z,d),E=B.x*g+B.y+B.z*f,W=B.x*A+B.y+B.z*v;return e.subMul(a,j),i-=h*E,o.addMul(m,j),s+=l*W,this.m_bodyA.c_position.c=e,this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c=o,this.m_bodyB.c_position.a=s,V<=b.linearSlop&&C<=b.angularSlop},e.TYPE="prismatic-joint",e}(Wt),is={ratio:1},os=function(t){function e(i,o,n,r,a,m){var c,h,l=this;if(!(l instanceof e))return new e(i,o,n,r,a,m);i=s(i,is),o=(l=t.call(this,i,o,n)||this).m_bodyA,n=l.m_bodyB,l.m_type=e.TYPE,l.m_joint1=r||i.joint1,l.m_joint2=a||i.joint2,l.m_ratio=Number.isFinite(m)?m:i.ratio,l.m_type1=l.m_joint1.getType(),l.m_type2=l.m_joint2.getType(),l.m_bodyC=l.m_joint1.getBodyA(),l.m_bodyA=l.m_joint1.getBodyB();var _=l.m_bodyA.m_xf,u=l.m_bodyA.m_sweep.a,p=l.m_bodyC.m_xf,d=l.m_bodyC.m_sweep.a;if(l.m_type1===Go.TYPE){var f=l.m_joint1;l.m_localAnchorC=f.m_localAnchorA,l.m_localAnchorA=f.m_localAnchorB,l.m_referenceAngleA=f.m_referenceAngle,l.m_localAxisC=y.zero(),c=u-d-l.m_referenceAngleA}else{var v=l.m_joint1;l.m_localAnchorC=v.m_localAnchorA,l.m_localAnchorA=v.m_localAnchorB,l.m_referenceAngleA=v.m_referenceAngle,l.m_localAxisC=v.m_localXAxisA;var x=l.m_localAnchorC,g=pt.mulTVec2(p.q,y.add(pt.mulVec2(_.q,l.m_localAnchorA),y.sub(_.p,p.p)));c=y.dot(g,l.m_localAxisC)-y.dot(x,l.m_localAxisC)}l.m_bodyD=l.m_joint2.getBodyA(),l.m_bodyB=l.m_joint2.getBodyB();var b=l.m_bodyB.m_xf,A=l.m_bodyB.m_sweep.a,B=l.m_bodyD.m_xf,w=l.m_bodyD.m_sweep.a;if(l.m_type2===Go.TYPE)f=l.m_joint2,l.m_localAnchorD=f.m_localAnchorA,l.m_localAnchorB=f.m_localAnchorB,l.m_referenceAngleB=f.m_referenceAngle,l.m_localAxisD=y.zero(),h=A-w-l.m_referenceAngleB;else{v=l.m_joint2,l.m_localAnchorD=v.m_localAnchorA,l.m_localAnchorB=v.m_localAnchorB,l.m_referenceAngleB=v.m_referenceAngle,l.m_localAxisD=v.m_localXAxisA;var V=l.m_localAnchorD,C=pt.mulTVec2(B.q,y.add(pt.mulVec2(b.q,l.m_localAnchorB),y.sub(b.p,B.p)));h=y.dot(C,l.m_localAxisD)-y.dot(V,l.m_localAxisD)}return l.m_constant=c+l.m_ratio*h,l.m_impulse=0,l}return i(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,joint1:this.m_joint1,joint2:this.m_joint2,ratio:this.m_ratio}},e._deserialize=function(t,i,s){return(t=o({},t)).bodyA=s(jt,t.bodyA,i),t.bodyB=s(jt,t.bodyB,i),t.joint1=s(Wt,t.joint1,i),t.joint2=s(Wt,t.joint2,i),new e(t)},e.prototype._reset=function(t){Number.isFinite(t.ratio)&&(this.m_ratio=t.ratio)},e.prototype.getJoint1=function(){return this.m_joint1},e.prototype.getJoint2=function(){return this.m_joint2},e.prototype.setRatio=function(t){this.m_ratio=t},e.prototype.getRatio=function(){return this.m_ratio},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return y.mulNumVec2(this.m_impulse,this.m_JvAC).mul(t)},e.prototype.getReactionTorque=function(t){return t*(this.m_impulse*this.m_JwA)},e.prototype.initVelocityConstraints=function(t){this.m_lcA=this.m_bodyA.m_sweep.localCenter,this.m_lcB=this.m_bodyB.m_sweep.localCenter,this.m_lcC=this.m_bodyC.m_sweep.localCenter,this.m_lcD=this.m_bodyD.m_sweep.localCenter,this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=this.m_bodyC.c_position.a,m=this.m_bodyC.c_velocity.v,c=this.m_bodyC.c_velocity.w,h=this.m_bodyD.c_position.a,l=this.m_bodyD.c_velocity.v,_=this.m_bodyD.c_velocity.w,u=pt.neo(e),p=pt.neo(s),d=pt.neo(a),f=pt.neo(h);if(this.m_mass=0,this.m_type1==Go.TYPE)this.m_JvAC=y.zero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var v=pt.mulVec2(d,this.m_localAxisC),x=pt.mulSub(d,this.m_localAnchorC,this.m_lcC),g=pt.mulSub(u,this.m_localAnchorA,this.m_lcA);this.m_JvAC=v,this.m_JwC=y.crossVec2Vec2(x,v),this.m_JwA=y.crossVec2Vec2(g,v),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_type2==Go.TYPE)this.m_JvBD=y.zero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{v=pt.mulVec2(f,this.m_localAxisD);var b=pt.mulSub(f,this.m_localAnchorD,this.m_lcD),A=pt.mulSub(p,this.m_localAnchorB,this.m_lcB);this.m_JvBD=y.mulNumVec2(this.m_ratio,v),this.m_JwD=this.m_ratio*y.crossVec2Vec2(b,v),this.m_JwB=this.m_ratio*y.crossVec2Vec2(A,v),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.warmStarting?(i.addMul(this.m_mA*this.m_impulse,this.m_JvAC),o+=this.m_iA*this.m_impulse*this.m_JwA,n.addMul(this.m_mB*this.m_impulse,this.m_JvBD),r+=this.m_iB*this.m_impulse*this.m_JwB,m.subMul(this.m_mC*this.m_impulse,this.m_JvAC),c-=this.m_iC*this.m_impulse*this.m_JwC,l.subMul(this.m_mD*this.m_impulse,this.m_JvBD),_-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,this.m_bodyA.c_velocity.v.setVec2(i),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.setVec2(n),this.m_bodyB.c_velocity.w=r,this.m_bodyC.c_velocity.v.setVec2(m),this.m_bodyC.c_velocity.w=c,this.m_bodyD.c_velocity.v.setVec2(l),this.m_bodyD.c_velocity.w=_},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_bodyC.c_velocity.v,r=this.m_bodyC.c_velocity.w,a=this.m_bodyD.c_velocity.v,m=this.m_bodyD.c_velocity.w,c=y.dot(this.m_JvAC,e)-y.dot(this.m_JvAC,n)+y.dot(this.m_JvBD,o)-y.dot(this.m_JvBD,a);c+=this.m_JwA*i-this.m_JwC*r+(this.m_JwB*s-this.m_JwD*m);var h=-this.m_mass*c;this.m_impulse+=h,e.addMul(this.m_mA*h,this.m_JvAC),i+=this.m_iA*h*this.m_JwA,o.addMul(this.m_mB*h,this.m_JvBD),s+=this.m_iB*h*this.m_JwB,n.subMul(this.m_mC*h,this.m_JvAC),r-=this.m_iC*h*this.m_JwC,a.subMul(this.m_mD*h,this.m_JvBD),m-=this.m_iD*h*this.m_JwD,this.m_bodyA.c_velocity.v.setVec2(e),this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v.setVec2(o),this.m_bodyB.c_velocity.w=s,this.m_bodyC.c_velocity.v.setVec2(n),this.m_bodyC.c_velocity.w=r,this.m_bodyD.c_velocity.v.setVec2(a),this.m_bodyD.c_velocity.w=m},e.prototype.solvePositionConstraints=function(t){var e,i,o,s,n,r,a,m,c=this.m_bodyA.c_position.c,h=this.m_bodyA.c_position.a,l=this.m_bodyB.c_position.c,_=this.m_bodyB.c_position.a,u=this.m_bodyC.c_position.c,p=this.m_bodyC.c_position.a,d=this.m_bodyD.c_position.c,f=this.m_bodyD.c_position.a,v=pt.neo(h),x=pt.neo(_),g=pt.neo(p),A=pt.neo(f),B=0;if(this.m_type1==Go.TYPE)o=y.zero(),n=1,a=1,B+=this.m_iA+this.m_iC,e=h-p-this.m_referenceAngleA;else{var w=pt.mulVec2(g,this.m_localAxisC),V=pt.mulSub(g,this.m_localAnchorC,this.m_lcC),C=pt.mulSub(v,this.m_localAnchorA,this.m_lcA);o=w,a=y.crossVec2Vec2(V,w),n=y.crossVec2Vec2(C,w),B+=this.m_mC+this.m_mA+this.m_iC*a*a+this.m_iA*n*n;var M=y.sub(this.m_localAnchorC,this.m_lcC),S=pt.mulTVec2(g,y.add(C,y.sub(c,u)));e=y.dot(y.sub(S,M),this.m_localAxisC)}if(this.m_type2==Go.TYPE)s=y.zero(),r=this.m_ratio,m=this.m_ratio,B+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),i=_-f-this.m_referenceAngleB;else{w=pt.mulVec2(A,this.m_localAxisD);var T=pt.mulSub(A,this.m_localAnchorD,this.m_lcD),P=pt.mulSub(x,this.m_localAnchorB,this.m_lcB);s=y.mulNumVec2(this.m_ratio,w),m=this.m_ratio*y.crossVec2Vec2(T,w),r=this.m_ratio*y.crossVec2Vec2(P,w),B+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*m*m+this.m_iB*r*r;var I=y.sub(this.m_localAnchorD,this.m_lcD),z=pt.mulTVec2(A,y.add(P,y.sub(l,d)));i=y.dot(z,this.m_localAxisD)-y.dot(I,this.m_localAxisD)}var F=e+this.m_ratio*i-this.m_constant,L=0;return B>0&&(L=-F/B),c.addMul(this.m_mA*L,o),h+=this.m_iA*L*n,l.addMul(this.m_mB*L,s),_+=this.m_iB*L*r,u.subMul(this.m_mC*L,o),p-=this.m_iC*L*a,d.subMul(this.m_mD*L,s),f-=this.m_iD*L*m,this.m_bodyA.c_position.c.setVec2(c),this.m_bodyA.c_position.a=h,this.m_bodyB.c_position.c.setVec2(l),this.m_bodyB.c_position.a=_,this.m_bodyC.c_position.c.setVec2(u),this.m_bodyC.c_position.a=p,this.m_bodyD.c_position.c.setVec2(d),this.m_bodyD.c_position.a=f,0<b.linearSlop},e.TYPE="gear-joint",e}(Wt),ss={maxForce:1,maxTorque:1,correctionFactor:.3},ns=function(t){function e(i,o,n){var r=this;return r instanceof e?(i=s(i,ss),o=(r=t.call(this,i,o,n)||this).m_bodyA,n=r.m_bodyB,r.m_type=e.TYPE,r.m_linearOffset=y.isValid(i.linearOffset)?y.clone(i.linearOffset):o.getLocalPoint(n.getPosition()),r.m_angularOffset=Number.isFinite(i.angularOffset)?i.angularOffset:n.getAngle()-o.getAngle(),r.m_linearImpulse=y.zero(),r.m_angularImpulse=0,r.m_maxForce=i.maxForce,r.m_maxTorque=i.maxTorque,r.m_correctionFactor=i.correctionFactor,r):new e(i,o,n)}return i(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,correctionFactor:this.m_correctionFactor,linearOffset:this.m_linearOffset,angularOffset:this.m_angularOffset}},e._deserialize=function(t,i,s){return(t=o({},t)).bodyA=s(jt,t.bodyA,i),t.bodyB=s(jt,t.bodyB,i),new e(t)},e.prototype._reset=function(t){Number.isFinite(t.angularOffset)&&(this.m_angularOffset=t.angularOffset),Number.isFinite(t.maxForce)&&(this.m_maxForce=t.maxForce),Number.isFinite(t.maxTorque)&&(this.m_maxTorque=t.maxTorque),Number.isFinite(t.correctionFactor)&&(this.m_correctionFactor=t.correctionFactor),y.isValid(t.linearOffset)&&this.m_linearOffset.set(t.linearOffset)},e.prototype.setMaxForce=function(t){this.m_maxForce=t},e.prototype.getMaxForce=function(){return this.m_maxForce},e.prototype.setMaxTorque=function(t){this.m_maxTorque=t},e.prototype.getMaxTorque=function(){return this.m_maxTorque},e.prototype.setCorrectionFactor=function(t){this.m_correctionFactor=t},e.prototype.getCorrectionFactor=function(){return this.m_correctionFactor},e.prototype.setLinearOffset=function(t){t.x==this.m_linearOffset.x&&t.y==this.m_linearOffset.y||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_linearOffset.set(t))},e.prototype.getLinearOffset=function(){return this.m_linearOffset},e.prototype.setAngularOffset=function(t){t!=this.m_angularOffset&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_angularOffset=t)},e.prototype.getAngularOffset=function(){return this.m_angularOffset},e.prototype.getAnchorA=function(){return this.m_bodyA.getPosition()},e.prototype.getAnchorB=function(){return this.m_bodyB.getPosition()},e.prototype.getReactionForce=function(t){return y.mulNumVec2(t,this.m_linearImpulse)},e.prototype.getReactionTorque=function(t){return t*this.m_angularImpulse},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,c=pt.neo(i),h=pt.neo(r);this.m_rA=pt.mulVec2(c,y.sub(this.m_linearOffset,this.m_localCenterA)),this.m_rB=pt.mulVec2(h,y.neg(this.m_localCenterB));var l=this.m_invMassA,_=this.m_invMassB,u=this.m_invIA,p=this.m_invIB,d=new si;if(d.ex.x=l+_+u*this.m_rA.y*this.m_rA.y+p*this.m_rB.y*this.m_rB.y,d.ex.y=-u*this.m_rA.x*this.m_rA.y-p*this.m_rB.x*this.m_rB.y,d.ey.x=d.ex.y,d.ey.y=l+_+u*this.m_rA.x*this.m_rA.x+p*this.m_rB.x*this.m_rB.x,this.m_linearMass=d.getInverse(),this.m_angularMass=u+p,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),this.m_linearError=y.zero(),this.m_linearError.addCombine(1,n,1,this.m_rB),this.m_linearError.subCombine(1,e,1,this.m_rA),this.m_angularError=r-i-this.m_angularOffset,t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;var f=y.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);o.subMul(l,f),s-=u*(y.crossVec2Vec2(this.m_rA,f)+this.m_angularImpulse),a.addMul(_,f),m+=p*(y.crossVec2Vec2(this.m_rB,f)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=o,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=m},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,m=this.m_invIB,h=t.dt,l=t.inv_dt,_=s-i+l*this.m_correctionFactor*this.m_angularError,u=-this.m_angularMass*_,p=this.m_angularImpulse,d=h*this.m_maxTorque;this.m_angularImpulse=c(this.m_angularImpulse+u,-d,d),i-=a*(u=this.m_angularImpulse-p),s+=m*u,(_=y.zero()).addCombine(1,o,1,y.crossNumVec2(s,this.m_rB)),_.subCombine(1,e,1,y.crossNumVec2(i,this.m_rA)),_.addMul(l*this.m_correctionFactor,this.m_linearError),u=y.neg(si.mulVec2(this.m_linearMass,_)),p=y.clone(this.m_linearImpulse),this.m_linearImpulse.add(u),d=h*this.m_maxForce,this.m_linearImpulse.clamp(d),u=y.sub(this.m_linearImpulse,p),e.subMul(n,u),i-=a*y.crossVec2Vec2(this.m_rA,u),o.addMul(r,u),s+=m*y.crossVec2Vec2(this.m_rB,u),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){return!0},e.TYPE="motor-joint",e}(Wt),rs=Math.PI,as={maxForce:0,frequencyHz:5,dampingRatio:.7},ms=function(t){function e(i,o,n,r){var a=this;return a instanceof e?(i=s(i,as),o=(a=t.call(this,i,o,n)||this).m_bodyA,n=a.m_bodyB,a.m_type=e.TYPE,y.isValid(r)?a.m_targetA=y.clone(r):y.isValid(i.target)?a.m_targetA=y.clone(i.target):a.m_targetA=y.zero(),a.m_localAnchorB=xt.mulTVec2(n.getTransform(),a.m_targetA),a.m_maxForce=i.maxForce,a.m_impulse=y.zero(),a.m_frequencyHz=i.frequencyHz,a.m_dampingRatio=i.dampingRatio,a.m_beta=0,a.m_gamma=0,a.m_rB=y.zero(),a.m_localCenterB=y.zero(),a.m_invMassB=0,a.m_invIB=0,a.m_mass=new si,a.m_C=y.zero(),a):new e(i,o,n,r)}return i(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,target:this.m_targetA,maxForce:this.m_maxForce,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,_localAnchorB:this.m_localAnchorB}},e._deserialize=function(t,i,s){(t=o({},t)).bodyA=s(jt,t.bodyA,i),t.bodyB=s(jt,t.bodyB,i),t.target=y.clone(t.target);var n=new e(t);return t._localAnchorB&&(n.m_localAnchorB=t._localAnchorB),n},e.prototype._reset=function(t){Number.isFinite(t.maxForce)&&(this.m_maxForce=t.maxForce),Number.isFinite(t.frequencyHz)&&(this.m_frequencyHz=t.frequencyHz),Number.isFinite(t.dampingRatio)&&(this.m_dampingRatio=t.dampingRatio)},e.prototype.setTarget=function(t){y.areEqual(t,this.m_targetA)||(this.m_bodyB.setAwake(!0),this.m_targetA.set(t))},e.prototype.getTarget=function(){return this.m_targetA},e.prototype.setMaxForce=function(t){this.m_maxForce=t},e.prototype.getMaxForce=function(){return this.m_maxForce},e.prototype.setFrequency=function(t){this.m_frequencyHz=t},e.prototype.getFrequency=function(){return this.m_frequencyHz},e.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.getDampingRatio=function(){return this.m_dampingRatio},e.prototype.getAnchorA=function(){return y.clone(this.m_targetA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return y.mulNumVec2(t,this.m_impulse)},e.prototype.getReactionTorque=function(t){return 0*t},e.prototype.shiftOrigin=function(t){this.m_targetA.sub(t)},e.prototype.initVelocityConstraints=function(t){this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyB.c_position,i=this.m_bodyB.c_velocity,o=e.c,s=e.a,n=i.v,r=i.w,a=pt.neo(s),m=this.m_bodyB.getMass(),c=2*rs*this.m_frequencyHz,h=2*m*this.m_dampingRatio*c,l=m*(c*c),_=t.dt;this.m_gamma=_*(h+_*l),0!=this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=_*l*this.m_gamma,this.m_rB=pt.mulVec2(a,y.sub(this.m_localAnchorB,this.m_localCenterB));var u=new si;u.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,u.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,u.ey.x=u.ex.y,u.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,this.m_mass=u.getInverse(),this.m_C.setVec2(o),this.m_C.addCombine(1,this.m_rB,-1,this.m_targetA),this.m_C.mul(this.m_beta),r*=.98,t.warmStarting?(this.m_impulse.mul(t.dtRatio),n.addMul(this.m_invMassB,this.m_impulse),r+=this.m_invIB*y.crossVec2Vec2(this.m_rB,this.m_impulse)):this.m_impulse.setZero(),i.v.setVec2(n),i.w=r},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyB.c_velocity,i=y.clone(e.v),o=e.w,s=y.crossNumVec2(o,this.m_rB);s.add(i),s.addCombine(1,this.m_C,this.m_gamma,this.m_impulse),s.neg();var n=si.mulVec2(this.m_mass,s),r=y.clone(this.m_impulse);this.m_impulse.add(n);var a=t.dt*this.m_maxForce;this.m_impulse.clamp(a),n=y.sub(this.m_impulse,r),i.addMul(this.m_invMassB,n),o+=this.m_invIB*y.crossVec2Vec2(this.m_rB,n),e.v.setVec2(i),e.w=o},e.prototype.solvePositionConstraints=function(t){return!0},e.TYPE="mouse-joint",e}(Wt),cs=Math.abs,hs={collideConnected:!0},ls=function(t){function e(i,o,n,r,a,m,c,h){var l=this;return l instanceof e?(i=s(i,hs),o=(l=t.call(this,i,o,n)||this).m_bodyA,n=l.m_bodyB,l.m_type=e.TYPE,l.m_groundAnchorA=y.clone(r||i.groundAnchorA||y.neo(-1,1)),l.m_groundAnchorB=y.clone(a||i.groundAnchorB||y.neo(1,1)),l.m_localAnchorA=y.clone(m?o.getLocalPoint(m):i.localAnchorA||y.neo(-1,0)),l.m_localAnchorB=y.clone(c?n.getLocalPoint(c):i.localAnchorB||y.neo(1,0)),l.m_lengthA=Number.isFinite(i.lengthA)?i.lengthA:y.distance(m,r),l.m_lengthB=Number.isFinite(i.lengthB)?i.lengthB:y.distance(c,a),l.m_ratio=Number.isFinite(h)?h:i.ratio,l.m_constant=l.m_lengthA+l.m_ratio*l.m_lengthB,l.m_impulse=0,l):new e(i,o,n,r,a,m,c,h)}return i(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,groundAnchorA:this.m_groundAnchorA,groundAnchorB:this.m_groundAnchorB,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,lengthA:this.m_lengthA,lengthB:this.m_lengthB,ratio:this.m_ratio}},e._deserialize=function(t,i,s){return(t=o({},t)).bodyA=s(jt,t.bodyA,i),t.bodyB=s(jt,t.bodyB,i),new e(t)},e.prototype._reset=function(t){y.isValid(t.groundAnchorA)&&this.m_groundAnchorA.set(t.groundAnchorA),y.isValid(t.groundAnchorB)&&this.m_groundAnchorB.set(t.groundAnchorB),y.isValid(t.localAnchorA)?this.m_localAnchorA.set(t.localAnchorA):y.isValid(t.anchorA)&&this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)),y.isValid(t.localAnchorB)?this.m_localAnchorB.set(t.localAnchorB):y.isValid(t.anchorB)&&this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)),Number.isFinite(t.lengthA)&&(this.m_lengthA=t.lengthA),Number.isFinite(t.lengthB)&&(this.m_lengthB=t.lengthB),Number.isFinite(t.ratio)&&(this.m_ratio=t.ratio)},e.prototype.getGroundAnchorA=function(){return this.m_groundAnchorA},e.prototype.getGroundAnchorB=function(){return this.m_groundAnchorB},e.prototype.getLengthA=function(){return this.m_lengthA},e.prototype.getLengthB=function(){return this.m_lengthB},e.prototype.getRatio=function(){return this.m_ratio},e.prototype.getCurrentLengthA=function(){var t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),e=this.m_groundAnchorA;return y.distance(t,e)},e.prototype.getCurrentLengthB=function(){var t=this.m_bodyB.getWorldPoint(this.m_localAnchorB),e=this.m_groundAnchorB;return y.distance(t,e)},e.prototype.shiftOrigin=function(t){this.m_groundAnchorA.sub(t),this.m_groundAnchorB.sub(t)},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return y.mulNumVec2(this.m_impulse,this.m_uB).mul(t)},e.prototype.getReactionTorque=function(t){return 0},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,c=pt.neo(i),h=pt.neo(r);this.m_rA=pt.mulVec2(c,y.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=pt.mulVec2(h,y.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_uA=y.sub(y.add(e,this.m_rA),this.m_groundAnchorA),this.m_uB=y.sub(y.add(n,this.m_rB),this.m_groundAnchorB);var l=this.m_uA.length(),_=this.m_uB.length();l>10*b.linearSlop?this.m_uA.mul(1/l):this.m_uA.setZero(),_>10*b.linearSlop?this.m_uB.mul(1/_):this.m_uB.setZero();var u=y.crossVec2Vec2(this.m_rA,this.m_uA),p=y.crossVec2Vec2(this.m_rB,this.m_uB),d=this.m_invMassA+this.m_invIA*u*u,f=this.m_invMassB+this.m_invIB*p*p;if(this.m_mass=d+this.m_ratio*this.m_ratio*f,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.warmStarting){this.m_impulse*=t.dtRatio;var v=y.mulNumVec2(-this.m_impulse,this.m_uA),x=y.mulNumVec2(-this.m_ratio*this.m_impulse,this.m_uB);o.addMul(this.m_invMassA,v),s+=this.m_invIA*y.crossVec2Vec2(this.m_rA,v),a.addMul(this.m_invMassB,x),m+=this.m_invIB*y.crossVec2Vec2(this.m_rB,x)}else this.m_impulse=0;this.m_bodyA.c_velocity.v=o,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=m},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=y.add(e,y.crossNumVec2(i,this.m_rA)),r=y.add(o,y.crossNumVec2(s,this.m_rB)),a=-y.dot(this.m_uA,n)-this.m_ratio*y.dot(this.m_uB,r),m=-this.m_mass*a;this.m_impulse+=m;var c=y.mulNumVec2(-m,this.m_uA),h=y.mulNumVec2(-this.m_ratio*m,this.m_uB);e.addMul(this.m_invMassA,c),i+=this.m_invIA*y.crossVec2Vec2(this.m_rA,c),o.addMul(this.m_invMassB,h),s+=this.m_invIB*y.crossVec2Vec2(this.m_rB,h),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=pt.neo(i),r=pt.neo(s),a=pt.mulVec2(n,y.sub(this.m_localAnchorA,this.m_localCenterA)),m=pt.mulVec2(r,y.sub(this.m_localAnchorB,this.m_localCenterB)),c=y.sub(y.add(e,this.m_rA),this.m_groundAnchorA),h=y.sub(y.add(o,this.m_rB),this.m_groundAnchorB),l=c.length(),_=h.length();l>10*b.linearSlop?c.mul(1/l):c.setZero(),_>10*b.linearSlop?h.mul(1/_):h.setZero();var u=y.crossVec2Vec2(a,c),p=y.crossVec2Vec2(m,h),d=this.m_invMassA+this.m_invIA*u*u,f=this.m_invMassB+this.m_invIB*p*p,v=d+this.m_ratio*this.m_ratio*f;v>0&&(v=1/v);var x=this.m_constant-l-this.m_ratio*_,g=cs(x),A=-v*x,B=y.mulNumVec2(-A,c),w=y.mulNumVec2(-this.m_ratio*A,h);return e.addMul(this.m_invMassA,B),i+=this.m_invIA*y.crossVec2Vec2(a,B),o.addMul(this.m_invMassB,w),s+=this.m_invIB*y.crossVec2Vec2(m,w),this.m_bodyA.c_position.c=e,this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c=o,this.m_bodyB.c_position.a=s,g<b.linearSlop},e.TYPE="pulley-joint",e}(Wt),_s=Math.min;!function(t){t[t.inactiveLimit=0]="inactiveLimit",t[t.atLowerLimit=1]="atLowerLimit",t[t.atUpperLimit=2]="atUpperLimit",t[t.equalLimits=3]="equalLimits"}(Qo||(Qo={}));var us,ps={maxLength:0},ys=function(t){function e(i,o,n,r){var a=this;return a instanceof e?(i=s(i,ps),o=(a=t.call(this,i,o,n)||this).m_bodyA,n=a.m_bodyB,a.m_type=e.TYPE,a.m_localAnchorA=y.clone(r?o.getLocalPoint(r):i.localAnchorA||y.neo(-1,0)),a.m_localAnchorB=y.clone(r?n.getLocalPoint(r):i.localAnchorB||y.neo(1,0)),a.m_maxLength=i.maxLength,a.m_mass=0,a.m_impulse=0,a.m_length=0,a.m_state=Qo.inactiveLimit,a):new e(i,o,n,r)}return i(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,maxLength:this.m_maxLength}},e._deserialize=function(t,i,s){return(t=o({},t)).bodyA=s(jt,t.bodyA,i),t.bodyB=s(jt,t.bodyB,i),new e(t)},e.prototype._reset=function(t){Number.isFinite(t.maxLength)&&(this.m_maxLength=t.maxLength)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.setMaxLength=function(t){this.m_maxLength=t},e.prototype.getMaxLength=function(){return this.m_maxLength},e.prototype.getLimitState=function(){return this.m_state},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return y.mulNumVec2(this.m_impulse,this.m_u).mul(t)},e.prototype.getReactionTorque=function(t){return 0},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,c=pt.neo(i),h=pt.neo(r);this.m_rA=pt.mulSub(c,this.m_localAnchorA,this.m_localCenterA),this.m_rB=pt.mulSub(h,this.m_localAnchorB,this.m_localCenterB),this.m_u=y.zero(),this.m_u.addCombine(1,n,1,this.m_rB),this.m_u.subCombine(1,e,1,this.m_rA),this.m_length=this.m_u.length();var l=this.m_length-this.m_maxLength;if(this.m_state=l>0?Qo.atUpperLimit:Qo.inactiveLimit,!(this.m_length>b.linearSlop))return this.m_u.setZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.mul(1/this.m_length);var _=y.crossVec2Vec2(this.m_rA,this.m_u),u=y.crossVec2Vec2(this.m_rB,this.m_u),p=this.m_invMassA+this.m_invIA*_*_+this.m_invMassB+this.m_invIB*u*u;if(this.m_mass=0!=p?1/p:0,t.warmStarting){this.m_impulse*=t.dtRatio;var d=y.mulNumVec2(this.m_impulse,this.m_u);o.subMul(this.m_invMassA,d),s-=this.m_invIA*y.crossVec2Vec2(this.m_rA,d),a.addMul(this.m_invMassB,d),m+=this.m_invIB*y.crossVec2Vec2(this.m_rB,d)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(o),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.setVec2(a),this.m_bodyB.c_velocity.w=m},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=y.addCrossNumVec2(e,i,this.m_rA),r=y.addCrossNumVec2(o,s,this.m_rB),a=this.m_length-this.m_maxLength,m=y.dot(this.m_u,y.sub(r,n));a<0&&(m+=t.inv_dt*a);var c=-this.m_mass*m,h=this.m_impulse;this.m_impulse=_s(0,this.m_impulse+c),c=this.m_impulse-h;var l=y.mulNumVec2(c,this.m_u);e.subMul(this.m_invMassA,l),i-=this.m_invIA*y.crossVec2Vec2(this.m_rA,l),o.addMul(this.m_invMassB,l),s+=this.m_invIB*y.crossVec2Vec2(this.m_rB,l),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=pt.neo(i),r=pt.neo(s),a=pt.mulSub(n,this.m_localAnchorA,this.m_localCenterA),m=pt.mulSub(r,this.m_localAnchorB,this.m_localCenterB),h=y.zero();h.addCombine(1,o,1,m),h.subCombine(1,e,1,a);var l=h.normalize(),_=l-this.m_maxLength;_=c(_,0,b.maxLinearCorrection);var u=-this.m_mass*_,p=y.mulNumVec2(u,h);return e.subMul(this.m_invMassA,p),i-=this.m_invIA*y.crossVec2Vec2(a,p),o.addMul(this.m_invMassB,p),s+=this.m_invIB*y.crossVec2Vec2(m,p),this.m_bodyA.c_position.c.setVec2(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.setVec2(o),this.m_bodyB.c_position.a=s,l-this.m_maxLength<b.linearSlop},e.TYPE="rope-joint",e}(Wt),ds=Math.abs,fs=Math.PI,vs={frequencyHz:0,dampingRatio:0},xs=function(t){function e(i,o,n,r){var a=this;return a instanceof e?(i=s(i,vs),o=(a=t.call(this,i,o,n)||this).m_bodyA,n=a.m_bodyB,a.m_type=e.TYPE,a.m_localAnchorA=y.clone(r?o.getLocalPoint(r):i.localAnchorA||y.zero()),a.m_localAnchorB=y.clone(r?n.getLocalPoint(r):i.localAnchorB||y.zero()),a.m_referenceAngle=Number.isFinite(i.referenceAngle)?i.referenceAngle:n.getAngle()-o.getAngle(),a.m_frequencyHz=i.frequencyHz,a.m_dampingRatio=i.dampingRatio,a.m_impulse=new ao,a.m_bias=0,a.m_gamma=0,a.m_mass=new No,a):new e(i,o,n,r)}return i(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},e._deserialize=function(t,i,s){return(t=o({},t)).bodyA=s(jt,t.bodyA,i),t.bodyB=s(jt,t.bodyB,i),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),Number.isFinite(t.frequencyHz)&&(this.m_frequencyHz=t.frequencyHz),Number.isFinite(t.dampingRatio)&&(this.m_dampingRatio=t.dampingRatio)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.getReferenceAngle=function(){return this.m_referenceAngle},e.prototype.setFrequency=function(t){this.m_frequencyHz=t},e.prototype.getFrequency=function(){return this.m_frequencyHz},e.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.getDampingRatio=function(){return this.m_dampingRatio},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return y.neo(this.m_impulse.x,this.m_impulse.y).mul(t)},e.prototype.getReactionTorque=function(t){return t*this.m_impulse.z},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=pt.neo(e),m=pt.neo(s);this.m_rA=pt.mulVec2(a,y.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=pt.mulVec2(m,y.sub(this.m_localAnchorB,this.m_localCenterB));var c=this.m_invMassA,h=this.m_invMassB,l=this.m_invIA,_=this.m_invIB,u=new No;if(u.ex.x=c+h+this.m_rA.y*this.m_rA.y*l+this.m_rB.y*this.m_rB.y*_,u.ey.x=-this.m_rA.y*this.m_rA.x*l-this.m_rB.y*this.m_rB.x*_,u.ez.x=-this.m_rA.y*l-this.m_rB.y*_,u.ex.y=u.ey.x,u.ey.y=c+h+this.m_rA.x*this.m_rA.x*l+this.m_rB.x*this.m_rB.x*_,u.ez.y=this.m_rA.x*l+this.m_rB.x*_,u.ex.z=u.ez.x,u.ey.z=u.ez.y,u.ez.z=l+_,this.m_frequencyHz>0){u.getInverse22(this.m_mass);var p=l+_,d=p>0?1/p:0,f=s-e-this.m_referenceAngle,v=2*fs*this.m_frequencyHz,x=2*d*this.m_dampingRatio*v,g=d*v*v,b=t.dt;this.m_gamma=b*(x+b*g),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=f*b*g*this.m_gamma,p+=this.m_gamma,this.m_mass.ez.z=0!=p?1/p:0}else 0==u.ez.z?(u.getInverse22(this.m_mass),this.m_gamma=0,this.m_bias=0):(u.getSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0);if(t.warmStarting){this.m_impulse.mul(t.dtRatio);var A=y.neo(this.m_impulse.x,this.m_impulse.y);i.subMul(c,A),o-=l*(y.crossVec2Vec2(this.m_rA,A)+this.m_impulse.z),n.addMul(h,A),r+=_*(y.crossVec2Vec2(this.m_rB,A)+this.m_impulse.z)}else this.m_impulse.setZero();this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,m=this.m_invIB;if(this.m_frequencyHz>0){var c=s-i,h=-this.m_mass.ez.z*(c+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=h,i-=a*h,s+=m*h,(u=y.zero()).addCombine(1,o,1,y.crossNumVec2(s,this.m_rB)),u.subCombine(1,e,1,y.crossNumVec2(i,this.m_rA));var l=y.neg(No.mulVec2(this.m_mass,u));this.m_impulse.x+=l.x,this.m_impulse.y+=l.y;var _=y.clone(l);e.subMul(n,_),i-=a*y.crossVec2Vec2(this.m_rA,_),o.addMul(r,_),s+=m*y.crossVec2Vec2(this.m_rB,_)}else{var u;(u=y.zero()).addCombine(1,o,1,y.crossNumVec2(s,this.m_rB)),u.subCombine(1,e,1,y.crossNumVec2(i,this.m_rA)),c=s-i;var p=new ao(u.x,u.y,c),d=ao.neg(No.mulVec3(this.m_mass,p));this.m_impulse.add(d),_=y.neo(d.x,d.y),e.subMul(n,_),i-=a*(y.crossVec2Vec2(this.m_rA,_)+d.z),o.addMul(r,_),s+=m*(y.crossVec2Vec2(this.m_rB,_)+d.z)}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},e.prototype.solvePositionConstraints=function(t){var e,i,o=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=pt.neo(s),m=pt.neo(r),c=this.m_invMassA,h=this.m_invMassB,l=this.m_invIA,_=this.m_invIB,u=pt.mulVec2(a,y.sub(this.m_localAnchorA,this.m_localCenterA)),p=pt.mulVec2(m,y.sub(this.m_localAnchorB,this.m_localCenterB)),d=new No;if(d.ex.x=c+h+u.y*u.y*l+p.y*p.y*_,d.ey.x=-u.y*u.x*l-p.y*p.x*_,d.ez.x=-u.y*l-p.y*_,d.ex.y=d.ey.x,d.ey.y=c+h+u.x*u.x*l+p.x*p.x*_,d.ez.y=u.x*l+p.x*_,d.ex.z=d.ez.x,d.ey.z=d.ez.y,d.ez.z=l+_,this.m_frequencyHz>0){(v=y.zero()).addCombine(1,n,1,p),v.subCombine(1,o,1,u),e=v.length(),i=0;var f=y.neg(d.solve22(v));o.subMul(c,f),s-=l*y.crossVec2Vec2(u,f),n.addMul(h,f),r+=_*y.crossVec2Vec2(p,f)}else{var v;(v=y.zero()).addCombine(1,n,1,p),v.subCombine(1,o,1,u);var x=r-s-this.m_referenceAngle;e=v.length(),i=ds(x);var g=new ao(v.x,v.y,x),A=new ao;if(d.ez.z>0)A=ao.neg(d.solve33(g));else{var B=y.neg(d.solve22(v));A.set(B.x,B.y,0)}f=y.neo(A.x,A.y),o.subMul(c,f),s-=l*(y.crossVec2Vec2(u,f)+A.z),n.addMul(h,f),r+=_*(y.crossVec2Vec2(p,f)+A.z)}return this.m_bodyA.c_position.c=o,this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c=n,this.m_bodyB.c_position.a=r,e<=b.linearSlop&&i<=b.angularSlop},e.TYPE="weld-joint",e}(Wt),gs=Math.abs,bs=Math.PI,As={enableMotor:!1,maxMotorTorque:0,motorSpeed:0,frequencyHz:2,dampingRatio:.7},Bs=function(t){function e(i,o,n,r,a){var m=this;return m instanceof e?(i=s(i,As),o=(m=t.call(this,i,o,n)||this).m_bodyA,n=m.m_bodyB,m.m_ax=y.zero(),m.m_ay=y.zero(),m.m_type=e.TYPE,m.m_localAnchorA=y.clone(r?o.getLocalPoint(r):i.localAnchorA||y.zero()),m.m_localAnchorB=y.clone(r?n.getLocalPoint(r):i.localAnchorB||y.zero()),y.isValid(a)?m.m_localXAxisA=o.getLocalVector(a):y.isValid(i.localAxisA)?m.m_localXAxisA=y.clone(i.localAxisA):y.isValid(i.localAxis)?m.m_localXAxisA=y.clone(i.localAxis):m.m_localXAxisA=y.neo(1,0),m.m_localYAxisA=y.crossNumVec2(1,m.m_localXAxisA),m.m_mass=0,m.m_impulse=0,m.m_motorMass=0,m.m_motorImpulse=0,m.m_springMass=0,m.m_springImpulse=0,m.m_maxMotorTorque=i.maxMotorTorque,m.m_motorSpeed=i.motorSpeed,m.m_enableMotor=i.enableMotor,m.m_frequencyHz=i.frequencyHz,m.m_dampingRatio=i.dampingRatio,m.m_bias=0,m.m_gamma=0,m):new e(i,o,n,r,a)}return i(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,enableMotor:this.m_enableMotor,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA}},e._deserialize=function(t,i,s){return(t=o({},t)).bodyA=s(jt,t.bodyA,i),t.bodyB=s(jt,t.bodyB,i),new e(t)},e.prototype._reset=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),t.localAxisA&&(this.m_localXAxisA.setVec2(t.localAxisA),this.m_localYAxisA.setVec2(y.crossNumVec2(1,t.localAxisA))),void 0!==t.enableMotor&&(this.m_enableMotor=t.enableMotor),Number.isFinite(t.maxMotorTorque)&&(this.m_maxMotorTorque=t.maxMotorTorque),Number.isFinite(t.motorSpeed)&&(this.m_motorSpeed=t.motorSpeed),Number.isFinite(t.frequencyHz)&&(this.m_frequencyHz=t.frequencyHz),Number.isFinite(t.dampingRatio)&&(this.m_dampingRatio=t.dampingRatio)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.getLocalAxisA=function(){return this.m_localXAxisA},e.prototype.getJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.getWorldPoint(this.m_localAnchorA),o=e.getWorldPoint(this.m_localAnchorB),s=y.sub(o,i),n=t.getWorldVector(this.m_localXAxisA);return y.dot(s,n)},e.prototype.getJointSpeed=function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t},e.prototype.isMotorEnabled=function(){return this.m_enableMotor},e.prototype.enableMotor=function(t){t!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t)},e.prototype.setMotorSpeed=function(t){t!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t)},e.prototype.getMotorSpeed=function(){return this.m_motorSpeed},e.prototype.setMaxMotorTorque=function(t){t!=this.m_maxMotorTorque&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t)},e.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},e.prototype.getMotorTorque=function(t){return t*this.m_motorImpulse},e.prototype.setSpringFrequencyHz=function(t){this.m_frequencyHz=t},e.prototype.getSpringFrequencyHz=function(){return this.m_frequencyHz},e.prototype.setSpringDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.getSpringDampingRatio=function(){return this.m_dampingRatio},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return y.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax).mul(t)},e.prototype.getReactionTorque=function(t){return t*this.m_motorImpulse},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_invMassA,i=this.m_invMassB,o=this.m_invIA,s=this.m_invIB,n=this.m_bodyA.c_position.c,r=this.m_bodyA.c_position.a,a=this.m_bodyA.c_velocity.v,m=this.m_bodyA.c_velocity.w,c=this.m_bodyB.c_position.c,h=this.m_bodyB.c_position.a,l=this.m_bodyB.c_velocity.v,_=this.m_bodyB.c_velocity.w,u=pt.neo(r),p=pt.neo(h),d=pt.mulVec2(u,y.sub(this.m_localAnchorA,this.m_localCenterA)),f=pt.mulVec2(p,y.sub(this.m_localAnchorB,this.m_localCenterB)),v=y.zero();if(v.addCombine(1,c,1,f),v.subCombine(1,n,1,d),this.m_ay=pt.mulVec2(u,this.m_localYAxisA),this.m_sAy=y.crossVec2Vec2(y.add(v,d),this.m_ay),this.m_sBy=y.crossVec2Vec2(f,this.m_ay),this.m_mass=e+i+o*this.m_sAy*this.m_sAy+s*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){this.m_ax=pt.mulVec2(u,this.m_localXAxisA),this.m_sAx=y.crossVec2Vec2(y.add(v,d),this.m_ax),this.m_sBx=y.crossVec2Vec2(f,this.m_ax);var x=e+i+o*this.m_sAx*this.m_sAx+s*this.m_sBx*this.m_sBx;if(x>0){this.m_springMass=1/x;var g=y.dot(v,this.m_ax),b=2*bs*this.m_frequencyHz,A=2*this.m_springMass*this.m_dampingRatio*b,B=this.m_springMass*b*b,w=t.dt;this.m_gamma=w*(A+w*B),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=g*w*B*this.m_gamma,this.m_springMass=x+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=o+s,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.warmStarting){this.m_impulse*=t.dtRatio,this.m_springImpulse*=t.dtRatio,this.m_motorImpulse*=t.dtRatio;var V=y.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax),C=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,M=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;a.subMul(this.m_invMassA,V),m-=this.m_invIA*C,l.addMul(this.m_invMassB,V),_+=this.m_invIB*M}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(a),this.m_bodyA.c_velocity.w=m,this.m_bodyB.c_velocity.v.setVec2(l),this.m_bodyB.c_velocity.w=_},e.prototype.solveVelocityConstraints=function(t){var e=this.m_invMassA,i=this.m_invMassB,o=this.m_invIA,s=this.m_invIB,n=this.m_bodyA.c_velocity.v,r=this.m_bodyA.c_velocity.w,a=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,h=y.dot(this.m_ax,a)-y.dot(this.m_ax,n)+this.m_sBx*m-this.m_sAx*r,l=-this.m_springMass*(h+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=l;var _=y.mulNumVec2(l,this.m_ax),u=l*this.m_sAx,p=l*this.m_sBx;n.subMul(e,_),r-=o*u,a.addMul(i,_),h=(m+=s*p)-r-this.m_motorSpeed,l=-this.m_motorMass*h;var d=this.m_motorImpulse,f=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=c(this.m_motorImpulse+l,-f,f),r-=o*(l=this.m_motorImpulse-d),m+=s*l,h=y.dot(this.m_ay,a)-y.dot(this.m_ay,n)+this.m_sBy*m-this.m_sAy*r,l=-this.m_mass*h,this.m_impulse+=l,_=y.mulNumVec2(l,this.m_ay),u=l*this.m_sAy,p=l*this.m_sBy,n.subMul(e,_),r-=o*u,a.addMul(i,_),m+=s*p,this.m_bodyA.c_velocity.v.setVec2(n),this.m_bodyA.c_velocity.w=r,this.m_bodyB.c_velocity.v.setVec2(a),this.m_bodyB.c_velocity.w=m},e.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=pt.neo(i),r=pt.neo(s),a=pt.mulVec2(n,y.sub(this.m_localAnchorA,this.m_localCenterA)),m=pt.mulVec2(r,y.sub(this.m_localAnchorB,this.m_localCenterB)),c=y.zero();c.addCombine(1,o,1,m),c.subCombine(1,e,1,a);var h=pt.mulVec2(n,this.m_localYAxisA),l=y.crossVec2Vec2(y.add(c,a),h),_=y.crossVec2Vec2(m,h),u=y.dot(c,h),p=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy,d=0!=p?-u/p:0,f=y.mulNumVec2(d,h),v=d*l,x=d*_;return e.subMul(this.m_invMassA,f),i-=this.m_invIA*v,o.addMul(this.m_invMassB,f),s+=this.m_invIB*x,this.m_bodyA.c_position.c.setVec2(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.setVec2(o),this.m_bodyB.c_position.a=s,gs(u)<=b.linearSlop},e.TYPE="wheel-joint",e}(Wt),ws=0,Vs={World:ro,Body:jt,Joint:Wt,Fixture:It,Shape:Vt},Cs={Vec2:y,Vec3:ao,World:ro,Body:jt,Joint:Wt,Fixture:It,Shape:Vt},Ms=((us={})[jt.STATIC]=jt,us[jt.DYNAMIC]=jt,us[jt.KINEMATIC]=jt,us[po.TYPE]=po,us[Vo.TYPE]=Vo,us[ho.TYPE]=ho,us[zo.TYPE]=zo,us[Do.TYPE]=Do,us[Oo.TYPE]=Oo,us[os.TYPE]=os,us[ns.TYPE]=ns,us[ms.TYPE]=ms,us[es.TYPE]=es,us[ls.TYPE]=ls,us[Go.TYPE]=Go,us[ys.TYPE]=ys,us[xs.TYPE]=xs,us[Bs.TYPE]=Bs,us),Ss={rootClass:ro,preSerialize:function(t){return t},postSerialize:function(t,e){return t},preDeserialize:function(t){return t},postDeserialize:function(t,e){return t}},Ts=function(){return function(t){var e=this;this.toJson=function(t){var i=e.options.preSerialize,o=e.options.postSerialize,s=[],n=[t],r={};function a(t,e){if(t.__sid=t.__sid||++ws,!r[t.__sid]){n.push(t);var i={refIndex:s.length+n.length,refType:e};r[t.__sid]=i}return r[t.__sid]}function m(t,e){if(void 0===e&&(e=!1),"object"!=typeof t||null===t)return t;if("function"==typeof t._serialize){if(!e)for(var s in Vs)if(t instanceof Vs[s])return a(t,s);r=(n=i(n=t))._serialize(),t=o(r,n)}var n,r;if(Array.isArray(t)){for(var c=[],h=0;h<t.length;h++)c[h]=m(t[h]);t=c}else{for(var h in c={},t)t.hasOwnProperty(h)&&(c[h]=m(t[h]));t=c}return t}for(;n.length;){var c=m(n.shift(),!0);s.push(c)}return s},this.fromJson=function(t){var i=e.options.preDeserialize,o=e.options.postDeserialize,s=e.options.rootClass,n={};function r(t,e,s){if(t&&t._deserialize||(t=Ms[e.type]),t&&t._deserialize){e=i(e);var n=(0,t._deserialize)(e,s,a);return o(n,e)}}function a(e,i,o){if(!i.refIndex||!i.refType)return r(e,i,o);var s=i;Cs[s.refType]&&(e=Cs[s.refType]);var a=s.refIndex;if(!n[a]){var m=r(e,t[a],o);n[a]=m}return n[a]}return r(s,t[0],null)},this.options=o(o({},Ss),t)}}(),Ps=new Ts({rootClass:ro});Ts.fromJson=Ps.fromJson,Ts.toJson=Ps.toJson;var Is=function(){function t(){this.width=80,this.height=60,this.x=0,this.y=-10,this.scaleY=-1,this.hz=60,this.speed=1,this.background="#222222",this.activeKeys={},this.step=function(t,e){},this.keydown=function(t,e){},this.keyup=function(t,e){}}return t.mount=function(t){throw new Error("Not implemented")},t.start=function(e){var i=t.mount();return i.start(e),i},t.prototype.color=function(t,e,i){return"rgb("+(t=256*t|0)+", "+(e=256*e|0)+", "+(i=256*i|0)+")"},t}();function zs(t,e){var i,o;"function"==typeof t?(i=t,o=e):"function"==typeof e?(i=e,o=t):o=null!=t?t:e;var s=Is.mount(o);if(!i)return s;var n=i(s)||s.world;s.start(n)}var Fs=function(t){function e(i,o,s,n){var r=this;return r instanceof e?((r=t.call(this)||this)._setAsBox(i,o,s,n),r):new e(i,o,s,n)}return i(e,t),e.TYPE="polygon",e}(Vo),Ls=Fs;so.addType(zo.TYPE,zo.TYPE,(function(t,e,i,o,s,n,r){Ds(t,i.getShape(),e,n.getShape(),s)}));var qs=q(0,0),ks=q(0,0),Ds=function(e,i,o,s,n){e.pointCount=0,at(qs,o,i.m_p),at(ks,n,s.m_p);var r=it(ks,qs),a=i.m_radius+s.m_radius;r>a*a||(e.type=t.ManifoldType.e_circles,D(e.localPoint,i.m_p),R(e.localNormal),e.pointCount=1,D(e.points[0].localPoint,s.m_p),e.points[0].id.setFeatures(0,t.ContactFeatureType.e_vertex,0,t.ContactFeatureType.e_vertex))};so.addType(ho.TYPE,zo.TYPE,(function(t,e,i,o,s,n,r){var a=i.getShape(),m=n.getShape();Js(t,a,e,m,s)})),so.addType(po.TYPE,zo.TYPE,(function(t,e,i,o,s,n,r){var a=i.getShape(),m=new ho;a.getChildEdge(m,o);var c=m,h=n.getShape();Js(t,c,e,h,s)}));var Rs=q(0,0),Os=q(0,0),Ns=q(0,0),js=q(0,0),Es=q(0,0),Ws=q(0,0),Js=function(e,i,o,s,n){e.pointCount=0,ct(js,n,o,s.m_p);var r=i.m_vertex1,a=i.m_vertex2;E(Rs,a,r);var m=Q(Rs,a)-Q(Rs,js),c=Q(Rs,js)-Q(Rs,r),h=i.m_radius+s.m_radius;if(c<=0){if(D(Es,r),it(js,r)>h*h)return;if(i.m_hasVertex0){var l=i.m_vertex0,_=r;if(E(Os,_,l),Q(Os,_)-Q(Os,js)>0)return}return e.type=t.ManifoldType.e_circles,R(e.localNormal),D(e.localPoint,Es),e.pointCount=1,D(e.points[0].localPoint,s.m_p),void e.points[0].id.setFeatures(0,t.ContactFeatureType.e_vertex,0,t.ContactFeatureType.e_vertex)}if(m<=0){if(D(Es,a),it(js,Es)>h*h)return;if(i.m_hasVertex3){var u=i.m_vertex3,p=a;if(E(Ns,u,p),Q(Ns,js)-Q(Ns,p)>0)return}return e.type=t.ManifoldType.e_circles,R(e.localNormal),D(e.localPoint,Es),e.pointCount=1,D(e.points[0].localPoint,s.m_p),void e.points[0].id.setFeatures(1,t.ContactFeatureType.e_vertex,0,t.ContactFeatureType.e_vertex)}var y=tt(Rs);U(Es,m/y,r,c/y,a),it(js,Es)>h*h||(X(Ws,1,Rs),Q(Ws,js)-Q(Ws,r)<0&&O(Ws),G(Ws),e.type=t.ManifoldType.e_faceA,D(e.localNormal,Ws),D(e.localPoint,r),e.pointCount=1,D(e.points[0].localPoint,s.m_p),e.points[0].id.setFeatures(0,t.ContactFeatureType.e_face,0,t.ContactFeatureType.e_vertex))},Ys=[new pi,new pi],Hs=[new pi,new pi],Us=[new pi,new pi],$s=q(0,0),Gs=q(0,0),Ks=q(0,0),Xs=nt(0,0,0),Zs=q(0,0),Qs=q(0,0),tn=q(0,0),en=q(0,0),on=q(0,0),sn=q(0,0),nn=q(0,0),rn=q(0,0);function an(t,e,i,o,s){var n=t.m_count,r=i.m_count,a=t.m_normals,m=t.m_vertices,c=i.m_vertices;ht(Xs,o,e);for(var h=0,l=-1/0,_=0;_<n;++_){ot(Ks,Xs.q,a[_]),at(Gs,Xs,m[_]);for(var u=1/0,p=0;p<r;++p){var y=Q(Ks,c[p])-Q(Ks,Gs);y<u&&(u=y)}u>l&&(l=u,h=_)}s.maxSeparation=l,s.bestIndex=h}so.addType(Vo.TYPE,Vo.TYPE,(function(t,e,i,o,s,n,r){cn(t,i.getShape(),e,n.getShape(),s)}));var mn={maxSeparation:0,bestIndex:0},cn=function(e,i,o,s,n){e.pointCount=0;var r=i.m_radius+s.m_radius;an(i,o,s,n,mn);var a=mn.bestIndex,m=mn.maxSeparation;if(!(m>r)){an(s,n,i,o,mn);var c=mn.bestIndex,h=mn.maxSeparation;if(!(h>r)){var l,_,u,p,y,d;h>m+.1*b.linearSlop?(l=s,_=i,u=n,p=o,y=c,e.type=t.ManifoldType.e_faceB,d=!0):(l=i,_=s,u=o,p=n,y=a,e.type=t.ManifoldType.e_faceA,d=!1),Ys[0].recycle(),Ys[1].recycle(),function(e,i,o,s,n,r){var a,m,c,h,l,_,u,p,y=i.m_normals,d=n.m_count,f=n.m_vertices,v=n.m_normals;a=rn,m=r.q,c=o.q,h=y[s],l=m.c*h.x+m.s*h.y,_=-m.s*h.x+m.c*h.y,u=c.c*l-c.s*_,p=c.s*l+c.c*_,a.x=u,a.y=p;for(var x=0,g=1/0,b=0;b<d;++b){var A=Q(rn,v[b]);A<g&&(g=A,x=b)}var B=x,w=B+1<d?B+1:0;at(e[0].v,r,f[B]),e[0].id.setFeatures(s,t.ContactFeatureType.e_face,B,t.ContactFeatureType.e_vertex),at(e[1].v,r,f[w]),e[1].id.setFeatures(s,t.ContactFeatureType.e_face,w,t.ContactFeatureType.e_vertex)}(Ys,l,u,y,_,p);var f=l.m_count,v=l.m_vertices,x=y,g=y+1<f?y+1:0;D(Zs,v[x]),D(Qs,v[g]),E(tn,Qs,Zs),G(tn),K(en,tn,1),U(on,.5,Zs,.5,Qs),ot(sn,u.q,tn),K(nn,sn,1),at(Zs,u,Zs),at(Qs,u,Qs);var A=Q(nn,Zs),B=-Q(sn,Zs)+r,w=Q(sn,Qs)+r;if(Hs[0].recycle(),Hs[1].recycle(),Us[0].recycle(),Us[1].recycle(),k($s,-sn.x,-sn.y),!(gi(Hs,Ys,$s,B,x)<2||(k($s,sn.x,sn.y),gi(Us,Hs,$s,w,g)<2))){D(e.localNormal,en),D(e.localPoint,on);for(var V=0,C=0;C<Us.length;++C)if(Q(nn,Us[C].v)-A<=r){var M=e.points[V];mt(M.localPoint,p,Us[C].v),M.id.set(Us[C].id),d&&M.id.swapFeatures(),++V}e.pointCount=V}}}};so.addType(Vo.TYPE,zo.TYPE,(function(t,e,i,o,s,n,r){_n(t,i.getShape(),e,n.getShape(),s)}));var hn=q(0,0),ln=q(0,0),_n=function(e,i,o,s,n){e.pointCount=0,ct(hn,n,o,s.m_p);for(var a=0,m=-1/0,c=i.m_radius+s.m_radius,h=i.m_count,l=i.m_vertices,_=i.m_normals,u=0;u<h;++u){var p=Q(_[u],hn)-Q(_[u],l[u]);if(p>c)return;p>m&&(m=p,a=u)}var y=a,d=y+1<h?y+1:0,f=l[y],v=l[d];if(m<r)return e.pointCount=1,e.type=t.ManifoldType.e_faceA,D(e.localNormal,_[a]),U(e.localPoint,.5,f,.5,v),D(e.points[0].localPoint,s.m_p),void e.points[0].id.setFeatures(0,t.ContactFeatureType.e_vertex,0,t.ContactFeatureType.e_vertex);var x=Q(hn,v)-Q(hn,f)-Q(f,v)+Q(f,f),g=Q(hn,f)-Q(hn,v)-Q(v,f)+Q(v,v);if(x<=0){if(it(hn,f)>c*c)return;e.pointCount=1,e.type=t.ManifoldType.e_faceA,E(e.localNormal,hn,f),G(e.localNormal),D(e.localPoint,f),D(e.points[0].localPoint,s.m_p),e.points[0].id.setFeatures(0,t.ContactFeatureType.e_vertex,0,t.ContactFeatureType.e_vertex)}else if(g<=0){if(it(hn,v)>c*c)return;e.pointCount=1,e.type=t.ManifoldType.e_faceA,E(e.localNormal,hn,v),G(e.localNormal),D(e.localPoint,v),D(e.points[0].localPoint,s.m_p),e.points[0].id.setFeatures(0,t.ContactFeatureType.e_vertex,0,t.ContactFeatureType.e_vertex)}else{if(U(ln,.5,f,.5,v),Q(hn,_[y])-Q(ln,_[y])>c)return;e.pointCount=1,e.type=t.ManifoldType.e_faceA,D(e.localNormal,_[y]),D(e.localPoint,ln),D(e.points[0].localPoint,s.m_p),e.points[0].id.setFeatures(0,t.ContactFeatureType.e_vertex,0,t.ContactFeatureType.e_vertex)}},un=Math.min;so.addType(ho.TYPE,Vo.TYPE,(function(t,e,i,o,s,n,r){En(t,i.getShape(),e,n.getShape(),s)})),so.addType(po.TYPE,Vo.TYPE,(function(t,e,i,o,s,n,r){i.getShape().getChildEdge(vn,o),En(t,vn,e,n.getShape(),s)}));var pn,yn,dn,fn,vn=new ho;(fn=pn||(pn={}))[fn.e_unknown=-1]="e_unknown",fn[fn.e_edgeA=1]="e_edgeA",fn[fn.e_edgeB=2]="e_edgeB",(dn=yn||(yn={}))[dn.e_isolated=0]="e_isolated",dn[dn.e_concave=1]="e_concave",dn[dn.e_convex=2]="e_convex";var xn=function(){return function(){}}(),gn=function(){return function(){this.vertices=[],this.normals=[],this.count=0;for(var t=0;t<b.maxPolygonVertices;t++)this.vertices.push(q(0,0)),this.normals.push(q(0,0))}}(),bn=function(){function t(){this.v1=q(0,0),this.v2=q(0,0),this.normal=q(0,0),this.sideNormal1=q(0,0),this.sideNormal2=q(0,0)}return t.prototype.recycle=function(){R(this.v1),R(this.v2),R(this.normal),R(this.sideNormal1),R(this.sideNormal2)},t}(),An=[new pi,new pi],Bn=[new pi,new pi],wn=[new pi,new pi],Vn=new xn,Cn=new xn,Mn=new gn,Sn=new bn,Tn=q(0,0),Pn=q(0,0),In=q(0,0),zn=q(0,0),Fn=nt(0,0,0),Ln=q(0,0),qn=q(0,0),kn=q(0,0),Dn=q(0,0),Rn=q(0,0),On=q(0,0),Nn=q(0,0),jn=q(0,0),En=function(e,i,o,s,n){ht(Fn,o,n),at(Tn,Fn,s.m_centroid);var r=i.m_vertex0,a=i.m_vertex1,m=i.m_vertex2,c=i.m_vertex3,h=i.m_hasVertex0,l=i.m_hasVertex3;E(In,m,a),G(In),k(kn,In.y,-In.x);var _,u=Q(kn,Tn)-Q(kn,a),p=0,d=0,f=!1,v=!1;R(qn),R(Dn),h&&(E(Pn,a,r),G(Pn),k(qn,Pn.y,-Pn.x),f=Z(Pn,In)>=0,p=y.dot(qn,Tn)-y.dot(qn,r)),l&&(E(zn,c,m),G(zn),k(Dn,zn.y,-zn.x),v=y.crossVec2Vec2(In,zn)>0,d=y.dot(Dn,Tn)-y.dot(Dn,m)),R(Ln),R(Rn),R(On),h&&l?f&&v?(_=p>=0||u>=0||d>=0)?(D(Ln,kn),D(Rn,qn),D(On,Dn)):(J(Ln,-1,kn),J(Rn,-1,kn),J(On,-1,kn)):f?(_=p>=0||u>=0&&d>=0)?(D(Ln,kn),D(Rn,qn),D(On,kn)):(J(Ln,-1,kn),J(Rn,-1,Dn),J(On,-1,kn)):v?(_=d>=0||p>=0&&u>=0)?(D(Ln,kn),D(Rn,kn),D(On,Dn)):(J(Ln,-1,kn),J(Rn,-1,kn),J(On,-1,qn)):(_=p>=0&&u>=0&&d>=0)?(D(Ln,kn),D(Rn,kn),D(On,kn)):(J(Ln,-1,kn),J(Rn,-1,Dn),J(On,-1,qn)):h?f?(_=p>=0||u>=0)?(D(Ln,kn),D(Rn,qn),J(On,-1,kn)):(J(Ln,-1,kn),D(Rn,kn),J(On,-1,kn)):(_=p>=0&&u>=0)?(D(Ln,kn),D(Rn,kn),J(On,-1,kn)):(J(Ln,-1,kn),D(Rn,kn),J(On,-1,qn)):l?v?(_=u>=0||d>=0)?(D(Ln,kn),J(Rn,-1,kn),D(On,Dn)):(J(Ln,-1,kn),J(Rn,-1,kn),D(On,kn)):(_=u>=0&&d>=0)?(D(Ln,kn),J(Rn,-1,kn),D(On,kn)):(J(Ln,-1,kn),J(Rn,-1,Dn),D(On,kn)):(_=u>=0)?(D(Ln,kn),J(Rn,-1,kn),J(On,-1,kn)):(J(Ln,-1,kn),D(Rn,kn),D(On,kn)),Mn.count=s.m_count;for(var x=0;x<s.m_count;++x)at(Mn.vertices[x],Fn,s.m_vertices[x]),ot(Mn.normals[x],Fn.q,s.m_normals[x]);var g=s.m_radius+i.m_radius;for(e.pointCount=0,Vn.type=pn.e_edgeA,Vn.index=_?0:1,Vn.separation=1/0,x=0;x<Mn.count;++x){var A=Mn.vertices[x];(B=Q(Ln,A)-Q(Ln,a))<Vn.separation&&(Vn.separation=B)}if(Vn.type!=pn.e_unknown&&!(Vn.separation>g)){for(Cn.type=pn.e_unknown,Cn.index=-1,Cn.separation=-1/0,k(Nn,-Ln.y,Ln.x),x=0;x<Mn.count;++x){J(jn,-1,Mn.normals[x]);var B,w=Q(jn,Mn.vertices[x])-Q(jn,a),V=Q(jn,Mn.vertices[x])-Q(jn,m);if((B=un(w,V))>g){Cn.type=pn.e_edgeB,Cn.index=x,Cn.separation=B;break}if(Q(jn,Nn)>=0){if(Q(jn,Ln)-Q(On,Ln)<-b.angularSlop)continue}else if(Q(jn,Ln)-Q(Rn,Ln)<-b.angularSlop)continue;B>Cn.separation&&(Cn.type=pn.e_edgeB,Cn.index=x,Cn.separation=B)}if(!(Cn.type!=pn.e_unknown&&Cn.separation>g)){var C;if(C=Cn.type==pn.e_unknown?Vn:Cn.separation>.98*Vn.separation+.001?Cn:Vn,wn[0].recycle(),wn[1].recycle(),C.type==pn.e_edgeA){e.type=t.ManifoldType.e_faceA;var M=0,S=Q(Ln,Mn.normals[0]);for(x=1;x<Mn.count;++x){var T=Q(Ln,Mn.normals[x]);T<S&&(S=T,M=x)}var P=M,I=P+1<Mn.count?P+1:0;D(wn[0].v,Mn.vertices[P]),wn[0].id.setFeatures(0,t.ContactFeatureType.e_face,P,t.ContactFeatureType.e_vertex),D(wn[1].v,Mn.vertices[I]),wn[1].id.setFeatures(0,t.ContactFeatureType.e_face,I,t.ContactFeatureType.e_vertex),_?(Sn.i1=0,Sn.i2=1,D(Sn.v1,a),D(Sn.v2,m),D(Sn.normal,kn)):(Sn.i1=1,Sn.i2=0,D(Sn.v1,m),D(Sn.v2,a),J(Sn.normal,-1,kn))}else e.type=t.ManifoldType.e_faceB,D(wn[0].v,a),wn[0].id.setFeatures(0,t.ContactFeatureType.e_vertex,C.index,t.ContactFeatureType.e_face),D(wn[1].v,m),wn[1].id.setFeatures(0,t.ContactFeatureType.e_vertex,C.index,t.ContactFeatureType.e_face),Sn.i1=C.index,Sn.i2=Sn.i1+1<Mn.count?Sn.i1+1:0,D(Sn.v1,Mn.vertices[Sn.i1]),D(Sn.v2,Mn.vertices[Sn.i2]),D(Sn.normal,Mn.normals[Sn.i1]);if(k(Sn.sideNormal1,Sn.normal.y,-Sn.normal.x),k(Sn.sideNormal2,-Sn.sideNormal1.x,-Sn.sideNormal1.y),Sn.sideOffset1=Q(Sn.sideNormal1,Sn.v1),Sn.sideOffset2=Q(Sn.sideNormal2,Sn.v2),An[0].recycle(),An[1].recycle(),Bn[0].recycle(),Bn[1].recycle(),!(gi(An,wn,Sn.sideNormal1,Sn.sideOffset1,Sn.i1)<b.maxManifoldPoints||gi(Bn,An,Sn.sideNormal2,Sn.sideOffset2,Sn.i2)<b.maxManifoldPoints)){C.type==pn.e_edgeA?(D(e.localNormal,Sn.normal),D(e.localPoint,Sn.v1)):(D(e.localNormal,s.m_normals[Sn.i1]),D(e.localPoint,s.m_vertices[Sn.i1]));var z=0;for(x=0;x<b.maxManifoldPoints;++x)if(Q(Sn.normal,Bn[x].v)-Q(Sn.normal,Sn.v1)<=g){var F=e.points[z];C.type==pn.e_edgeA?(mt(F.localPoint,Fn,Bn[x].v),F.id.set(Bn[x].id)):(D(F.localPoint,Bn[x].v),F.id.set(Bn[x].id),F.id.swapFeatures()),++z}e.pointCount=z}}}},Wn={CollidePolygons:cn,Settings:g,Sweep:vt,Manifold:yi,Distance:se,TimeOfImpact:Re,DynamicTree:M,stats:Jt},Jn=function(){function t(t,e){this._refMap={},this._map={},this._xmap={},this._data=[],this._entered=[],this._exited=[],this._key=t,this._listener=e}return t.prototype.update=function(t){if(!Array.isArray(t))throw"Invalid data: "+t;this._entered.length=0,this._exited.length=0,this._data.length=t.length;for(var e=0;e<t.length;e++)if("object"==typeof t[e]&&null!==t[e]){var i=t[e],o=this._key(i);this._map[o]?delete this._map[o]:this._entered.push(i),this._data[e]=i,this._xmap[o]=i}for(var o in this._map)this._exited.push(this._map[o]),delete this._map[o];var s=this._map;for(this._map=this._xmap,this._xmap=s,e=0;e<this._exited.length;e++){i=this._exited[e];var n=this._key(i),r=this._refMap[n];this._listener.exit(i,r),delete this._refMap[n]}for(e=0;e<this._entered.length;e++)i=this._entered[e],n=this._key(i),(r=this._listener.enter(i))&&(this._refMap[n]=r);for(e=0;e<this._data.length;e++)"object"==typeof t[e]&&null!==t[e]&&(i=this._data[e],n=this._key(i),r=this._refMap[n],this._listener.update(i,r));this._entered.length=0,this._exited.length=0,this._data.length=0},t.prototype.ref=function(t){return this._refMap[this._key(t)]},t}();const Yn=Object.freeze(Object.defineProperty({__proto__:null,AABB:v,Body:jt,Box:Ls,BoxShape:Fs,BroadPhase:I,Chain:yo,ChainShape:po,Circle:Fo,CircleShape:zo,ClipVertex:pi,CollideCircles:Ds,CollideEdgeCircle:Js,CollideEdgePolygon:En,CollidePolygonCircle:_n,CollidePolygons:cn,Contact:so,ContactEdge:Mi,get ContactFeatureType(){return t.ContactFeatureType},ContactID:fi,ContactImpulse:Qe,DataDriver:Jn,Distance:se,DistanceInput:ee,DistanceJoint:Do,DistanceOutput:ie,DistanceProxy:ne,DynamicTree:M,Edge:lo,EdgeShape:ho,Fixture:It,FixtureProxy:Pt,FrictionJoint:Oo,GearJoint:os,Joint:Wt,JointEdge:Et,Manifold:yi,ManifoldPoint:di,get ManifoldType(){return t.ManifoldType},Mat22:si,Mat33:No,Math:h,MotorJoint:ns,MouseJoint:ms,get PointState(){return t.PointState},Polygon:So,PolygonShape:Vo,PrismaticJoint:es,PulleyJoint:ls,RevoluteJoint:Go,RopeJoint:ys,Rot:pt,Serializer:Ts,Settings:g,SettingsInternal:b,Shape:Vt,ShapeCast:ve,ShapeCastInput:de,ShapeCastOutput:fe,SimplexCache:oe,Solver:ti,Sweep:vt,TOIInput:be,TOIOutput:Ae,get TOIOutputState(){return t.TOIOutputState},Testbed:Is,TimeOfImpact:Re,TimeStep:We,Transform:xt,TreeNode:V,Vec2:y,Vec3:ao,VelocityConstraintPoint:Ii,WeldJoint:xs,WheelJoint:Bs,World:ro,WorldManifold:vi,clipSegmentToLine:gi,getPointStates:xi,internal:Wn,mixFriction:Si,mixRestitution:Ti,stats:Jt,testOverlap:pe,testbed:zs},Symbol.toStringTag,{value:"Module"}));t.AABB=v,t.Body=jt,t.Box=Ls,t.BoxShape=Fs,t.BroadPhase=I,t.Chain=yo,t.ChainShape=po,t.Circle=Fo,t.CircleShape=zo,t.ClipVertex=pi,t.CollideCircles=Ds,t.CollideEdgeCircle=Js,t.CollideEdgePolygon=En,t.CollidePolygonCircle=_n,t.CollidePolygons=cn,t.Contact=so,t.ContactEdge=Mi,t.ContactID=fi,t.ContactImpulse=Qe,t.DataDriver=Jn,t.Distance=se,t.DistanceInput=ee,t.DistanceJoint=Do,t.DistanceOutput=ie,t.DistanceProxy=ne,t.DynamicTree=M,t.Edge=lo,t.EdgeShape=ho,t.Fixture=It,t.FixtureProxy=Pt,t.FrictionJoint=Oo,t.GearJoint=os,t.Joint=Wt,t.JointEdge=Et,t.Manifold=yi,t.ManifoldPoint=di,t.Mat22=si,t.Mat33=No,t.Math=h,t.MotorJoint=ns,t.MouseJoint=ms,t.Polygon=So,t.PolygonShape=Vo,t.PrismaticJoint=es,t.PulleyJoint=ls,t.RevoluteJoint=Go,t.RopeJoint=ys,t.Rot=pt,t.Serializer=Ts,t.Settings=g,t.SettingsInternal=b,t.Shape=Vt,t.ShapeCast=ve,t.ShapeCastInput=de,t.ShapeCastOutput=fe,t.SimplexCache=oe,t.Solver=ti,t.Sweep=vt,t.TOIInput=be,t.TOIOutput=Ae,t.Testbed=Is,t.TimeOfImpact=Re,t.TimeStep=We,t.Transform=xt,t.TreeNode=V,t.Vec2=y,t.Vec3=ao,t.VelocityConstraintPoint=Ii,t.WeldJoint=xs,t.WheelJoint=Bs,t.World=ro,t.WorldManifold=vi,t.clipSegmentToLine=gi,t.default=Yn,t.getPointStates=xi,t.internal=Wn,t.mixFriction=Si,t.mixRestitution=Ti,t.stats=Jt,t.testOverlap=pe,t.testbed=zs,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}(e)},938:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.formatLapTime=function(t){if(null==t)return"--'--.---";const e=Math.floor(t/60),i=Math.floor(t%60),o=Math.floor(t%1*1e3);return`${e}'${String(i).padStart(2,"0")}.${String(o).padStart(3,"0")}`}},948:function(t,e,i){"use strict";var o=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))((function(s,n){function r(t){try{m(o.next(t))}catch(t){n(t)}}function a(t){try{m(o.throw(t))}catch(t){n(t)}}function m(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}m((o=o.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.spriteSheet=e.spriteInfos=void 0;const s=i(523),n=i(37),r=i(493),a=i(810);e.spriteInfos={car:new s.Rect(2,2,13,16),asphalt:new s.Rect(18,2,23,23),grass:new s.Rect(44,2,23,23)},e.spriteSheet=new class{constructor(){this.canvas=new a.TinyCanvas}load(){return o(this,void 0,void 0,(function*(){const t=new r.ImagePreloader("./sprite_sheet.png?rev=0");yield t.load(),this.canvas.size=new n.Vec2(t.img[0].naturalWidth,t.img[0].naturalHeight),this.canvas.clear(),this.canvas.ctx.drawImage(t.img[0],0,0)}))}crop(t){const e=new a.TinyCanvas;return e.size=t.size,e.clear(),e.ctx.drawImage(this.canvas.canvas,t.left,t.top,t.width,t.height,0,0,t.width,t.height),e}}},995:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Car=void 0;const o=i(923),s=i(91),n=i(285),r=i(327);e.Car=class{constructor(t,e){this.controlState=e,this.tires=[],this.checkPointHistory=[],this.lapTimes=[],this.body=t.createDynamicBody({position:new o.Vec2(0,0),linearDamping:0,angularDamping:0});const i=new o.PolygonShape([new o.Vec2(-4.5,-7.5),new o.Vec2(-4.5,5.5),new o.Vec2(-2.5,7.5),new o.Vec2(2.5,7.5),new o.Vec2(4.5,5.5),new o.Vec2(4.5,-7.5)].map((t=>t.mul(r.pixelToSim))));this.body.createFixture({shape:i,density:1.5,friction:0,restitution:.8,filterCategoryBits:1,filterMaskBits:6,userData:this});const n=(e,i,n,a)=>{const m=new s.Tire(t,10,-.5,n,a);this.tires.push(m),m.body.setUserData(this);const c=new o.RevoluteJoint({bodyA:this.body,enableLimit:!0,lowerAngle:0,upperAngle:0,bodyB:m.body,localAnchorA:new o.Vec2(e,i).mul(r.pixelToSim),localAnchorB:new o.Vec2(0,0)}),h=t.createJoint(c);return m.joint=h,h};this.flJoint=n(-5.5,4.5,0,0),this.frJoint=n(5.5,4.5,0,0),n(-5.5,-4.5,.02,.01),n(5.5,-4.5,.02,.01)}get startSec(){return this._startSec}get lastLapTime(){if(0!=this.lapTimes.length)return this.lapTimes[this.lapTimes.length-1]}get bestLapTime(){return this._bestLapTime}get getTireAngle(){return this.flJoint.getLowerLimit()}update(){this.tires.forEach((t=>t.updateFriction())),this.tires.forEach((t=>t.updateDrive(this.controlState)));const t=45*n.degToRad,e=-this.controlState.steeringRatio*t;this.flJoint.setLimits(e,e),this.frJoint.setLimits(e,e)}rayCast(t,e){const i=this.body.getWorldVector((0,n.rotateVec2)(new o.Vec2(0,1),e)),s=this.body.getPosition(),r=o.Vec2.add(s,o.Vec2.mul(i,t));let a;return this.body.getWorld().rayCast(s,r,((e,i,o,s)=>2&e.getFilterCategoryBits()?(a=s*t,0):1)),a}reset(t,e){this.body.setTransform(t,e),this.body.setLinearVelocity(o.Vec2.zero()),this.body.setAngularVelocity(0),this.tires.forEach((i=>{const s=i.joint.getLocalAnchorA(),r=(0,n.rotateVec2)(s,e).add(t);i.body.setTransform(r,e),i.body.setLinearVelocity(o.Vec2.zero()),i.body.setAngularVelocity(0)}))}onCheckPoint(t,e,i){if(0==t){if(this.checkPointHistory.length==i&&null!=this._startSec&&this.checkPointHistory.every(((t,e)=>t==e))){const t=e-this._startSec;(null==this._bestLapTime||this._bestLapTime>t)&&(this._bestLapTime=t),this.lapTimes.push(t)}this.checkPointHistory=[0],this._startSec=e}else this.checkPointHistory[this.checkPointHistory.length-1]==t?this.checkPointHistory.pop():this.checkPointHistory.push(t)}destroy(){this.body.getWorld().destroyBody(this.body)}}}},e={};!function i(o){var s=e[o];if(void 0!==s)return s.exports;var n=e[o]={exports:{}};return t[o].call(n.exports,n,n.exports,i),n.exports}(851)})();